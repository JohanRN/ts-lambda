"use strict";var Lc=Object.create;var hr=Object.defineProperty;var Pc=Object.getOwnPropertyDescriptor;var $c=Object.getOwnPropertyNames;var qc=Object.getPrototypeOf,jc=Object.prototype.hasOwnProperty;var y=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Fc=(e,t)=>{for(var r in t)hr(e,r,{get:t[r],enumerable:!0})},pi=(e,t,r,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of $c(t))!jc.call(e,n)&&n!==r&&hr(e,n,{get:()=>t[n],enumerable:!(s=Pc(t,n))||s.enumerable});return e};var mi=(e,t,r)=>(r=e!=null?Lc(qc(e)):{},pi(t||!e||!e.__esModule?hr(r,"default",{value:e,enumerable:!0}):r,e)),Uc=e=>pi(hr({},"__esModule",{value:!0}),e);var yi=y((rm,Gc)=>{Gc.exports={acl:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},append:{arity:3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},asking:{arity:1,flags:["fast"],keyStart:0,keyStop:0,step:0},auth:{arity:-2,flags:["noscript","loading","stale","fast","no_auth","allow_busy"],keyStart:0,keyStop:0,step:0},bgrewriteaof:{arity:1,flags:["admin","noscript","no_async_loading"],keyStart:0,keyStop:0,step:0},bgsave:{arity:-1,flags:["admin","noscript","no_async_loading"],keyStart:0,keyStop:0,step:0},bitcount:{arity:-2,flags:["readonly"],keyStart:1,keyStop:1,step:1},bitfield:{arity:-2,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},bitfield_ro:{arity:-2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},bitop:{arity:-4,flags:["write","denyoom"],keyStart:2,keyStop:-1,step:1},bitpos:{arity:-3,flags:["readonly"],keyStart:1,keyStop:1,step:1},blmove:{arity:6,flags:["write","denyoom","noscript","blocking"],keyStart:1,keyStop:2,step:1},blmpop:{arity:-5,flags:["write","blocking","movablekeys"],keyStart:0,keyStop:0,step:0},blpop:{arity:-3,flags:["write","noscript","blocking"],keyStart:1,keyStop:-2,step:1},brpop:{arity:-3,flags:["write","noscript","blocking"],keyStart:1,keyStop:-2,step:1},brpoplpush:{arity:4,flags:["write","denyoom","noscript","blocking"],keyStart:1,keyStop:2,step:1},bzmpop:{arity:-5,flags:["write","blocking","movablekeys"],keyStart:0,keyStop:0,step:0},bzpopmax:{arity:-3,flags:["write","noscript","blocking","fast"],keyStart:1,keyStop:-2,step:1},bzpopmin:{arity:-3,flags:["write","noscript","blocking","fast"],keyStart:1,keyStop:-2,step:1},client:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},cluster:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},command:{arity:-1,flags:["loading","stale"],keyStart:0,keyStop:0,step:0},config:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},copy:{arity:-3,flags:["write","denyoom"],keyStart:1,keyStop:2,step:1},dbsize:{arity:1,flags:["readonly","fast"],keyStart:0,keyStop:0,step:0},debug:{arity:-2,flags:["admin","noscript","loading","stale"],keyStart:0,keyStop:0,step:0},decr:{arity:2,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},decrby:{arity:3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},del:{arity:-2,flags:["write"],keyStart:1,keyStop:-1,step:1},discard:{arity:1,flags:["noscript","loading","stale","fast","allow_busy"],keyStart:0,keyStop:0,step:0},dump:{arity:2,flags:["readonly"],keyStart:1,keyStop:1,step:1},echo:{arity:2,flags:["fast"],keyStart:0,keyStop:0,step:0},eval:{arity:-3,flags:["noscript","stale","skip_monitor","no_mandatory_keys","movablekeys"],keyStart:0,keyStop:0,step:0},eval_ro:{arity:-3,flags:["readonly","noscript","stale","skip_monitor","no_mandatory_keys","movablekeys"],keyStart:0,keyStop:0,step:0},evalsha:{arity:-3,flags:["noscript","stale","skip_monitor","no_mandatory_keys","movablekeys"],keyStart:0,keyStop:0,step:0},evalsha_ro:{arity:-3,flags:["readonly","noscript","stale","skip_monitor","no_mandatory_keys","movablekeys"],keyStart:0,keyStop:0,step:0},exec:{arity:1,flags:["noscript","loading","stale","skip_slowlog"],keyStart:0,keyStop:0,step:0},exists:{arity:-2,flags:["readonly","fast"],keyStart:1,keyStop:-1,step:1},expire:{arity:-3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},expireat:{arity:-3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},expiretime:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},failover:{arity:-1,flags:["admin","noscript","stale"],keyStart:0,keyStop:0,step:0},fcall:{arity:-3,flags:["noscript","stale","skip_monitor","no_mandatory_keys","movablekeys"],keyStart:0,keyStop:0,step:0},fcall_ro:{arity:-3,flags:["readonly","noscript","stale","skip_monitor","no_mandatory_keys","movablekeys"],keyStart:0,keyStop:0,step:0},flushall:{arity:-1,flags:["write"],keyStart:0,keyStop:0,step:0},flushdb:{arity:-1,flags:["write"],keyStart:0,keyStop:0,step:0},function:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},geoadd:{arity:-5,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},geodist:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},geohash:{arity:-2,flags:["readonly"],keyStart:1,keyStop:1,step:1},geopos:{arity:-2,flags:["readonly"],keyStart:1,keyStop:1,step:1},georadius:{arity:-6,flags:["write","denyoom","movablekeys"],keyStart:1,keyStop:1,step:1},georadius_ro:{arity:-6,flags:["readonly"],keyStart:1,keyStop:1,step:1},georadiusbymember:{arity:-5,flags:["write","denyoom","movablekeys"],keyStart:1,keyStop:1,step:1},georadiusbymember_ro:{arity:-5,flags:["readonly"],keyStart:1,keyStop:1,step:1},geosearch:{arity:-7,flags:["readonly"],keyStart:1,keyStop:1,step:1},geosearchstore:{arity:-8,flags:["write","denyoom"],keyStart:1,keyStop:2,step:1},get:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},getbit:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},getdel:{arity:2,flags:["write","fast"],keyStart:1,keyStop:1,step:1},getex:{arity:-2,flags:["write","fast"],keyStart:1,keyStop:1,step:1},getrange:{arity:4,flags:["readonly"],keyStart:1,keyStop:1,step:1},getset:{arity:3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},hdel:{arity:-3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},hello:{arity:-1,flags:["noscript","loading","stale","fast","no_auth","allow_busy"],keyStart:0,keyStop:0,step:0},hexists:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},hget:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},hgetall:{arity:2,flags:["readonly"],keyStart:1,keyStop:1,step:1},hincrby:{arity:4,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},hincrbyfloat:{arity:4,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},hkeys:{arity:2,flags:["readonly"],keyStart:1,keyStop:1,step:1},hlen:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},hmget:{arity:-3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},hmset:{arity:-4,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},hrandfield:{arity:-2,flags:["readonly"],keyStart:1,keyStop:1,step:1},hscan:{arity:-3,flags:["readonly"],keyStart:1,keyStop:1,step:1},hset:{arity:-4,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},hsetnx:{arity:4,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},hstrlen:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},hvals:{arity:2,flags:["readonly"],keyStart:1,keyStop:1,step:1},incr:{arity:2,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},incrby:{arity:3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},incrbyfloat:{arity:3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},info:{arity:-1,flags:["loading","stale"],keyStart:0,keyStop:0,step:0},keys:{arity:2,flags:["readonly"],keyStart:0,keyStop:0,step:0},lastsave:{arity:1,flags:["loading","stale","fast"],keyStart:0,keyStop:0,step:0},latency:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},lcs:{arity:-3,flags:["readonly"],keyStart:1,keyStop:2,step:1},lindex:{arity:3,flags:["readonly"],keyStart:1,keyStop:1,step:1},linsert:{arity:5,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},llen:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},lmove:{arity:5,flags:["write","denyoom"],keyStart:1,keyStop:2,step:1},lmpop:{arity:-4,flags:["write","movablekeys"],keyStart:0,keyStop:0,step:0},lolwut:{arity:-1,flags:["readonly","fast"],keyStart:0,keyStop:0,step:0},lpop:{arity:-2,flags:["write","fast"],keyStart:1,keyStop:1,step:1},lpos:{arity:-3,flags:["readonly"],keyStart:1,keyStop:1,step:1},lpush:{arity:-3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},lpushx:{arity:-3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},lrange:{arity:4,flags:["readonly"],keyStart:1,keyStop:1,step:1},lrem:{arity:4,flags:["write"],keyStart:1,keyStop:1,step:1},lset:{arity:4,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},ltrim:{arity:4,flags:["write"],keyStart:1,keyStop:1,step:1},memory:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},mget:{arity:-2,flags:["readonly","fast"],keyStart:1,keyStop:-1,step:1},migrate:{arity:-6,flags:["write","movablekeys"],keyStart:3,keyStop:3,step:1},module:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},monitor:{arity:1,flags:["admin","noscript","loading","stale"],keyStart:0,keyStop:0,step:0},move:{arity:3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},mset:{arity:-3,flags:["write","denyoom"],keyStart:1,keyStop:-1,step:2},msetnx:{arity:-3,flags:["write","denyoom"],keyStart:1,keyStop:-1,step:2},multi:{arity:1,flags:["noscript","loading","stale","fast","allow_busy"],keyStart:0,keyStop:0,step:0},object:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},persist:{arity:2,flags:["write","fast"],keyStart:1,keyStop:1,step:1},pexpire:{arity:-3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},pexpireat:{arity:-3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},pexpiretime:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},pfadd:{arity:-2,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},pfcount:{arity:-2,flags:["readonly"],keyStart:1,keyStop:-1,step:1},pfdebug:{arity:3,flags:["write","denyoom","admin"],keyStart:2,keyStop:2,step:1},pfmerge:{arity:-2,flags:["write","denyoom"],keyStart:1,keyStop:-1,step:1},pfselftest:{arity:1,flags:["admin"],keyStart:0,keyStop:0,step:0},ping:{arity:-1,flags:["fast"],keyStart:0,keyStop:0,step:0},psetex:{arity:4,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},psubscribe:{arity:-2,flags:["pubsub","noscript","loading","stale"],keyStart:0,keyStop:0,step:0},psync:{arity:-3,flags:["admin","noscript","no_async_loading","no_multi"],keyStart:0,keyStop:0,step:0},pttl:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},publish:{arity:3,flags:["pubsub","loading","stale","fast"],keyStart:0,keyStop:0,step:0},pubsub:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},punsubscribe:{arity:-1,flags:["pubsub","noscript","loading","stale"],keyStart:0,keyStop:0,step:0},quit:{arity:-1,flags:["noscript","loading","stale","fast","no_auth","allow_busy"],keyStart:0,keyStop:0,step:0},randomkey:{arity:1,flags:["readonly"],keyStart:0,keyStop:0,step:0},readonly:{arity:1,flags:["loading","stale","fast"],keyStart:0,keyStop:0,step:0},readwrite:{arity:1,flags:["loading","stale","fast"],keyStart:0,keyStop:0,step:0},rename:{arity:3,flags:["write"],keyStart:1,keyStop:2,step:1},renamenx:{arity:3,flags:["write","fast"],keyStart:1,keyStop:2,step:1},replconf:{arity:-1,flags:["admin","noscript","loading","stale","allow_busy"],keyStart:0,keyStop:0,step:0},replicaof:{arity:3,flags:["admin","noscript","stale","no_async_loading"],keyStart:0,keyStop:0,step:0},reset:{arity:1,flags:["noscript","loading","stale","fast","no_auth","allow_busy"],keyStart:0,keyStop:0,step:0},restore:{arity:-4,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},"restore-asking":{arity:-4,flags:["write","denyoom","asking"],keyStart:1,keyStop:1,step:1},role:{arity:1,flags:["noscript","loading","stale","fast"],keyStart:0,keyStop:0,step:0},rpop:{arity:-2,flags:["write","fast"],keyStart:1,keyStop:1,step:1},rpoplpush:{arity:3,flags:["write","denyoom"],keyStart:1,keyStop:2,step:1},rpush:{arity:-3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},rpushx:{arity:-3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},sadd:{arity:-3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},save:{arity:1,flags:["admin","noscript","no_async_loading","no_multi"],keyStart:0,keyStop:0,step:0},scan:{arity:-2,flags:["readonly"],keyStart:0,keyStop:0,step:0},scard:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},script:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},sdiff:{arity:-2,flags:["readonly"],keyStart:1,keyStop:-1,step:1},sdiffstore:{arity:-3,flags:["write","denyoom"],keyStart:1,keyStop:-1,step:1},select:{arity:2,flags:["loading","stale","fast"],keyStart:0,keyStop:0,step:0},set:{arity:-3,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},setbit:{arity:4,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},setex:{arity:4,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},setnx:{arity:3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},setrange:{arity:4,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},shutdown:{arity:-1,flags:["admin","noscript","loading","stale","no_multi","allow_busy"],keyStart:0,keyStop:0,step:0},sinter:{arity:-2,flags:["readonly"],keyStart:1,keyStop:-1,step:1},sintercard:{arity:-3,flags:["readonly","movablekeys"],keyStart:0,keyStop:0,step:0},sinterstore:{arity:-3,flags:["write","denyoom"],keyStart:1,keyStop:-1,step:1},sismember:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},slaveof:{arity:3,flags:["admin","noscript","stale","no_async_loading"],keyStart:0,keyStop:0,step:0},slowlog:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},smembers:{arity:2,flags:["readonly"],keyStart:1,keyStop:1,step:1},smismember:{arity:-3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},smove:{arity:4,flags:["write","fast"],keyStart:1,keyStop:2,step:1},sort:{arity:-2,flags:["write","denyoom","movablekeys"],keyStart:1,keyStop:1,step:1},sort_ro:{arity:-2,flags:["readonly","movablekeys"],keyStart:1,keyStop:1,step:1},spop:{arity:-2,flags:["write","fast"],keyStart:1,keyStop:1,step:1},spublish:{arity:3,flags:["pubsub","loading","stale","fast"],keyStart:1,keyStop:1,step:1},srandmember:{arity:-2,flags:["readonly"],keyStart:1,keyStop:1,step:1},srem:{arity:-3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},sscan:{arity:-3,flags:["readonly"],keyStart:1,keyStop:1,step:1},ssubscribe:{arity:-2,flags:["pubsub","noscript","loading","stale"],keyStart:1,keyStop:-1,step:1},strlen:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},subscribe:{arity:-2,flags:["pubsub","noscript","loading","stale"],keyStart:0,keyStop:0,step:0},substr:{arity:4,flags:["readonly"],keyStart:1,keyStop:1,step:1},sunion:{arity:-2,flags:["readonly"],keyStart:1,keyStop:-1,step:1},sunionstore:{arity:-3,flags:["write","denyoom"],keyStart:1,keyStop:-1,step:1},sunsubscribe:{arity:-1,flags:["pubsub","noscript","loading","stale"],keyStart:1,keyStop:-1,step:1},swapdb:{arity:3,flags:["write","fast"],keyStart:0,keyStop:0,step:0},sync:{arity:1,flags:["admin","noscript","no_async_loading","no_multi"],keyStart:0,keyStop:0,step:0},time:{arity:1,flags:["loading","stale","fast"],keyStart:0,keyStop:0,step:0},touch:{arity:-2,flags:["readonly","fast"],keyStart:1,keyStop:-1,step:1},ttl:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},type:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},unlink:{arity:-2,flags:["write","fast"],keyStart:1,keyStop:-1,step:1},unsubscribe:{arity:-1,flags:["pubsub","noscript","loading","stale"],keyStart:0,keyStop:0,step:0},unwatch:{arity:1,flags:["noscript","loading","stale","fast","allow_busy"],keyStart:0,keyStop:0,step:0},wait:{arity:3,flags:["noscript"],keyStart:0,keyStop:0,step:0},watch:{arity:-2,flags:["noscript","loading","stale","fast","allow_busy"],keyStart:1,keyStop:-1,step:1},xack:{arity:-4,flags:["write","fast"],keyStart:1,keyStop:1,step:1},xadd:{arity:-5,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},xautoclaim:{arity:-6,flags:["write","fast"],keyStart:1,keyStop:1,step:1},xclaim:{arity:-6,flags:["write","fast"],keyStart:1,keyStop:1,step:1},xdel:{arity:-3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},xgroup:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},xinfo:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},xlen:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},xpending:{arity:-3,flags:["readonly"],keyStart:1,keyStop:1,step:1},xrange:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},xread:{arity:-4,flags:["readonly","blocking","movablekeys"],keyStart:0,keyStop:0,step:0},xreadgroup:{arity:-7,flags:["write","blocking","movablekeys"],keyStart:0,keyStop:0,step:0},xrevrange:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},xsetid:{arity:-3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},xtrim:{arity:-4,flags:["write"],keyStart:1,keyStop:1,step:1},zadd:{arity:-4,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},zcard:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},zcount:{arity:4,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},zdiff:{arity:-3,flags:["readonly","movablekeys"],keyStart:0,keyStop:0,step:0},zdiffstore:{arity:-4,flags:["write","denyoom","movablekeys"],keyStart:1,keyStop:1,step:1},zincrby:{arity:4,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},zinter:{arity:-3,flags:["readonly","movablekeys"],keyStart:0,keyStop:0,step:0},zintercard:{arity:-3,flags:["readonly","movablekeys"],keyStart:0,keyStop:0,step:0},zinterstore:{arity:-4,flags:["write","denyoom","movablekeys"],keyStart:1,keyStop:1,step:1},zlexcount:{arity:4,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},zmpop:{arity:-4,flags:["write","movablekeys"],keyStart:0,keyStop:0,step:0},zmscore:{arity:-3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},zpopmax:{arity:-2,flags:["write","fast"],keyStart:1,keyStop:1,step:1},zpopmin:{arity:-2,flags:["write","fast"],keyStart:1,keyStop:1,step:1},zrandmember:{arity:-2,flags:["readonly"],keyStart:1,keyStop:1,step:1},zrange:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},zrangebylex:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},zrangebyscore:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},zrangestore:{arity:-5,flags:["write","denyoom"],keyStart:1,keyStop:2,step:1},zrank:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},zrem:{arity:-3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},zremrangebylex:{arity:4,flags:["write"],keyStart:1,keyStop:1,step:1},zremrangebyrank:{arity:4,flags:["write"],keyStart:1,keyStop:1,step:1},zremrangebyscore:{arity:4,flags:["write"],keyStart:1,keyStop:1,step:1},zrevrange:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},zrevrangebylex:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},zrevrangebyscore:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},zrevrank:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},zscan:{arity:-3,flags:["readonly"],keyStart:1,keyStop:1,step:1},zscore:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},zunion:{arity:-3,flags:["readonly","movablekeys"],keyStart:0,keyStop:0,step:0},zunionstore:{arity:-4,flags:["write","denyoom","movablekeys"],keyStart:1,keyStop:1,step:1}}});var xt=y(fe=>{"use strict";var Hc=fe&&fe.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(fe,"__esModule",{value:!0});fe.getKeyIndexes=fe.hasFlag=fe.exists=fe.list=void 0;var pr=Hc(yi());fe.list=Object.keys(pr.default);var is={};fe.list.forEach(e=>{is[e]=pr.default[e].flags.reduce(function(t,r){return t[r]=!0,t},{})});function zc(e){return!!pr.default[e]}fe.exists=zc;function Xc(e,t){if(!is[e])throw new Error("Unknown command "+e);return!!is[e][t]}fe.hasFlag=Xc;function Kc(e,t,r){let s=pr.default[e];if(!s)throw new Error("Unknown command "+e);if(!Array.isArray(t))throw new Error("Expect args to be an array");let n=[],i=!!(r&&r.parseExternalKey),o=(l,c)=>{let f=[],u=Number(l[c]);for(let d=0;d<u;d++)f.push(d+c+1);return f},a=(l,c,f)=>{for(let u=c;u<l.length-1;u+=1)if(String(l[u]).toLowerCase()===f.toLowerCase())return u+1;return null};switch(e){case"zunionstore":case"zinterstore":case"zdiffstore":n.push(0,...o(t,1));break;case"eval":case"evalsha":case"eval_ro":case"evalsha_ro":case"fcall":case"fcall_ro":case"blmpop":case"bzmpop":n.push(...o(t,1));break;case"sintercard":case"lmpop":case"zunion":case"zinter":case"zmpop":case"zintercard":case"zdiff":{n.push(...o(t,0));break}case"georadius":{n.push(0);let l=a(t,5,"STORE");l&&n.push(l);let c=a(t,5,"STOREDIST");c&&n.push(c);break}case"georadiusbymember":{n.push(0);let l=a(t,4,"STORE");l&&n.push(l);let c=a(t,4,"STOREDIST");c&&n.push(c);break}case"sort":case"sort_ro":n.push(0);for(let l=1;l<t.length-1;l++){let c=t[l];if(typeof c!="string")continue;let f=c.toUpperCase();f==="GET"?(l+=1,c=t[l],c!=="#"&&(i?n.push([l,gi(c)]):n.push(l))):f==="BY"?(l+=1,i?n.push([l,gi(t[l])]):n.push(l)):f==="STORE"&&(l+=1,n.push(l))}break;case"migrate":if(t[2]==="")for(let l=5;l<t.length-1;l++){let c=t[l];if(typeof c=="string"&&c.toUpperCase()==="KEYS"){for(let f=l+1;f<t.length;f++)n.push(f);break}}else n.push(2);break;case"xreadgroup":case"xread":for(let l=e==="xread"?0:3;l<t.length-1;l++)if(String(t[l]).toUpperCase()==="STREAMS"){for(let c=l+1;c<=l+(t.length-1-l)/2;c++)n.push(c);break}break;default:if(s.step>0){let l=s.keyStart-1,c=s.keyStop>0?s.keyStop:t.length+s.keyStop+1;for(let f=l;f<c;f+=s.step)n.push(f)}break}return n}fe.getKeyIndexes=Kc;function gi(e){typeof e!="string"&&(e=String(e));let t=e.indexOf("->");return t===-1?e.length:t}});var bi=y(Ze=>{"use strict";Object.defineProperty(Ze,"__esModule",{value:!0});Ze.tryCatch=Ze.errorObj=void 0;Ze.errorObj={e:{}};var os;function Vc(e,t){try{let r=os;return os=null,r.apply(this,arguments)}catch(r){return Ze.errorObj.e=r,Ze.errorObj}}function Qc(e){return os=e,Vc}Ze.tryCatch=Qc});var et=y(as=>{"use strict";Object.defineProperty(as,"__esModule",{value:!0});var It=bi();function Si(e){setTimeout(function(){throw e},0)}function Yc(e,t,r){return typeof t=="function"&&e.then(s=>{let n;r!==void 0&&Object(r).spread&&Array.isArray(s)?n=It.tryCatch(t).apply(void 0,[null].concat(s)):n=s===void 0?It.tryCatch(t)(null):It.tryCatch(t)(null,s),n===It.errorObj&&Si(n.e)},s=>{if(!s){let i=new Error(s+"");Object.assign(i,{cause:s}),s=i}let n=It.tryCatch(t)(s);n===It.errorObj&&Si(n.e)}),e}as.default=Yc});var Ei=y((om,Ai)=>{"use strict";var _i=require("assert"),Kt=require("util");function Tt(e){Object.defineProperty(this,"message",{value:e||"",configurable:!0,writable:!0}),Error.captureStackTrace(this,this.constructor)}Kt.inherits(Tt,Error);Object.defineProperty(Tt.prototype,"name",{value:"RedisError",configurable:!0,writable:!0});function ls(e,t,r){_i(t),_i.strictEqual(typeof r,"number"),Object.defineProperty(this,"message",{value:e||"",configurable:!0,writable:!0});let s=Error.stackTraceLimit;Error.stackTraceLimit=2,Error.captureStackTrace(this,this.constructor),Error.stackTraceLimit=s,this.offset=r,this.buffer=t}Kt.inherits(ls,Tt);Object.defineProperty(ls.prototype,"name",{value:"ParserError",configurable:!0,writable:!0});function cs(e){Object.defineProperty(this,"message",{value:e||"",configurable:!0,writable:!0});let t=Error.stackTraceLimit;Error.stackTraceLimit=2,Error.captureStackTrace(this,this.constructor),Error.stackTraceLimit=t}Kt.inherits(cs,Tt);Object.defineProperty(cs.prototype,"name",{value:"ReplyError",configurable:!0,writable:!0});function mr(e){Object.defineProperty(this,"message",{value:e||"",configurable:!0,writable:!0}),Error.captureStackTrace(this,this.constructor)}Kt.inherits(mr,Tt);Object.defineProperty(mr.prototype,"name",{value:"AbortError",configurable:!0,writable:!0});function us(e){Object.defineProperty(this,"message",{value:e||"",configurable:!0,writable:!0}),Error.captureStackTrace(this,this.constructor)}Kt.inherits(us,mr);Object.defineProperty(us.prototype,"name",{value:"InterruptError",configurable:!0,writable:!0});Ai.exports={RedisError:Tt,ParserError:ls,ReplyError:cs,AbortError:mr,InterruptError:us}});var ki=y((am,Ci)=>{"use strict";var wi=require("assert"),Nt=class extends Error{get name(){return this.constructor.name}},fs=class extends Nt{constructor(t,r,s){wi(r),wi.strictEqual(typeof s,"number");let n=Error.stackTraceLimit;Error.stackTraceLimit=2,super(t),Error.stackTraceLimit=n,this.offset=s,this.buffer=r}get name(){return this.constructor.name}},ds=class extends Nt{constructor(t){let r=Error.stackTraceLimit;Error.stackTraceLimit=2,super(t),Error.stackTraceLimit=r}get name(){return this.constructor.name}},yr=class extends Nt{get name(){return this.constructor.name}},hs=class extends yr{get name(){return this.constructor.name}};Ci.exports={RedisError:Nt,ParserError:fs,ReplyError:ds,AbortError:yr,InterruptError:hs}});var pt=y((lm,Ri)=>{"use strict";var Wc=process.version.charCodeAt(1)<55&&process.version.charCodeAt(2)===46?Ei():ki();Ri.exports=Wc});var gr=y((cm,ps)=>{var Oi=[0,4129,8258,12387,16516,20645,24774,28903,33032,37161,41290,45419,49548,53677,57806,61935,4657,528,12915,8786,21173,17044,29431,25302,37689,33560,45947,41818,54205,50076,62463,58334,9314,13379,1056,5121,25830,29895,17572,21637,42346,46411,34088,38153,58862,62927,50604,54669,13907,9842,5649,1584,30423,26358,22165,18100,46939,42874,38681,34616,63455,59390,55197,51132,18628,22757,26758,30887,2112,6241,10242,14371,51660,55789,59790,63919,35144,39273,43274,47403,23285,19156,31415,27286,6769,2640,14899,10770,56317,52188,64447,60318,39801,35672,47931,43802,27814,31879,19684,23749,11298,15363,3168,7233,60846,64911,52716,56781,44330,48395,36200,40265,32407,28342,24277,20212,15891,11826,7761,3696,65439,61374,57309,53244,48923,44858,40793,36728,37256,33193,45514,41451,53516,49453,61774,57711,4224,161,12482,8419,20484,16421,28742,24679,33721,37784,41979,46042,49981,54044,58239,62302,689,4752,8947,13010,16949,21012,25207,29270,46570,42443,38312,34185,62830,58703,54572,50445,13538,9411,5280,1153,29798,25671,21540,17413,42971,47098,34713,38840,59231,63358,50973,55100,9939,14066,1681,5808,26199,30326,17941,22068,55628,51565,63758,59695,39368,35305,47498,43435,22596,18533,30726,26663,6336,2273,14466,10403,52093,56156,60223,64286,35833,39896,43963,48026,19061,23124,27191,31254,2801,6864,10931,14994,64814,60687,56684,52557,48554,44427,40424,36297,31782,27655,23652,19525,15522,11395,7392,3265,61215,65342,53085,57212,44955,49082,36825,40952,28183,32310,20053,24180,11923,16050,3793,7920],Jc=function(t){for(var r,s=0,n=0,i=[],o=t.length;s<o;s++)r=t.charCodeAt(s),r<128?i[n++]=r:r<2048?(i[n++]=r>>6|192,i[n++]=r&63|128):(r&64512)===55296&&s+1<t.length&&(t.charCodeAt(s+1)&64512)===56320?(r=65536+((r&1023)<<10)+(t.charCodeAt(++s)&1023),i[n++]=r>>18|240,i[n++]=r>>12&63|128,i[n++]=r>>6&63|128,i[n++]=r&63|128):(i[n++]=r>>12|224,i[n++]=r>>6&63|128,i[n++]=r&63|128);return i},vi=ps.exports=function(t){for(var r,s=0,n=-1,i=0,o=0,a=typeof t=="string"?Jc(t):t,l=a.length;s<l;){if(r=a[s++],n===-1)r===123&&(n=s);else if(r!==125)o=Oi[(r^o>>8)&255]^o<<8;else if(s-1!==n)return o&16383;i=Oi[(r^i>>8)&255]^i<<8}return i&16383};ps.exports.generateMulti=function(t){for(var r=1,s=t.length,n=vi(t[0]);r<s;)if(vi(t[r++])!==n)return-1;return n}});var Li=y((um,Bi)=>{var Ii=9007199254740991,Zc="[object Arguments]",eu="[object Function]",tu="[object GeneratorFunction]",ru=/^(?:0|[1-9]\d*)$/;function Ti(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function su(e,t){for(var r=-1,s=Array(e);++r<e;)s[r]=t(r);return s}var Vt=Object.prototype,Qt=Vt.hasOwnProperty,Ni=Vt.toString,nu=Vt.propertyIsEnumerable,xi=Math.max;function iu(e,t){var r=mu(e)||pu(e)?su(e.length,String):[],s=r.length,n=!!s;for(var i in e)(t||Qt.call(e,i))&&!(n&&(i=="length"||Di(i,s)))&&r.push(i);return r}function ou(e,t,r,s){return e===void 0||ms(e,Vt[r])&&!Qt.call(s,r)?t:e}function au(e,t,r){var s=e[t];(!(Qt.call(e,t)&&ms(s,r))||r===void 0&&!(t in e))&&(e[t]=r)}function lu(e){if(!gs(e))return hu(e);var t=du(e),r=[];for(var s in e)s=="constructor"&&(t||!Qt.call(e,s))||r.push(s);return r}function Mi(e,t){return t=xi(t===void 0?e.length-1:t,0),function(){for(var r=arguments,s=-1,n=xi(r.length-t,0),i=Array(n);++s<n;)i[s]=r[t+s];s=-1;for(var o=Array(t+1);++s<t;)o[s]=r[s];return o[t]=i,Ti(e,this,o)}}function cu(e,t,r,s){r||(r={});for(var n=-1,i=t.length;++n<i;){var o=t[n],a=s?s(r[o],e[o],o,r,e):void 0;au(r,o,a===void 0?e[o]:a)}return r}function uu(e){return Mi(function(t,r){var s=-1,n=r.length,i=n>1?r[n-1]:void 0,o=n>2?r[2]:void 0;for(i=e.length>3&&typeof i=="function"?(n--,i):void 0,o&&fu(r[0],r[1],o)&&(i=n<3?void 0:i,n=1),t=Object(t);++s<n;){var a=r[s];a&&e(t,a,s,i)}return t})}function Di(e,t){return t=t??Ii,!!t&&(typeof e=="number"||ru.test(e))&&e>-1&&e%1==0&&e<t}function fu(e,t,r){if(!gs(r))return!1;var s=typeof t;return(s=="number"?ys(r)&&Di(t,r.length):s=="string"&&t in r)?ms(r[t],e):!1}function du(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||Vt;return e===r}function hu(e){var t=[];if(e!=null)for(var r in Object(e))t.push(r);return t}function ms(e,t){return e===t||e!==e&&t!==t}function pu(e){return yu(e)&&Qt.call(e,"callee")&&(!nu.call(e,"callee")||Ni.call(e)==Zc)}var mu=Array.isArray;function ys(e){return e!=null&&bu(e.length)&&!gu(e)}function yu(e){return Su(e)&&ys(e)}function gu(e){var t=gs(e)?Ni.call(e):"";return t==eu||t==tu}function bu(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Ii}function gs(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function Su(e){return!!e&&typeof e=="object"}var _u=uu(function(e,t,r,s){cu(t,Eu(t),e,s)}),Au=Mi(function(e){return e.push(void 0,ou),Ti(_u,void 0,e)});function Eu(e){return ys(e)?iu(e,!0):lu(e)}Bi.exports=Au});var qi=y((fm,$i)=>{var wu=9007199254740991,Cu="[object Arguments]",ku="[object Function]",Ru="[object GeneratorFunction]",bs=Object.prototype,Ou=bs.hasOwnProperty,Pi=bs.toString,vu=bs.propertyIsEnumerable;function xu(e){return Tu(e)&&Ou.call(e,"callee")&&(!vu.call(e,"callee")||Pi.call(e)==Cu)}function Iu(e){return e!=null&&Mu(e.length)&&!Nu(e)}function Tu(e){return Bu(e)&&Iu(e)}function Nu(e){var t=Du(e)?Pi.call(e):"";return t==ku||t==Ru}function Mu(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=wu}function Du(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function Bu(e){return!!e&&typeof e=="object"}$i.exports=xu});var br=y(tt=>{"use strict";Object.defineProperty(tt,"__esModule",{value:!0});tt.isArguments=tt.defaults=tt.noop=void 0;var Lu=Li();tt.defaults=Lu;var Pu=qi();tt.isArguments=Pu;function $u(){}tt.noop=$u});var Fi=y((hm,ji)=>{var Mt=1e3,Dt=Mt*60,Bt=Dt*60,mt=Bt*24,qu=mt*7,ju=mt*365.25;ji.exports=function(e,t){t=t||{};var r=typeof e;if(r==="string"&&e.length>0)return Fu(e);if(r==="number"&&isFinite(e))return t.long?Gu(e):Uu(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function Fu(e){if(e=String(e),!(e.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]),s=(t[2]||"ms").toLowerCase();switch(s){case"years":case"year":case"yrs":case"yr":case"y":return r*ju;case"weeks":case"week":case"w":return r*qu;case"days":case"day":case"d":return r*mt;case"hours":case"hour":case"hrs":case"hr":case"h":return r*Bt;case"minutes":case"minute":case"mins":case"min":case"m":return r*Dt;case"seconds":case"second":case"secs":case"sec":case"s":return r*Mt;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function Uu(e){var t=Math.abs(e);return t>=mt?Math.round(e/mt)+"d":t>=Bt?Math.round(e/Bt)+"h":t>=Dt?Math.round(e/Dt)+"m":t>=Mt?Math.round(e/Mt)+"s":e+"ms"}function Gu(e){var t=Math.abs(e);return t>=mt?Sr(e,t,mt,"day"):t>=Bt?Sr(e,t,Bt,"hour"):t>=Dt?Sr(e,t,Dt,"minute"):t>=Mt?Sr(e,t,Mt,"second"):e+" ms"}function Sr(e,t,r,s){var n=t>=r*1.5;return Math.round(e/r)+" "+s+(n?"s":"")}});var Ss=y((pm,Ui)=>{function Hu(e){r.debug=r,r.default=r,r.coerce=l,r.disable=i,r.enable=n,r.enabled=o,r.humanize=Fi(),r.destroy=c,Object.keys(e).forEach(f=>{r[f]=e[f]}),r.names=[],r.skips=[],r.formatters={};function t(f){let u=0;for(let d=0;d<f.length;d++)u=(u<<5)-u+f.charCodeAt(d),u|=0;return r.colors[Math.abs(u)%r.colors.length]}r.selectColor=t;function r(f){let u,d=null,p,m;function g(...S){if(!g.enabled)return;let A=g,v=Number(new Date),z=v-(u||v);A.diff=z,A.prev=u,A.curr=v,u=v,S[0]=r.coerce(S[0]),typeof S[0]!="string"&&S.unshift("%O");let X=0;S[0]=S[0].replace(/%([a-zA-Z%])/g,(N,j)=>{if(N==="%%")return"%";X++;let ue=r.formatters[j];if(typeof ue=="function"){let qe=S[X];N=ue.call(A,qe),S.splice(X,1),X--}return N}),r.formatArgs.call(A,S),(A.log||r.log).apply(A,S)}return g.namespace=f,g.useColors=r.useColors(),g.color=r.selectColor(f),g.extend=s,g.destroy=r.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>d!==null?d:(p!==r.namespaces&&(p=r.namespaces,m=r.enabled(f)),m),set:S=>{d=S}}),typeof r.init=="function"&&r.init(g),g}function s(f,u){let d=r(this.namespace+(typeof u>"u"?":":u)+f);return d.log=this.log,d}function n(f){r.save(f),r.namespaces=f,r.names=[],r.skips=[];let u,d=(typeof f=="string"?f:"").split(/[\s,]+/),p=d.length;for(u=0;u<p;u++)d[u]&&(f=d[u].replace(/\*/g,".*?"),f[0]==="-"?r.skips.push(new RegExp("^"+f.slice(1)+"$")):r.names.push(new RegExp("^"+f+"$")))}function i(){let f=[...r.names.map(a),...r.skips.map(a).map(u=>"-"+u)].join(",");return r.enable(""),f}function o(f){if(f[f.length-1]==="*")return!0;let u,d;for(u=0,d=r.skips.length;u<d;u++)if(r.skips[u].test(f))return!1;for(u=0,d=r.names.length;u<d;u++)if(r.names[u].test(f))return!0;return!1}function a(f){return f.toString().substring(2,f.toString().length-2).replace(/\.\*\?$/,"*")}function l(f){return f instanceof Error?f.stack||f.message:f}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}Ui.exports=Hu});var Gi=y((de,_r)=>{de.formatArgs=Xu;de.save=Ku;de.load=Vu;de.useColors=zu;de.storage=Qu();de.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();de.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function zu(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Xu(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+_r.exports.humanize(this.diff),!this.useColors)return;let t="color: "+this.color;e.splice(1,0,t,"color: inherit");let r=0,s=0;e[0].replace(/%[a-zA-Z%]/g,n=>{n!=="%%"&&(r++,n==="%c"&&(s=r))}),e.splice(s,0,t)}de.log=console.debug||console.log||(()=>{});function Ku(e){try{e?de.storage.setItem("debug",e):de.storage.removeItem("debug")}catch{}}function Vu(){let e;try{e=de.storage.getItem("debug")}catch{}return!e&&typeof process<"u"&&"env"in process&&(e=process.env.DEBUG),e}function Qu(){try{return localStorage}catch{}}_r.exports=Ss()(de);var{formatters:Yu}=_r.exports;Yu.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}});var zi=y((mm,Hi)=>{"use strict";Hi.exports=(e,t=process.argv)=>{let r=e.startsWith("-")?"":e.length===1?"-":"--",s=t.indexOf(r+e),n=t.indexOf("--");return s!==-1&&(n===-1||s<n)}});var Vi=y((ym,Ki)=>{"use strict";var Wu=require("os"),Xi=require("tty"),ge=zi(),{env:K}=process,Ar;ge("no-color")||ge("no-colors")||ge("color=false")||ge("color=never")?Ar=0:(ge("color")||ge("colors")||ge("color=true")||ge("color=always"))&&(Ar=1);function Ju(){if("FORCE_COLOR"in K)return K.FORCE_COLOR==="true"?1:K.FORCE_COLOR==="false"?0:K.FORCE_COLOR.length===0?1:Math.min(Number.parseInt(K.FORCE_COLOR,10),3)}function Zu(e){return e===0?!1:{level:e,hasBasic:!0,has256:e>=2,has16m:e>=3}}function ef(e,{streamIsTTY:t,sniffFlags:r=!0}={}){let s=Ju();s!==void 0&&(Ar=s);let n=r?Ar:s;if(n===0)return 0;if(r){if(ge("color=16m")||ge("color=full")||ge("color=truecolor"))return 3;if(ge("color=256"))return 2}if(e&&!t&&n===void 0)return 0;let i=n||0;if(K.TERM==="dumb")return i;if(process.platform==="win32"){let o=Wu.release().split(".");return Number(o[0])>=10&&Number(o[2])>=10586?Number(o[2])>=14931?3:2:1}if("CI"in K)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE","DRONE"].some(o=>o in K)||K.CI_NAME==="codeship"?1:i;if("TEAMCITY_VERSION"in K)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(K.TEAMCITY_VERSION)?1:0;if(K.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in K){let o=Number.parseInt((K.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(K.TERM_PROGRAM){case"iTerm.app":return o>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(K.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(K.TERM)||"COLORTERM"in K?1:i}function _s(e,t={}){let r=ef(e,{streamIsTTY:e&&e.isTTY,...t});return Zu(r)}Ki.exports={supportsColor:_s,stdout:_s({isTTY:Xi.isatty(1)}),stderr:_s({isTTY:Xi.isatty(2)})}});var Yi=y((Q,wr)=>{var tf=require("tty"),Er=require("util");Q.init=cf;Q.log=of;Q.formatArgs=sf;Q.save=af;Q.load=lf;Q.useColors=rf;Q.destroy=Er.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");Q.colors=[6,2,3,4,5,1];try{let e=Vi();e&&(e.stderr||e).level>=2&&(Q.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}Q.inspectOpts=Object.keys(process.env).filter(e=>/^debug_/i.test(e)).reduce((e,t)=>{let r=t.substring(6).toLowerCase().replace(/_([a-z])/g,(n,i)=>i.toUpperCase()),s=process.env[t];return/^(yes|on|true|enabled)$/i.test(s)?s=!0:/^(no|off|false|disabled)$/i.test(s)?s=!1:s==="null"?s=null:s=Number(s),e[r]=s,e},{});function rf(){return"colors"in Q.inspectOpts?!!Q.inspectOpts.colors:tf.isatty(process.stderr.fd)}function sf(e){let{namespace:t,useColors:r}=this;if(r){let s=this.color,n="\x1B[3"+(s<8?s:"8;5;"+s),i=`  ${n};1m${t} \x1B[0m`;e[0]=i+e[0].split(`
`).join(`
`+i),e.push(n+"m+"+wr.exports.humanize(this.diff)+"\x1B[0m")}else e[0]=nf()+t+" "+e[0]}function nf(){return Q.inspectOpts.hideDate?"":new Date().toISOString()+" "}function of(...e){return process.stderr.write(Er.format(...e)+`
`)}function af(e){e?process.env.DEBUG=e:delete process.env.DEBUG}function lf(){return process.env.DEBUG}function cf(e){e.inspectOpts={};let t=Object.keys(Q.inspectOpts);for(let r=0;r<t.length;r++)e.inspectOpts[t[r]]=Q.inspectOpts[t[r]]}wr.exports=Ss()(Q);var{formatters:Qi}=wr.exports;Qi.o=function(e){return this.inspectOpts.colors=this.useColors,Er.inspect(e,this.inspectOpts).split(`
`).map(t=>t.trim()).join(" ")};Qi.O=function(e){return this.inspectOpts.colors=this.useColors,Er.inspect(e,this.inspectOpts)}});var Wi=y((gm,As)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?As.exports=Gi():As.exports=Yi()});var eo=y(je=>{"use strict";Object.defineProperty(je,"__esModule",{value:!0});je.genRedactedString=je.getStringValue=je.MAX_ARGUMENT_LENGTH=void 0;var uf=Wi(),Es=200;je.MAX_ARGUMENT_LENGTH=Es;var ff="ioredis";function Ji(e){if(e!==null)switch(typeof e){case"boolean":return;case"number":return;case"object":if(Buffer.isBuffer(e))return e.toString("hex");if(Array.isArray(e))return e.join(",");try{return JSON.stringify(e)}catch{return}case"string":return e}}je.getStringValue=Ji;function Zi(e,t){let{length:r}=e;return r<=t?e:e.slice(0,t)+' ... <REDACTED full-length="'+r+'">'}je.genRedactedString=Zi;function df(e){let t=(0,uf.default)(`${ff}:${e}`);function r(...s){if(t.enabled){for(let n=1;n<s.length;n++){let i=Ji(s[n]);typeof i=="string"&&i.length>Es&&(s[n]=Zi(i,Es))}return t.apply(null,s)}}return Object.defineProperties(r,{namespace:{get(){return t.namespace}},enabled:{get(){return t.enabled}},destroy:{get(){return t.destroy}},log:{get(){return t.log},set(s){t.log=s}}}),r}je.default=df});var ro=y(ws=>{"use strict";Object.defineProperty(ws,"__esModule",{value:!0});var to=`-----BEGIN CERTIFICATE-----
MIIDTzCCAjegAwIBAgIJAKSVpiDswLcwMA0GCSqGSIb3DQEBBQUAMD4xFjAUBgNV
BAoMDUdhcmFudGlhIERhdGExJDAiBgNVBAMMG1NTTCBDZXJ0aWZpY2F0aW9uIEF1
dGhvcml0eTAeFw0xMzEwMDExMjE0NTVaFw0yMzA5MjkxMjE0NTVaMD4xFjAUBgNV
BAoMDUdhcmFudGlhIERhdGExJDAiBgNVBAMMG1NTTCBDZXJ0aWZpY2F0aW9uIEF1
dGhvcml0eTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBALZqkh/DczWP
JnxnHLQ7QL0T4B4CDKWBKCcisriGbA6ZePWVNo4hfKQC6JrzfR+081NeD6VcWUiz
rmd+jtPhIY4c+WVQYm5PKaN6DT1imYdxQw7aqO5j2KUCEh/cznpLxeSHoTxlR34E
QwF28Wl3eg2vc5ct8LjU3eozWVk3gb7alx9mSA2SgmuX5lEQawl++rSjsBStemY2
BDwOpAMXIrdEyP/cVn8mkvi/BDs5M5G+09j0gfhyCzRWMQ7Hn71u1eolRxwVxgi3
TMn+/vTaFSqxKjgck6zuAYjBRPaHe7qLxHNr1So/Mc9nPy+3wHebFwbIcnUojwbp
4nctkWbjb2cCAwEAAaNQME4wHQYDVR0OBBYEFP1whtcrydmW3ZJeuSoKZIKjze3w
MB8GA1UdIwQYMBaAFP1whtcrydmW3ZJeuSoKZIKjze3wMAwGA1UdEwQFMAMBAf8w
DQYJKoZIhvcNAQEFBQADggEBAG2erXhwRAa7+ZOBs0B6X57Hwyd1R4kfmXcs0rta
lbPpvgULSiB+TCbf3EbhJnHGyvdCY1tvlffLjdA7HJ0PCOn+YYLBA0pTU/dyvrN6
Su8NuS5yubnt9mb13nDGYo1rnt0YRfxN+8DM3fXIVr038A30UlPX2Ou1ExFJT0MZ
uFKY6ZvLdI6/1cbgmguMlAhM+DhKyV6Sr5699LM3zqeI816pZmlREETYkGr91q7k
BpXJu/dtHaGxg1ZGu6w/PCsYGUcECWENYD4VQPd8N32JjOfu6vEgoEAwfPP+3oGp
Z4m3ewACcWOAenqflb+cQYC4PsF7qbXDmRaWrbKntOlZ3n0=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIGMTCCBBmgAwIBAgICEAAwDQYJKoZIhvcNAQELBQAwajELMAkGA1UEBhMCVVMx
CzAJBgNVBAgMAkNBMQswCQYDVQQHDAJDQTESMBAGA1UECgwJUmVkaXNMYWJzMS0w
KwYDVQQDDCRSZWRpc0xhYnMgUm9vdCBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkwHhcN
MTgwMjI1MTUzNzM3WhcNMjgwMjIzMTUzNzM3WjBfMQswCQYDVQQGEwJVUzELMAkG
A1UECAwCQ0ExEjAQBgNVBAoMCVJlZGlzTGFiczEvMC0GA1UEAwwmUkNQIEludGVy
bWVkaWF0ZSBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkwggIiMA0GCSqGSIb3DQEBAQUA
A4ICDwAwggIKAoICAQDf9dqbxc8Bq7Ctq9rWcxrGNKKHivqLAFpPq02yLPx6fsOv
Tq7GsDChAYBBc4v7Y2Ap9RD5Vs3dIhEANcnolf27QwrG9RMnnvzk8pCvp1o6zSU4
VuOE1W66/O1/7e2rVxyrnTcP7UgK43zNIXu7+tiAqWsO92uSnuMoGPGpeaUm1jym
hjWKtkAwDFSqvHY+XL5qDVBEjeUe+WHkYUg40cAXjusAqgm2hZt29c2wnVrxW25W
P0meNlzHGFdA2AC5z54iRiqj57dTfBTkHoBczQxcyw6hhzxZQ4e5I5zOKjXXEhZN
r0tA3YC14CTabKRus/JmZieyZzRgEy2oti64tmLYTqSlAD78pRL40VNoaSYetXLw
hhNsXCHgWaY6d5bLOc/aIQMAV5oLvZQKvuXAF1IDmhPA+bZbpWipp0zagf1P1H3s
UzsMdn2KM0ejzgotbtNlj5TcrVwpmvE3ktvUAuA+hi3FkVx1US+2Gsp5x4YOzJ7u
P1WPk6ShF0JgnJH2ILdj6kttTWwFzH17keSFICWDfH/+kM+k7Y1v3EXMQXE7y0T9
MjvJskz6d/nv+sQhY04xt64xFMGTnZjlJMzfQNi7zWFLTZnDD0lPowq7l3YiPoTT
t5Xky83lu0KZsZBo0WlWaDG00gLVdtRgVbcuSWxpi5BdLb1kRab66JptWjxwXQID
AQABo4HrMIHoMDoGA1UdHwQzMDEwL6AtoCuGKWh0dHBzOi8vcmwtY2Etc2VydmVy
LnJlZGlzbGFicy5jb20vdjEvY3JsMEYGCCsGAQUFBwEBBDowODA2BggrBgEFBQcw
AYYqaHR0cHM6Ly9ybC1jYS1zZXJ2ZXIucmVkaXNsYWJzLmNvbS92MS9vY3NwMB0G
A1UdDgQWBBQHar5OKvQUpP2qWt6mckzToeCOHDAfBgNVHSMEGDAWgBQi42wH6hM4
L2sujEvLM0/u8lRXTzASBgNVHRMBAf8ECDAGAQH/AgEAMA4GA1UdDwEB/wQEAwIB
hjANBgkqhkiG9w0BAQsFAAOCAgEAirEn/iTsAKyhd+pu2W3Z5NjCko4NPU0EYUbr
AP7+POK2rzjIrJO3nFYQ/LLuC7KCXG+2qwan2SAOGmqWst13Y+WHp44Kae0kaChW
vcYLXXSoGQGC8QuFSNUdaeg3RbMDYFT04dOkqufeWVccoHVxyTSg9eD8LZuHn5jw
7QDLiEECBmIJHk5Eeo2TAZrx4Yx6ufSUX5HeVjlAzqwtAqdt99uCJ/EL8bgpWbe+
XoSpvUv0SEC1I1dCAhCKAvRlIOA6VBcmzg5Am12KzkqTul12/VEFIgzqu0Zy2Jbc
AUPrYVu/+tOGXQaijy7YgwH8P8n3s7ZeUa1VABJHcxrxYduDDJBLZi+MjheUDaZ1
jQRHYevI2tlqeSBqdPKG4zBY5lS0GiAlmuze5oENt0P3XboHoZPHiqcK3VECgTVh
/BkJcuudETSJcZDmQ8YfoKfBzRQNg2sv/hwvUv73Ss51Sco8GEt2lD8uEdib1Q6z
zDT5lXJowSzOD5ZA9OGDjnSRL+2riNtKWKEqvtEG3VBJoBzu9GoxbAc7wIZLxmli
iF5a/Zf5X+UXD3s4TMmy6C4QZJpAA2egsSQCnraWO2ULhh7iXMysSkF/nzVfZn43
iqpaB8++9a37hWq14ZmOv0TJIDz//b2+KC4VFXWQ5W5QC6whsjT+OlG4p5ZYG0jo
616pxqo=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIFujCCA6KgAwIBAgIJAJ1aTT1lu2ScMA0GCSqGSIb3DQEBCwUAMGoxCzAJBgNV
BAYTAlVTMQswCQYDVQQIDAJDQTELMAkGA1UEBwwCQ0ExEjAQBgNVBAoMCVJlZGlz
TGFiczEtMCsGA1UEAwwkUmVkaXNMYWJzIFJvb3QgQ2VydGlmaWNhdGUgQXV0aG9y
aXR5MB4XDTE4MDIyNTE1MjA0MloXDTM4MDIyMDE1MjA0MlowajELMAkGA1UEBhMC
VVMxCzAJBgNVBAgMAkNBMQswCQYDVQQHDAJDQTESMBAGA1UECgwJUmVkaXNMYWJz
MS0wKwYDVQQDDCRSZWRpc0xhYnMgUm9vdCBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkw
ggIiMA0GCSqGSIb3DQEBAQUAA4ICDwAwggIKAoICAQDLEjXy7YrbN5Waau5cd6g1
G5C2tMmeTpZ0duFAPxNU4oE3RHS5gGiok346fUXuUxbZ6QkuzeN2/2Z+RmRcJhQY
Dm0ZgdG4x59An1TJfnzKKoWj8ISmoHS/TGNBdFzXV7FYNLBuqZouqePI6ReC6Qhl
pp45huV32Q3a6IDrrvx7Wo5ZczEQeFNbCeCOQYNDdTmCyEkHqc2AGo8eoIlSTutT
ULOC7R5gzJVTS0e1hesQ7jmqHjbO+VQS1NAL4/5K6cuTEqUl+XhVhPdLWBXJQ5ag
54qhX4v+ojLzeU1R/Vc6NjMvVtptWY6JihpgplprN0Yh2556ewcXMeturcKgXfGJ
xeYzsjzXerEjrVocX5V8BNrg64NlifzTMKNOOv4fVZszq1SIHR8F9ROrqiOdh8iC
JpUbLpXH9hWCSEO6VRMB2xJoKu3cgl63kF30s77x7wLFMEHiwsQRKxooE1UhgS9K
2sO4TlQ1eWUvFvHSTVDQDlGQ6zu4qjbOpb3Q8bQwoK+ai2alkXVR4Ltxe9QlgYK3
StsnPhruzZGA0wbXdpw0bnM+YdlEm5ffSTpNIfgHeaa7Dtb801FtA71ZlH7A6TaI
SIQuUST9EKmv7xrJyx0W1pGoPOLw5T029aTjnICSLdtV9bLwysrLhIYG5bnPq78B
cS+jZHFGzD7PUVGQD01nOQIDAQABo2MwYTAdBgNVHQ4EFgQUIuNsB+oTOC9rLoxL
yzNP7vJUV08wHwYDVR0jBBgwFoAUIuNsB+oTOC9rLoxLyzNP7vJUV08wDwYDVR0T
AQH/BAUwAwEB/zAOBgNVHQ8BAf8EBAMCAYYwDQYJKoZIhvcNAQELBQADggIBAHfg
z5pMNUAKdMzK1aS1EDdK9yKz4qicILz5czSLj1mC7HKDRy8cVADUxEICis++CsCu
rYOvyCVergHQLREcxPq4rc5Nq1uj6J6649NEeh4WazOOjL4ZfQ1jVznMbGy+fJm3
3Hoelv6jWRG9iqeJZja7/1s6YC6bWymI/OY1e4wUKeNHAo+Vger7MlHV+RuabaX+
hSJ8bJAM59NCM7AgMTQpJCncrcdLeceYniGy5Q/qt2b5mJkQVkIdy4TPGGB+AXDJ
D0q3I/JDRkDUFNFdeW0js7fHdsvCR7O3tJy5zIgEV/o/BCkmJVtuwPYOrw/yOlKj
TY/U7ATAx9VFF6/vYEOMYSmrZlFX+98L6nJtwDqfLB5VTltqZ4H/KBxGE3IRSt9l
FXy40U+LnXzhhW+7VBAvyYX8GEXhHkKU8Gqk1xitrqfBXY74xKgyUSTolFSfFVgj
mcM/X4K45bka+qpkj7Kfv/8D4j6aZekwhN2ly6hhC1SmQ8qjMjpG/mrWOSSHZFmf
ybu9iD2AYHeIOkshIl6xYIa++Q/00/vs46IzAbQyriOi0XxlSMMVtPx0Q3isp+ji
n8Mq9eOuxYOEQ4of8twUkUDd528iwGtEdwf0Q01UyT84S62N8AySl1ZBKXJz6W4F
UhWfa/HQYOAPDdEjNgnVwLI23b8t0TozyCWw7q8h
-----END CERTIFICATE-----

-----BEGIN CERTIFICATE-----
MIIEjzCCA3egAwIBAgIQe55B/ALCKJDZtdNT8kD6hTANBgkqhkiG9w0BAQsFADBM
MSAwHgYDVQQLExdHbG9iYWxTaWduIFJvb3QgQ0EgLSBSMzETMBEGA1UEChMKR2xv
YmFsU2lnbjETMBEGA1UEAxMKR2xvYmFsU2lnbjAeFw0yMjAxMjYxMjAwMDBaFw0y
NTAxMjYwMDAwMDBaMFgxCzAJBgNVBAYTAkJFMRkwFwYDVQQKExBHbG9iYWxTaWdu
IG52LXNhMS4wLAYDVQQDEyVHbG9iYWxTaWduIEF0bGFzIFIzIE9WIFRMUyBDQSAy
MDIyIFEyMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAmGmg1LW9b7Lf
8zDD83yBDTEkt+FOxKJZqF4veWc5KZsQj9HfnUS2e5nj/E+JImlGPsQuoiosLuXD
BVBNAMcUFa11buFMGMeEMwiTmCXoXRrXQmH0qjpOfKgYc5gHG3BsRGaRrf7VR4eg
ofNMG9wUBw4/g/TT7+bQJdA4NfE7Y4d5gEryZiBGB/swaX6Jp/8MF4TgUmOWmalK
dZCKyb4sPGQFRTtElk67F7vU+wdGcrcOx1tDcIB0ncjLPMnaFicagl+daWGsKqTh
counQb6QJtYHa91KvCfKWocMxQ7OIbB5UARLPmC4CJ1/f8YFm35ebfzAeULYdGXu
jE9CLor0OwIDAQABo4IBXzCCAVswDgYDVR0PAQH/BAQDAgGGMB0GA1UdJQQWMBQG
CCsGAQUFBwMBBggrBgEFBQcDAjASBgNVHRMBAf8ECDAGAQH/AgEAMB0GA1UdDgQW
BBSH5Zq7a7B/t95GfJWkDBpA8HHqdjAfBgNVHSMEGDAWgBSP8Et/qC5FJK5NUPpj
move4t0bvDB7BggrBgEFBQcBAQRvMG0wLgYIKwYBBQUHMAGGImh0dHA6Ly9vY3Nw
Mi5nbG9iYWxzaWduLmNvbS9yb290cjMwOwYIKwYBBQUHMAKGL2h0dHA6Ly9zZWN1
cmUuZ2xvYmFsc2lnbi5jb20vY2FjZXJ0L3Jvb3QtcjMuY3J0MDYGA1UdHwQvMC0w
K6ApoCeGJWh0dHA6Ly9jcmwuZ2xvYmFsc2lnbi5jb20vcm9vdC1yMy5jcmwwIQYD
VR0gBBowGDAIBgZngQwBAgIwDAYKKwYBBAGgMgoBAjANBgkqhkiG9w0BAQsFAAOC
AQEAKRic9/f+nmhQU/wz04APZLjgG5OgsuUOyUEZjKVhNGDwxGTvKhyXGGAMW2B/
3bRi+aElpXwoxu3pL6fkElbX3B0BeS5LoDtxkyiVEBMZ8m+sXbocwlPyxrPbX6mY
0rVIvnuUeBH8X0L5IwfpNVvKnBIilTbcebfHyXkPezGwz7E1yhUULjJFm2bt0SdX
y+4X/WeiiYIv+fTVgZZgl+/2MKIsu/qdBJc3f3TvJ8nz+Eax1zgZmww+RSQWeOj3
15Iw6Z5FX+NwzY/Ab+9PosR5UosSeq+9HhtaxZttXG1nVh+avYPGYddWmiMT90J5
ZgKnO/Fx2hBgTxhOTMYaD312kg==
-----END CERTIFICATE-----

-----BEGIN CERTIFICATE-----
MIIDXzCCAkegAwIBAgILBAAAAAABIVhTCKIwDQYJKoZIhvcNAQELBQAwTDEgMB4G
A1UECxMXR2xvYmFsU2lnbiBSb290IENBIC0gUjMxEzARBgNVBAoTCkdsb2JhbFNp
Z24xEzARBgNVBAMTCkdsb2JhbFNpZ24wHhcNMDkwMzE4MTAwMDAwWhcNMjkwMzE4
MTAwMDAwWjBMMSAwHgYDVQQLExdHbG9iYWxTaWduIFJvb3QgQ0EgLSBSMzETMBEG
A1UEChMKR2xvYmFsU2lnbjETMBEGA1UEAxMKR2xvYmFsU2lnbjCCASIwDQYJKoZI
hvcNAQEBBQADggEPADCCAQoCggEBAMwldpB5BngiFvXAg7aEyiie/QV2EcWtiHL8
RgJDx7KKnQRfJMsuS+FggkbhUqsMgUdwbN1k0ev1LKMPgj0MK66X17YUhhB5uzsT
gHeMCOFJ0mpiLx9e+pZo34knlTifBtc+ycsmWQ1z3rDI6SYOgxXG71uL0gRgykmm
KPZpO/bLyCiR5Z2KYVc3rHQU3HTgOu5yLy6c+9C7v/U9AOEGM+iCK65TpjoWc4zd
QQ4gOsC0p6Hpsk+QLjJg6VfLuQSSaGjlOCZgdbKfd/+RFO+uIEn8rUAVSNECMWEZ
XriX7613t2Saer9fwRPvm2L7DWzgVGkWqQPabumDk3F2xmmFghcCAwEAAaNCMEAw
DgYDVR0PAQH/BAQDAgEGMA8GA1UdEwEB/wQFMAMBAf8wHQYDVR0OBBYEFI/wS3+o
LkUkrk1Q+mOai97i3Ru8MA0GCSqGSIb3DQEBCwUAA4IBAQBLQNvAUKr+yAzv95ZU
RUm7lgAJQayzE4aGKAczymvmdLm6AC2upArT9fHxD4q/c2dKg8dEe3jgr25sbwMp
jjM5RcOO5LlXbKr8EpbsU8Yt5CRsuZRj+9xTaGdWPoO4zzUhw8lo/s7awlOqzJCK
6fBdRoyV3XpYKBovHd7NADdBj+1EbddTKJd+82cEHhXXipa0095MJ6RMG3NzdvQX
mcIfeg7jLQitChws/zyrVQ4PkX4268NXSb7hLi18YIvDQVETI53O9zJrlAGomecs
Mx86OyXShkDOOyyGeMlhLxS67ttVb9+E7gUJTb0o2HLO02JQZR7rkpeDMdmztcpH
WD9f
-----END CERTIFICATE-----`,hf={RedisCloudFixed:{ca:to},RedisCloudFlexible:{ca:to}};ws.default=hf});var W=y(C=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0});C.noop=C.defaults=C.Debug=C.zipMap=C.CONNECTION_CLOSED_ERROR_MSG=C.shuffle=C.sample=C.resolveTLSProfile=C.parseURL=C.optimizeErrorStack=C.toArg=C.convertMapToArray=C.convertObjectToArray=C.timeout=C.packObject=C.isInt=C.wrapMultiResult=C.convertBufferToString=void 0;var so=require("url"),Cs=br();Object.defineProperty(C,"defaults",{enumerable:!0,get:function(){return Cs.defaults}});Object.defineProperty(C,"noop",{enumerable:!0,get:function(){return Cs.noop}});var pf=eo();C.Debug=pf.default;var mf=ro();function no(e,t){if(e instanceof Buffer)return e.toString(t);if(Array.isArray(e)){let r=e.length,s=Array(r);for(let n=0;n<r;++n)s[n]=e[n]instanceof Buffer&&t==="utf8"?e[n].toString():no(e[n],t);return s}return e}C.convertBufferToString=no;function yf(e){if(!e)return null;let t=[],r=e.length;for(let s=0;s<r;++s){let n=e[s];n instanceof Error?t.push([n]):t.push([null,n])}return t}C.wrapMultiResult=yf;function io(e){let t=parseFloat(e);return!isNaN(e)&&(t|0)===t}C.isInt=io;function gf(e){let t={},r=e.length;for(let s=1;s<r;s+=2)t[e[s-1]]=e[s];return t}C.packObject=gf;function bf(e,t){let r=null,s=function(){r&&(clearTimeout(r),r=null,e.apply(this,arguments))};return r=setTimeout(s,t,new Error("timeout")),s}C.timeout=bf;function Sf(e){let t=[],r=Object.keys(e);for(let s=0,n=r.length;s<n;s++)t.push(r[s],e[r[s]]);return t}C.convertObjectToArray=Sf;function _f(e){let t=[],r=0;return e.forEach(function(s,n){t[r]=n,t[r+1]=s,r+=2}),t}C.convertMapToArray=_f;function Af(e){return e===null||typeof e>"u"?"":String(e)}C.toArg=Af;function Ef(e,t,r){let s=t.split(`
`),n="",i;for(i=1;i<s.length&&s[i].indexOf(r)!==-1;++i);for(let o=i;o<s.length;++o)n+=`
`+s[o];if(e.stack){let o=e.stack.indexOf(`
`);e.stack=e.stack.slice(0,o)+n}return e}C.optimizeErrorStack=Ef;function wf(e){if(io(e))return{port:e};let t=(0,so.parse)(e,!0,!0);!t.slashes&&e[0]!=="/"&&(e="//"+e,t=(0,so.parse)(e,!0,!0));let r=t.query||{},s={};if(t.auth){let n=t.auth.indexOf(":");s.username=n===-1?t.auth:t.auth.slice(0,n),s.password=n===-1?"":t.auth.slice(n+1)}if(t.pathname&&(t.protocol==="redis:"||t.protocol==="rediss:"?t.pathname.length>1&&(s.db=t.pathname.slice(1)):s.path=t.pathname),t.host&&(s.host=t.hostname),t.port&&(s.port=t.port),typeof r.family=="string"){let n=Number.parseInt(r.family,10);Number.isNaN(n)||(s.family=n)}return(0,Cs.defaults)(s,r),s}C.parseURL=wf;function Cf(e){let t=e?.tls;typeof t=="string"&&(t={profile:t});let r=mf.default[t?.profile];return r&&(t=Object.assign({},r,t),delete t.profile,e=Object.assign({},e,{tls:t})),e}C.resolveTLSProfile=Cf;function kf(e,t=0){let r=e.length;return t>=r?null:e[t+Math.floor(Math.random()*(r-t))]}C.sample=kf;function Rf(e){let t=e.length;for(;t>0;){let r=Math.floor(Math.random()*t);t--,[e[t],e[r]]=[e[r],e[t]]}return e}C.shuffle=Rf;C.CONNECTION_CLOSED_ERROR_MSG="Connection is closed.";function Of(e,t){let r=new Map;return e.forEach((s,n)=>{r.set(s,t[n])}),r}C.zipMap=Of});var Fe=y(Rs=>{"use strict";Object.defineProperty(Rs,"__esModule",{value:!0});var oo=xt(),vf=gr(),xf=et(),yt=W(),se=class{constructor(t,r=[],s={},n){if(this.name=t,this.inTransaction=!1,this.isResolved=!1,this.transformed=!1,this.replyEncoding=s.replyEncoding,this.errorStack=s.errorStack,this.args=r.flat(),this.callback=n,this.initPromise(),s.keyPrefix){let i=s.keyPrefix instanceof Buffer,o=i?s.keyPrefix:null;this._iterateKeys(a=>a instanceof Buffer?(o===null&&(o=Buffer.from(s.keyPrefix)),Buffer.concat([o,a])):i?Buffer.concat([s.keyPrefix,Buffer.from(String(a))]):s.keyPrefix+a)}s.readOnly&&(this.isReadOnly=!0)}static checkFlag(t,r){return!!this.getFlagMap()[t][r]}static setArgumentTransformer(t,r){this._transformer.argument[t]=r}static setReplyTransformer(t,r){this._transformer.reply[t]=r}static getFlagMap(){return this.flagMap||(this.flagMap=Object.keys(se.FLAGS).reduce((t,r)=>(t[r]={},se.FLAGS[r].forEach(s=>{t[r][s]=!0}),t),{})),this.flagMap}getSlot(){if(typeof this.slot>"u"){let t=this.getKeys()[0];this.slot=t==null?null:vf(t)}return this.slot}getKeys(){return this._iterateKeys()}toWritable(t){let r,s="*"+(this.args.length+1)+`\r
$`+Buffer.byteLength(this.name)+`\r
`+this.name+`\r
`;if(this.bufferMode){let n=new ks;n.push(s);for(let i=0;i<this.args.length;++i){let o=this.args[i];o instanceof Buffer?o.length===0?n.push(`$0\r
\r
`):(n.push("$"+o.length+`\r
`),n.push(o),n.push(`\r
`)):n.push("$"+Buffer.byteLength(o)+`\r
`+o+`\r
`)}r=n.toBuffer()}else{r=s;for(let n=0;n<this.args.length;++n){let i=this.args[n];r+="$"+Buffer.byteLength(i)+`\r
`+i+`\r
`}}return r}stringifyArguments(){for(let t=0;t<this.args.length;++t){let r=this.args[t];typeof r=="string"||(r instanceof Buffer?this.bufferMode=!0:this.args[t]=(0,yt.toArg)(r))}}transformReply(t){this.replyEncoding&&(t=(0,yt.convertBufferToString)(t,this.replyEncoding));let r=se._transformer.reply[this.name];return r&&(t=r(t)),t}setTimeout(t){this._commandTimeoutTimer||(this._commandTimeoutTimer=setTimeout(()=>{this.isResolved||this.reject(new Error("Command timed out"))},t))}initPromise(){let t=new Promise((r,s)=>{if(!this.transformed){this.transformed=!0;let n=se._transformer.argument[this.name];n&&(this.args=n(this.args)),this.stringifyArguments()}this.resolve=this._convertValue(r),this.errorStack?this.reject=n=>{s((0,yt.optimizeErrorStack)(n,this.errorStack.stack,__dirname))}:this.reject=s});this.promise=(0,xf.default)(t,this.callback)}_iterateKeys(t=r=>r){if(typeof this.keys>"u"&&(this.keys=[],(0,oo.exists)(this.name))){let r=(0,oo.getKeyIndexes)(this.name,this.args);for(let s of r)this.args[s]=t(this.args[s]),this.keys.push(this.args[s])}return this.keys}_convertValue(t){return r=>{try{let s=this._commandTimeoutTimer;s&&(clearTimeout(s),delete this._commandTimeoutTimer),t(this.transformReply(r)),this.isResolved=!0}catch(s){this.reject(s)}return this.promise}}};Rs.default=se;se.FLAGS={VALID_IN_SUBSCRIBER_MODE:["subscribe","psubscribe","unsubscribe","punsubscribe","ssubscribe","sunsubscribe","ping","quit"],VALID_IN_MONITOR_MODE:["monitor","auth"],ENTER_SUBSCRIBER_MODE:["subscribe","psubscribe","ssubscribe"],EXIT_SUBSCRIBER_MODE:["unsubscribe","punsubscribe","sunsubscribe"],WILL_DISCONNECT:["quit"]};se._transformer={argument:{},reply:{}};var ao=function(e){if(e.length===1){if(e[0]instanceof Map)return(0,yt.convertMapToArray)(e[0]);if(typeof e[0]=="object"&&e[0]!==null)return(0,yt.convertObjectToArray)(e[0])}return e},lo=function(e){if(e.length===2){if(e[1]instanceof Map)return[e[0]].concat((0,yt.convertMapToArray)(e[1]));if(typeof e[1]=="object"&&e[1]!==null)return[e[0]].concat((0,yt.convertObjectToArray)(e[1]))}return e};se.setArgumentTransformer("mset",ao);se.setArgumentTransformer("msetnx",ao);se.setArgumentTransformer("hset",lo);se.setArgumentTransformer("hmset",lo);se.setReplyTransformer("hgetall",function(e){if(Array.isArray(e)){let t={};for(let r=0;r<e.length;r+=2){let s=e[r],n=e[r+1];s in t?Object.defineProperty(t,s,{value:n,configurable:!0,enumerable:!0,writable:!0}):t[s]=n}return t}return e});var ks=class{constructor(){this.length=0,this.items=[]}push(t){this.length+=Buffer.byteLength(t),this.items.push(t)}toBuffer(){let t=Buffer.allocUnsafe(this.length),r=0;for(let s of this.items){let n=Buffer.byteLength(s);Buffer.isBuffer(s)?s.copy(t,r):t.write(s,r,n),r+=n}return t}}});var co=y(Os=>{"use strict";Object.defineProperty(Os,"__esModule",{value:!0});var If=pt(),Cr=class extends If.RedisError{constructor(t,r){super(t),this.lastNodeError=r,Error.captureStackTrace(this,this.constructor)}get name(){return this.constructor.name}};Os.default=Cr;Cr.defaultMessage="Failed to refresh slots cache."});var kr=y(xs=>{"use strict";Object.defineProperty(xs,"__esModule",{value:!0});var Tf=require("stream"),vs=class extends Tf.Readable{constructor(t){super(t),this.opt=t,this._redisCursor="0",this._redisDrained=!1}_read(){if(this._redisDrained){this.push(null);return}let t=[this._redisCursor];this.opt.key&&t.unshift(this.opt.key),this.opt.match&&t.push("MATCH",this.opt.match),this.opt.type&&t.push("TYPE",this.opt.type),this.opt.count&&t.push("COUNT",String(this.opt.count)),this.opt.redis[this.opt.command](t,(r,s)=>{if(r){this.emit("error",r);return}this._redisCursor=s[0]instanceof Buffer?s[0].toString():s[0],this._redisCursor==="0"&&(this._redisDrained=!0),this.push(s[1])})}close(){this._redisDrained=!0}};xs.default=vs});var yo=y(P=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0});P.executeWithAutoPipelining=P.getFirstValueInFlattenedArray=P.shouldUseAutoPipelining=P.notAllowedAutoPipelineCommands=P.kCallbacks=P.kExec=void 0;var fo=br(),Nf=gr(),uo=et();P.kExec=Symbol("exec");P.kCallbacks=Symbol("callbacks");P.notAllowedAutoPipelineCommands=["auth","info","script","quit","cluster","pipeline","multi","subscribe","psubscribe","unsubscribe","unpsubscribe","select"];function ho(e,t){if(e._runningAutoPipelines.has(t)||!e._autoPipelines.has(t))return;e._runningAutoPipelines.add(t);let r=e._autoPipelines.get(t);e._autoPipelines.delete(t);let s=r[P.kCallbacks];r[P.kCallbacks]=null,r.exec(function(n,i){if(e._runningAutoPipelines.delete(t),n)for(let o=0;o<s.length;o++)process.nextTick(s[o],n);else for(let o=0;o<s.length;o++)process.nextTick(s[o],...i[o]);e._autoPipelines.has(t)&&ho(e,t)})}function Mf(e,t,r){return t&&e.options.enableAutoPipelining&&!e.isPipeline&&!P.notAllowedAutoPipelineCommands.includes(r)&&!e.options.autoPipeliningIgnoredCommands.includes(r)}P.shouldUseAutoPipelining=Mf;function po(e){for(let t=0;t<e.length;t++){let r=e[t];if(typeof r=="string")return r;if(Array.isArray(r)||(0,fo.isArguments)(r)){if(r.length===0)continue;return r[0]}let s=[r].flat();if(s.length>0)return s[0]}}P.getFirstValueInFlattenedArray=po;function mo(e,t,r,s,n){if(e.isCluster&&!e.slots.length)return e.status==="wait"&&e.connect().catch(fo.noop),(0,uo.default)(new Promise(function(c,f){e.delayUntilReady(u=>{if(u){f(u);return}mo(e,t,r,s,null).then(c,f)})}),n);let i=e.options.keyPrefix||"",o=e.isCluster?e.slots[Nf(`${i}${po(s)}`)].join(","):"main";if(!e._autoPipelines.has(o)){let c=e.pipeline();c[P.kExec]=!1,c[P.kCallbacks]=[],e._autoPipelines.set(o,c)}let a=e._autoPipelines.get(o);a[P.kExec]||(a[P.kExec]=!0,setImmediate(ho,e,o));let l=new Promise(function(c,f){a[P.kCallbacks].push(function(u,d){if(u){f(u);return}c(d)}),t==="call"&&s.unshift(r),a[t](...s)});return(0,uo.default)(l,n)}P.executeWithAutoPipelining=mo});var go=y(Ts=>{"use strict";Object.defineProperty(Ts,"__esModule",{value:!0});var Df=require("crypto"),Bf=Fe(),Lf=et(),Is=class{constructor(t,r=null,s="",n=!1){this.lua=t,this.numberOfKeys=r,this.keyPrefix=s,this.readOnly=n,this.sha=(0,Df.createHash)("sha1").update(t).digest("hex");let i=this.sha,o=new WeakSet;this.Command=class extends Bf.default{toWritable(l){let c=this.reject;return this.reject=f=>{f.message.indexOf("NOSCRIPT")!==-1&&o.delete(l),c.call(this,f)},o.has(l)?this.name==="eval"&&(this.name="evalsha",this.args[0]=i):(o.add(l),this.name="eval",this.args[0]=t),super.toWritable(l)}}}execute(t,r,s,n){typeof this.numberOfKeys=="number"&&r.unshift(this.numberOfKeys),this.keyPrefix&&(s.keyPrefix=this.keyPrefix),this.readOnly&&(s.readOnly=!0);let i=new this.Command("evalsha",[this.sha,...r],s);return i.promise=i.promise.catch(o=>{if(o.message.indexOf("NOSCRIPT")===-1)throw o;let a=new this.Command("evalsha",[this.sha,...r],s);return(t.isPipeline?t.redis:t).sendCommand(a)}),(0,Lf.default)(i.promise,n),t.sendCommand(i)}};Ts.default=Is});var Or=y(Ms=>{"use strict";Object.defineProperty(Ms,"__esModule",{value:!0});var Pf=xt(),Rr=yo(),$f=Fe(),qf=go(),Ue=class{constructor(){this.options={},this.scriptsSet={},this.addedBuiltinSet=new Set}getBuiltinCommands(){return Ns.slice(0)}createBuiltinCommand(t){return{string:rt(null,t,"utf8"),buffer:rt(null,t,null)}}addBuiltinCommand(t){this.addedBuiltinSet.add(t),this[t]=rt(t,t,"utf8"),this[t+"Buffer"]=rt(t+"Buffer",t,null)}defineCommand(t,r){let s=new qf.default(r.lua,r.numberOfKeys,this.options.keyPrefix,r.readOnly);this.scriptsSet[t]=s,this[t]=bo(t,t,s,"utf8"),this[t+"Buffer"]=bo(t+"Buffer",t,s,null)}sendCommand(t,r,s){throw new Error('"sendCommand" is not implemented')}},Ns=Pf.list.filter(e=>e!=="monitor");Ns.push("sentinel");Ns.forEach(function(e){Ue.prototype[e]=rt(e,e,"utf8"),Ue.prototype[e+"Buffer"]=rt(e+"Buffer",e,null)});Ue.prototype.call=rt("call","utf8");Ue.prototype.callBuffer=rt("callBuffer",null);Ue.prototype.send_command=Ue.prototype.call;function rt(e,t,r){return typeof r>"u"&&(r=t,t=null),function(...s){let n=t||s.shift(),i=s[s.length-1];typeof i=="function"?s.pop():i=void 0;let o={errorStack:this.options.showFriendlyErrorStack?new Error:void 0,keyPrefix:this.options.keyPrefix,replyEncoding:r};return(0,Rr.shouldUseAutoPipelining)(this,e,n)?(0,Rr.executeWithAutoPipelining)(this,e,n,s,i):this.sendCommand(new $f.default(n,s,o,i))}}function bo(e,t,r,s){return function(...n){let i=typeof n[n.length-1]=="function"?n.pop():void 0,o={replyEncoding:s};return this.options.showFriendlyErrorStack&&(o.errorStack=new Error),(0,Rr.shouldUseAutoPipelining)(this,e,t)?(0,Rr.executeWithAutoPipelining)(this,e,t,n,i):r.execute(this,n,o,i)}}Ms.default=Ue});var Ls=y(Bs=>{"use strict";Object.defineProperty(Bs,"__esModule",{value:!0});var Ds=gr(),So=xt(),_o=et(),jf=require("util"),Ff=Fe(),Uf=W(),Gf=Or();function Hf(e,t){let r=Ds(t[0]),s=e._groupsBySlot[r];for(let n=1;n<t.length;n++)if(e._groupsBySlot[Ds(t[n])]!==s)return-1;return r}var st=class extends Gf.default{constructor(t){super(),this.redis=t,this.isPipeline=!0,this.replyPending=0,this._queue=[],this._result=[],this._transactions=0,this._shaToScript={},this.isCluster=this.redis.constructor.name==="Cluster"||this.redis.isCluster,this.options=t.options,Object.keys(t.scriptsSet).forEach(s=>{let n=t.scriptsSet[s];this._shaToScript[n.sha]=n,this[s]=t[s],this[s+"Buffer"]=t[s+"Buffer"]}),t.addedBuiltinSet.forEach(s=>{this[s]=t[s],this[s+"Buffer"]=t[s+"Buffer"]}),this.promise=new Promise((s,n)=>{this.resolve=s,this.reject=n});let r=this;Object.defineProperty(this,"length",{get:function(){return r._queue.length}})}fillResult(t,r){if(this._queue[r].name==="exec"&&Array.isArray(t[1])){let n=t[1].length;for(let i=0;i<n;i++){if(t[1][i]instanceof Error)continue;let o=this._queue[r-(n-i)];try{t[1][i]=o.transformReply(t[1][i])}catch(a){t[1][i]=a}}}if(this._result[r]=t,--this.replyPending)return;if(this.isCluster){let n=!0,i;for(let o=0;o<this._result.length;++o){let a=this._result[o][0],l=this._queue[o];if(a){if(l.name==="exec"&&a.message==="EXECABORT Transaction discarded because of previous errors.")continue;if(!i)i={name:a.name,message:a.message};else if(i.name!==a.name||i.message!==a.message){n=!1;break}}else if(!l.inTransaction&&!((0,So.exists)(l.name)&&(0,So.hasFlag)(l.name,"readonly"))){n=!1;break}}if(i&&n){let o=this,a=i.message.split(" "),l=this._queue,c=!1;this._queue=[];for(let p=0;p<l.length;++p){if(a[0]==="ASK"&&!c&&l[p].name!=="asking"&&(!l[p-1]||l[p-1].name!=="asking")){let m=new Ff.default("asking");m.ignore=!0,this.sendCommand(m)}l[p].initPromise(),this.sendCommand(l[p]),c=l[p].inTransaction}let f=!0;typeof this.leftRedirections>"u"&&(this.leftRedirections={});let u=function(){o.exec()},d=this.redis;if(d.handleError(i,this.leftRedirections,{moved:function(p,m){o.preferKey=m,d.slots[a[1]]=[m],d._groupsBySlot[a[1]]=d._groupsIds[d.slots[a[1]].join(";")],d.refreshSlotsCache(),o.exec()},ask:function(p,m){o.preferKey=m,o.exec()},tryagain:u,clusterDown:u,connectionClosed:u,maxRedirections:()=>{f=!1},defaults:()=>{f=!1}}),f)return}}let s=0;for(let n=0;n<this._queue.length-s;++n)this._queue[n+s].ignore&&(s+=1),this._result[n]=this._result[n+s];this.resolve(this._result.slice(0,this._result.length-s))}sendCommand(t){this._transactions>0&&(t.inTransaction=!0);let r=this._queue.length;return t.pipelineIndex=r,t.promise.then(s=>{this.fillResult([null,s],r)}).catch(s=>{this.fillResult([s],r)}),this._queue.push(t),this}addBatch(t){let r,s,n;for(let i=0;i<t.length;++i)r=t[i],s=r[0],n=r.slice(1),this[s].apply(this,n);return this}};Bs.default=st;var zf=st.prototype.multi;st.prototype.multi=function(){return this._transactions+=1,zf.apply(this,arguments)};var Ao=st.prototype.execBuffer;st.prototype.execBuffer=(0,jf.deprecate)(function(){return this._transactions>0&&(this._transactions-=1),Ao.apply(this,arguments)},"Pipeline#execBuffer: Use Pipeline#exec instead");st.prototype.exec=function(e){if(this.isCluster&&!this.redis.slots.length)return this.redis.status==="wait"&&this.redis.connect().catch(Uf.noop),e&&!this.nodeifiedPromise&&(this.nodeifiedPromise=!0,(0,_o.default)(this.promise,e)),this.redis.delayUntilReady(n=>{if(n){this.reject(n);return}this.exec(e)}),this.promise;if(this._transactions>0)return this._transactions-=1,Ao.apply(this,arguments);this.nodeifiedPromise||(this.nodeifiedPromise=!0,(0,_o.default)(this.promise,e)),this._queue.length||this.resolve([]);let t;if(this.isCluster){let n=[];for(let i=0;i<this._queue.length;i++){let o=this._queue[i].getKeys();if(o.length&&n.push(o[0]),o.length&&Ds.generateMulti(o)<0)return this.reject(new Error("All the keys in a pipeline command should belong to the same slot")),this.promise}if(n.length){if(t=Hf(this.redis,n),t<0)return this.reject(new Error("All keys in the pipeline should belong to the same slots allocation group")),this.promise}else t=Math.random()*16384|0}let r=this;return s(),this.promise;function s(){let n=r.replyPending=r._queue.length,i;r.isCluster&&(i={slot:t,redis:r.redis.connectionPool.nodes.all[r.preferKey]});let o="",a,l={isPipeline:!0,destination:r.isCluster?i:{redis:r.redis},write(c){typeof c!="string"?(a||(a=[]),o&&(a.push(Buffer.from(o,"utf8")),o=""),a.push(c)):o+=c,--n||(a?(o&&a.push(Buffer.from(o,"utf8")),l.destination.redis.stream.write(Buffer.concat(a))):l.destination.redis.stream.write(o),n=r._queue.length,o="",a=void 0)}};for(let c=0;c<r._queue.length;++c)r.redis.sendCommand(r._queue[c],l,i);return r.promise}}});var qs=y(vr=>{"use strict";Object.defineProperty(vr,"__esModule",{value:!0});vr.addTransactionSupport=void 0;var Ps=W(),$s=et(),Eo=Ls();function Xf(e){e.pipeline=function(s){let n=new Eo.default(this);return Array.isArray(s)&&n.addBatch(s),n};let{multi:t}=e;e.multi=function(s,n){if(typeof n>"u"&&!Array.isArray(s)&&(n=s,s=null),n&&n.pipeline===!1)return t.call(this);let i=new Eo.default(this);i.multi(),Array.isArray(s)&&i.addBatch(s);let o=i.exec;i.exec=function(l){if(this.isCluster&&!this.redis.slots.length)return this.redis.status==="wait"&&this.redis.connect().catch(Ps.noop),(0,$s.default)(new Promise((f,u)=>{this.redis.delayUntilReady(d=>{if(d){u(d);return}this.exec(i).then(f,u)})}),l);if(this._transactions>0&&o.call(i),this.nodeifiedPromise)return o.call(i);let c=o.call(i);return(0,$s.default)(c.then(function(f){let u=f[f.length-1];if(typeof u>"u")throw new Error("Pipeline cannot be used to send any commands when the `exec()` has been called on it.");if(u[0]){u[0].previousErrors=[];for(let d=0;d<f.length-1;++d)f[d][0]&&u[0].previousErrors.push(f[d][0]);throw u[0]}return(0,Ps.wrapMultiResult)(u[1])}),l)};let{execBuffer:a}=i;return i.execBuffer=function(l){return this._transactions>0&&a.call(i),i.exec(l)},i};let{exec:r}=e;e.exec=function(s){return(0,$s.default)(r.call(this).then(function(n){return Array.isArray(n)&&(n=(0,Ps.wrapMultiResult)(n)),n}),s)}}vr.addTransactionSupport=Xf});var Fs=y(js=>{"use strict";Object.defineProperty(js,"__esModule",{value:!0});function Kf(e,t){Object.getOwnPropertyNames(t.prototype).forEach(r=>{Object.defineProperty(e.prototype,r,Object.getOwnPropertyDescriptor(t.prototype,r))})}js.default=Kf});var Co=y(xr=>{"use strict";Object.defineProperty(xr,"__esModule",{value:!0});xr.DEFAULT_CLUSTER_OPTIONS=void 0;var wo=require("dns");xr.DEFAULT_CLUSTER_OPTIONS={clusterRetryStrategy:e=>Math.min(100+e*2,2e3),enableOfflineQueue:!0,enableReadyCheck:!0,scaleReads:"master",maxRedirections:16,retryDelayOnMoved:0,retryDelayOnFailover:100,retryDelayOnClusterDown:100,retryDelayOnTryAgain:100,slotsRefreshTimeout:1e3,useSRVRecords:!1,resolveSrv:wo.resolveSrv,dnsLookup:wo.lookup,enableAutoPipelining:!1,autoPipeliningIgnoredCommands:[]}});var Ir=y(J=>{"use strict";Object.defineProperty(J,"__esModule",{value:!0});J.getConnectionName=J.weightSrvRecords=J.groupSrvRecords=J.getUniqueHostnamesFromOptions=J.normalizeNodeOptions=J.nodeKeyToRedisOptions=J.getNodeKey=void 0;var ko=W(),Vf=require("net");function Qf(e){return e.port=e.port||6379,e.host=e.host||"127.0.0.1",e.host+":"+e.port}J.getNodeKey=Qf;function Yf(e){let t=e.lastIndexOf(":");if(t===-1)throw new Error(`Invalid node key ${e}`);return{host:e.slice(0,t),port:Number(e.slice(t+1))}}J.nodeKeyToRedisOptions=Yf;function Wf(e){return e.map(t=>{let r={};if(typeof t=="object")Object.assign(r,t);else if(typeof t=="string")Object.assign(r,(0,ko.parseURL)(t));else if(typeof t=="number")r.port=t;else throw new Error("Invalid argument "+t);return typeof r.port=="string"&&(r.port=parseInt(r.port,10)),delete r.db,r.port||(r.port=6379),r.host||(r.host="127.0.0.1"),(0,ko.resolveTLSProfile)(r)})}J.normalizeNodeOptions=Wf;function Jf(e){let t={};return e.forEach(r=>{t[r.host]=!0}),Object.keys(t).filter(r=>!(0,Vf.isIP)(r))}J.getUniqueHostnamesFromOptions=Jf;function Zf(e){let t={};for(let r of e)t.hasOwnProperty(r.priority)?(t[r.priority].totalWeight+=r.weight,t[r.priority].records.push(r)):t[r.priority]={totalWeight:r.weight,records:[r]};return t}J.groupSrvRecords=Zf;function ed(e){if(e.records.length===1)return e.totalWeight=0,e.records.shift();let t=Math.floor(Math.random()*(e.totalWeight+e.records.length)),r=0;for(let[s,n]of e.records.entries())if(r+=1+n.weight,r>t)return e.totalWeight-=n.weight,e.records.splice(s,1),n}J.weightSrvRecords=ed;function td(e,t){let r=`ioredis-cluster(${e})`;return t?`${r}:${t}`:r}J.getConnectionName=td});var Oo=y(Hs=>{"use strict";Object.defineProperty(Hs,"__esModule",{value:!0});var Ro=Ir(),Us=W(),rd=nt(),Ne=(0,Us.Debug)("cluster:subscriber"),Gs=class{constructor(t,r){this.connectionPool=t,this.emitter=r,this.started=!1,this.subscriber=null,this.onSubscriberEnd=()=>{if(!this.started){Ne("subscriber has disconnected, but ClusterSubscriber is not started, so not reconnecting.");return}Ne("subscriber has disconnected, selecting a new one..."),this.selectSubscriber()},this.connectionPool.on("-node",(s,n)=>{!this.started||!this.subscriber||(0,Ro.getNodeKey)(this.subscriber.options)===n&&(Ne("subscriber has left, selecting a new one..."),this.selectSubscriber())}),this.connectionPool.on("+node",()=>{!this.started||this.subscriber||(Ne("a new node is discovered and there is no subscriber, selecting a new one..."),this.selectSubscriber())})}getInstance(){return this.subscriber}start(){this.started=!0,this.selectSubscriber(),Ne("started")}stop(){this.started=!1,this.subscriber&&(this.subscriber.disconnect(),this.subscriber=null),Ne("stopped")}selectSubscriber(){let t=this.lastActiveSubscriber;t&&(t.off("end",this.onSubscriberEnd),t.disconnect()),this.subscriber&&(this.subscriber.off("end",this.onSubscriberEnd),this.subscriber.disconnect());let r=(0,Us.sample)(this.connectionPool.getNodes());if(!r){Ne("selecting subscriber failed since there is no node discovered in the cluster yet"),this.subscriber=null;return}let{options:s}=r;Ne("selected a subscriber %s:%s",s.host,s.port),this.subscriber=new rd.default({port:s.port,host:s.host,username:s.username,password:s.password,enableReadyCheck:!0,connectionName:(0,Ro.getConnectionName)("subscriber",s.connectionName),lazyConnect:!0,tls:s.tls,retryStrategy:null}),this.subscriber.on("error",Us.noop),this.subscriber.once("end",this.onSubscriberEnd);let n={subscribe:[],psubscribe:[],ssubscribe:[]};if(t){let i=t.condition||t.prevCondition;i&&i.subscriber&&(n.subscribe=i.subscriber.channels("subscribe"),n.psubscribe=i.subscriber.channels("psubscribe"),n.ssubscribe=i.subscriber.channels("ssubscribe"))}if(n.subscribe.length||n.psubscribe.length||n.ssubscribe.length){let i=0;for(let o of["subscribe","psubscribe","ssubscribe"]){let a=n[o];a.length&&(i+=1,Ne("%s %d channels",o,a.length),this.subscriber[o](a).then(()=>{--i||(this.lastActiveSubscriber=this.subscriber)}).catch(()=>{Ne("failed to %s %d channels",o,a.length)}))}}else this.lastActiveSubscriber=this.subscriber;for(let i of["message","messageBuffer","smessage","smessageBuffer"])this.subscriber.on(i,(o,a)=>{this.emitter.emit(i,o,a)});for(let i of["pmessage","pmessageBuffer"])this.subscriber.on(i,(o,a,l)=>{this.emitter.emit(i,o,a,l)})}};Hs.default=Gs});var xo=y(Xs=>{"use strict";Object.defineProperty(Xs,"__esModule",{value:!0});var sd=require("events"),Tr=W(),vo=Ir(),nd=nt(),Yt=(0,Tr.Debug)("cluster:connectionPool"),zs=class extends sd.EventEmitter{constructor(t){super(),this.redisOptions=t,this.nodes={all:{},master:{},slave:{}},this.specifiedOptions={}}getNodes(t="all"){let r=this.nodes[t];return Object.keys(r).map(s=>r[s])}getInstanceByKey(t){return this.nodes.all[t]}getSampleInstance(t){let r=Object.keys(this.nodes[t]),s=(0,Tr.sample)(r);return this.nodes[t][s]}findOrCreate(t,r=!1){let s=(0,vo.getNodeKey)(t);r=!!r,this.specifiedOptions[s]?Object.assign(t,this.specifiedOptions[s]):this.specifiedOptions[s]=t;let n;return this.nodes.all[s]?(n=this.nodes.all[s],n.options.readOnly!==r&&(n.options.readOnly=r,Yt("Change role of %s to %s",s,r?"slave":"master"),n[r?"readonly":"readwrite"]().catch(Tr.noop),r?(delete this.nodes.master[s],this.nodes.slave[s]=n):(delete this.nodes.slave[s],this.nodes.master[s]=n))):(Yt("Connecting to %s as %s",s,r?"slave":"master"),n=new nd.default((0,Tr.defaults)({retryStrategy:null,enableOfflineQueue:!0,readOnly:r},t,this.redisOptions,{lazyConnect:!0})),this.nodes.all[s]=n,this.nodes[r?"slave":"master"][s]=n,n.once("end",()=>{this.removeNode(s),this.emit("-node",n,s),Object.keys(this.nodes.all).length||this.emit("drain")}),this.emit("+node",n,s),n.on("error",function(i){this.emit("nodeError",i,s)})),n}reset(t){Yt("Reset with %O",t);let r={};t.forEach(s=>{let n=(0,vo.getNodeKey)(s);s.readOnly&&r[n]||(r[n]=s)}),Object.keys(this.nodes.all).forEach(s=>{r[s]||(Yt("Disconnect %s because the node does not hold any slot",s),this.nodes.all[s].disconnect(),this.removeNode(s))}),Object.keys(r).forEach(s=>{let n=r[s];this.findOrCreate(n,n.readOnly)})}removeNode(t){let{nodes:r}=this;r.all[t]&&(Yt("Remove %s from the pool",t),delete r.all[t]),delete r.master[t],delete r.slave[t]}};Xs.default=zs});var Nr=y((Bm,Io)=>{"use strict";function B(e,r){var r=r||{};this._capacity=r.capacity,this._head=0,this._tail=0,Array.isArray(e)?this._fromArray(e):(this._capacityMask=3,this._list=new Array(4))}B.prototype.peekAt=function(t){var r=t;if(r===(r|0)){var s=this.size();if(!(r>=s||r<-s))return r<0&&(r+=s),r=this._head+r&this._capacityMask,this._list[r]}};B.prototype.get=function(t){return this.peekAt(t)};B.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]};B.prototype.peekFront=function(){return this.peek()};B.prototype.peekBack=function(){return this.peekAt(-1)};Object.defineProperty(B.prototype,"length",{get:function(){return this.size()}});B.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};B.prototype.unshift=function(t){if(arguments.length===0)return this.size();var r=this._list.length;return this._head=this._head-1+r&this._capacityMask,this._list[this._head]=t,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};B.prototype.shift=function(){var t=this._head;if(t!==this._tail){var r=this._list[t];return this._list[t]=void 0,this._head=t+1&this._capacityMask,t<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),r}};B.prototype.push=function(t){if(arguments.length===0)return this.size();var r=this._tail;return this._list[r]=t,this._tail=r+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};B.prototype.pop=function(){var t=this._tail;if(t!==this._head){var r=this._list.length;this._tail=t-1+r&this._capacityMask;var s=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&t>1e4&&t<=r>>>2&&this._shrinkArray(),s}};B.prototype.removeOne=function(t){var r=t;if(r===(r|0)&&this._head!==this._tail){var s=this.size(),n=this._list.length;if(!(r>=s||r<-s)){r<0&&(r+=s),r=this._head+r&this._capacityMask;var i=this._list[r],o;if(t<s/2){for(o=t;o>0;o--)this._list[r]=this._list[r=r-1+n&this._capacityMask];this._list[r]=void 0,this._head=this._head+1+n&this._capacityMask}else{for(o=s-1-t;o>0;o--)this._list[r]=this._list[r=r+1+n&this._capacityMask];this._list[r]=void 0,this._tail=this._tail-1+n&this._capacityMask}return i}}};B.prototype.remove=function(t,r){var s=t,n,i=r;if(s===(s|0)&&this._head!==this._tail){var o=this.size(),a=this._list.length;if(!(s>=o||s<-o||r<1)){if(s<0&&(s+=o),r===1||!r)return n=new Array(1),n[0]=this.removeOne(s),n;if(s===0&&s+r>=o)return n=this.toArray(),this.clear(),n;s+r>o&&(r=o-s);var l;for(n=new Array(r),l=0;l<r;l++)n[l]=this._list[this._head+s+l&this._capacityMask];if(s=this._head+s&this._capacityMask,t+r===o){for(this._tail=this._tail-r+a&this._capacityMask,l=r;l>0;l--)this._list[s=s+1+a&this._capacityMask]=void 0;return n}if(t===0){for(this._head=this._head+r+a&this._capacityMask,l=r-1;l>0;l--)this._list[s=s+1+a&this._capacityMask]=void 0;return n}if(s<o/2){for(this._head=this._head+t+r+a&this._capacityMask,l=t;l>0;l--)this.unshift(this._list[s=s-1+a&this._capacityMask]);for(s=this._head-1+a&this._capacityMask;i>0;)this._list[s=s-1+a&this._capacityMask]=void 0,i--;t<0&&(this._tail=s)}else{for(this._tail=s,s=s+r+a&this._capacityMask,l=o-(r+t);l>0;l--)this.push(this._list[s++]);for(s=this._tail;i>0;)this._list[s=s+1+a&this._capacityMask]=void 0,i--}return this._head<2&&this._tail>1e4&&this._tail<=a>>>2&&this._shrinkArray(),n}}};B.prototype.splice=function(t,r){var s=t;if(s===(s|0)){var n=this.size();if(s<0&&(s+=n),!(s>n))if(arguments.length>2){var i,o,a,l=arguments.length,c=this._list.length,f=2;if(!n||s<n/2){for(o=new Array(s),i=0;i<s;i++)o[i]=this._list[this._head+i&this._capacityMask];for(r===0?(a=[],s>0&&(this._head=this._head+s+c&this._capacityMask)):(a=this.remove(s,r),this._head=this._head+s+c&this._capacityMask);l>f;)this.unshift(arguments[--l]);for(i=s;i>0;i--)this.unshift(o[i-1])}else{o=new Array(n-(s+r));var u=o.length;for(i=0;i<u;i++)o[i]=this._list[this._head+s+r+i&this._capacityMask];for(r===0?(a=[],s!=n&&(this._tail=this._head+s+c&this._capacityMask)):(a=this.remove(s,r),this._tail=this._tail-u+c&this._capacityMask);f<l;)this.push(arguments[f++]);for(i=0;i<u;i++)this.push(o[i])}return a}else return this.remove(s,r)}};B.prototype.clear=function(){this._list=new Array(this._list.length),this._head=0,this._tail=0};B.prototype.isEmpty=function(){return this._head===this._tail};B.prototype.toArray=function(){return this._copyArray(!1)};B.prototype._fromArray=function(t){var r=t.length,s=this._nextPowerOf2(r);this._list=new Array(s),this._capacityMask=s-1,this._tail=r;for(var n=0;n<r;n++)this._list[n]=t[n]};B.prototype._copyArray=function(t,r){var s=this._list,n=s.length,i=this.length;if(r=r|i,r==i&&this._head<this._tail)return this._list.slice(this._head,this._tail);var o=new Array(r),a=0,l;if(t||this._head>this._tail){for(l=this._head;l<n;l++)o[a++]=s[l];for(l=0;l<this._tail;l++)o[a++]=s[l]}else for(l=this._head;l<this._tail;l++)o[a++]=s[l];return o};B.prototype._growArray=function(){if(this._head!=0){var t=this._copyArray(!0,this._list.length<<1);this._tail=this._list.length,this._head=0,this._list=t}else this._tail=this._list.length,this._list.length<<=1;this._capacityMask=this._capacityMask<<1|1};B.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1};B.prototype._nextPowerOf2=function(t){var r=Math.log(t)/Math.log(2),s=1<<r+1;return Math.max(s,4)};Io.exports=B});var To=y(Vs=>{"use strict";Object.defineProperty(Vs,"__esModule",{value:!0});var id=W(),od=Nr(),ad=(0,id.Debug)("delayqueue"),Ks=class{constructor(){this.queues={},this.timeouts={}}push(t,r,s){let n=s.callback||process.nextTick;this.queues[t]||(this.queues[t]=new od),this.queues[t].push(r),this.timeouts[t]||(this.timeouts[t]=setTimeout(()=>{n(()=>{this.timeouts[t]=null,this.execute(t)})},s.timeout))}execute(t){let r=this.queues[t];if(!r)return;let{length:s}=r;if(s)for(ad("send %d commands in %s queue",s,t),this.queues[t]=null;r.length>0;)r.shift()()}};Vs.default=Ks});var Ws=y(Ys=>{"use strict";Object.defineProperty(Ys,"__esModule",{value:!0});var No=xt(),Po=require("events"),Mr=pt(),Mo=et(),Do=Fe(),Qs=co(),ld=nt(),cd=kr(),ud=qs(),he=W(),fd=Fs(),dd=Or(),hd=Co(),pd=Oo(),md=xo(),yd=To(),Lt=Ir(),Bo=Nr(),$=(0,he.Debug)("cluster"),Lo=new WeakSet,gt=class extends dd.default{constructor(t,r={}){if(super(),this.slots=[],this._groupsIds={},this._groupsBySlot=Array(16384),this.isCluster=!0,this.retryAttempts=0,this.delayQueue=new yd.default,this.offlineQueue=new Bo,this.isRefreshing=!1,this._autoPipelines=new Map,this._runningAutoPipelines=new Set,this._readyDelayedCallbacks=[],this.connectionEpoch=0,Po.EventEmitter.call(this),this.startupNodes=t,this.options=(0,he.defaults)({},r,hd.DEFAULT_CLUSTER_OPTIONS,this.options),this.options.redisOptions&&this.options.redisOptions.keyPrefix&&!this.options.keyPrefix&&(this.options.keyPrefix=this.options.redisOptions.keyPrefix),typeof this.options.scaleReads!="function"&&["all","master","slave"].indexOf(this.options.scaleReads)===-1)throw new Error('Invalid option scaleReads "'+this.options.scaleReads+'". Expected "all", "master", "slave" or a custom function');this.connectionPool=new md.default(this.options.redisOptions),this.connectionPool.on("-node",(s,n)=>{this.emit("-node",s)}),this.connectionPool.on("+node",s=>{this.emit("+node",s)}),this.connectionPool.on("drain",()=>{this.setStatus("close")}),this.connectionPool.on("nodeError",(s,n)=>{this.emit("node error",s,n)}),this.subscriber=new pd.default(this.connectionPool,this),this.options.scripts&&Object.entries(this.options.scripts).forEach(([s,n])=>{this.defineCommand(s,n)}),this.options.lazyConnect?this.setStatus("wait"):this.connect().catch(s=>{$("connecting failed: %s",s)})}connect(){return new Promise((t,r)=>{if(this.status==="connecting"||this.status==="connect"||this.status==="ready"){r(new Error("Redis is already connecting/connected"));return}let s=++this.connectionEpoch;this.setStatus("connecting"),this.resolveStartupNodeHostnames().then(n=>{if(this.connectionEpoch!==s){$("discard connecting after resolving startup nodes because epoch not match: %d != %d",s,this.connectionEpoch),r(new Mr.RedisError("Connection is discarded because a new connection is made"));return}if(this.status!=="connecting"){$("discard connecting after resolving startup nodes because the status changed to %s",this.status),r(new Mr.RedisError("Connection is aborted"));return}this.connectionPool.reset(n);let i=()=>{this.setStatus("ready"),this.retryAttempts=0,this.executeOfflineCommands(),this.resetNodesRefreshInterval(),t()},o,a=()=>{this.invokeReadyDelayedCallbacks(void 0),this.removeListener("close",o),this.manuallyClosing=!1,this.setStatus("connect"),this.options.enableReadyCheck?this.readyCheck((l,c)=>{l||c?($("Ready check failed (%s). Reconnecting...",l||c),this.status==="connect"&&this.disconnect(!0)):i()}):i()};o=()=>{let l=new Error("None of startup nodes is available");this.removeListener("refresh",a),this.invokeReadyDelayedCallbacks(l),r(l)},this.once("refresh",a),this.once("close",o),this.once("close",this.handleCloseEvent.bind(this)),this.refreshSlotsCache(l=>{l&&l.message===Qs.default.defaultMessage&&(ld.default.prototype.silentEmit.call(this,"error",l),this.connectionPool.reset([]))}),this.subscriber.start()}).catch(n=>{this.setStatus("close"),this.handleCloseEvent(n),this.invokeReadyDelayedCallbacks(n),r(n)})})}disconnect(t=!1){let r=this.status;this.setStatus("disconnecting"),t||(this.manuallyClosing=!0),this.reconnectTimeout&&!t&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null,$("Canceled reconnecting attempts")),this.clearNodesRefreshInterval(),this.subscriber.stop(),r==="wait"?(this.setStatus("close"),this.handleCloseEvent()):this.connectionPool.reset([])}quit(t){let r=this.status;if(this.setStatus("disconnecting"),this.manuallyClosing=!0,this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null),this.clearNodesRefreshInterval(),this.subscriber.stop(),r==="wait"){let s=(0,Mo.default)(Promise.resolve("OK"),t);return setImmediate(function(){this.setStatus("close"),this.handleCloseEvent()}.bind(this)),s}return(0,Mo.default)(Promise.all(this.nodes().map(s=>s.quit().catch(n=>{if(n.message===he.CONNECTION_CLOSED_ERROR_MSG)return"OK";throw n}))).then(()=>"OK"),t)}duplicate(t=[],r={}){let s=t.length>0?t:this.startupNodes.slice(0),n=Object.assign({},this.options,r);return new gt(s,n)}nodes(t="all"){if(t!=="all"&&t!=="master"&&t!=="slave")throw new Error('Invalid role "'+t+'". Expected "all", "master" or "slave"');return this.connectionPool.getNodes(t)}delayUntilReady(t){this._readyDelayedCallbacks.push(t)}get autoPipelineQueueSize(){let t=0;for(let r of this._autoPipelines.values())t+=r.length;return t}refreshSlotsCache(t){if(this.isRefreshing){t&&process.nextTick(t);return}this.isRefreshing=!0;let r=this,s=a=>{this.isRefreshing=!1,t&&t(a)},n=(0,he.shuffle)(this.connectionPool.getNodes()),i=null;function o(a){if(a===n.length){let f=new Qs.default(Qs.default.defaultMessage,i);return s(f)}let l=n[a],c=`${l.options.host}:${l.options.port}`;$("getting slot cache from %s",c),r.getInfoFromNode(l,function(f){switch(r.status){case"close":case"end":return s(new Error("Cluster is disconnected."));case"disconnecting":return s(new Error("Cluster is disconnecting."))}f?(r.emit("node error",f,c),i=f,o(a+1)):(r.emit("refresh"),s())})}o(0)}sendCommand(t,r,s){if(this.status==="wait"&&this.connect().catch(he.noop),this.status==="end")return t.reject(new Error(he.CONNECTION_CLOSED_ERROR_MSG)),t.promise;let n=this.options.scaleReads;n!=="master"&&(t.isReadOnly||(0,No.exists)(t.name)&&(0,No.hasFlag)(t.name,"readonly")||(n="master"));let i=s?s.slot:t.getSlot(),o={},a=this;if(!s&&!Lo.has(t)){Lo.add(t);let c=t.reject;t.reject=function(f){let u=l.bind(null,!0);a.handleError(f,o,{moved:function(d,p){$("command %s is moved to %s",t.name,p),i=Number(d),a.slots[d]?a.slots[d][0]=p:a.slots[d]=[p],a._groupsBySlot[d]=a._groupsIds[a.slots[d].join(";")],a.connectionPool.findOrCreate(a.natMapper(p)),l(),$("refreshing slot caches... (triggered by MOVED error)"),a.refreshSlotsCache()},ask:function(d,p){$("command %s is required to ask %s:%s",t.name,p);let m=a.natMapper(p);a.connectionPool.findOrCreate(m),l(!1,`${m.host}:${m.port}`)},tryagain:u,clusterDown:u,connectionClosed:u,maxRedirections:function(d){c.call(t,d)},defaults:function(){c.call(t,f)}})}}l();function l(c,f){if(a.status==="end"){t.reject(new Mr.AbortError("Cluster is ended."));return}let u;if(a.status==="ready"||t.name==="cluster"){if(s&&s.redis)u=s.redis;else if(Do.default.checkFlag("ENTER_SUBSCRIBER_MODE",t.name)||Do.default.checkFlag("EXIT_SUBSCRIBER_MODE",t.name)){if(u=a.subscriber.getInstance(),!u){t.reject(new Mr.AbortError("No subscriber for the cluster"));return}}else{if(!c){if(typeof i=="number"&&a.slots[i]){let d=a.slots[i];if(typeof n=="function"){let p=d.map(function(m){return a.connectionPool.getInstanceByKey(m)});u=n(p,t),Array.isArray(u)&&(u=(0,he.sample)(u)),u||(u=p[0])}else{let p;n==="all"?p=(0,he.sample)(d):n==="slave"&&d.length>1?p=(0,he.sample)(d,1):p=d[0],u=a.connectionPool.getInstanceByKey(p)}}f&&(u=a.connectionPool.getInstanceByKey(f),u.asking())}u||(u=(typeof n=="function"?null:a.connectionPool.getSampleInstance(n))||a.connectionPool.getSampleInstance("all"))}s&&!s.redis&&(s.redis=u)}u?u.sendCommand(t,r):a.options.enableOfflineQueue?a.offlineQueue.push({command:t,stream:r,node:s}):t.reject(new Error("Cluster isn't ready and enableOfflineQueue options is false"))}return t.promise}sscanStream(t,r){return this.createScanStream("sscan",{key:t,options:r})}sscanBufferStream(t,r){return this.createScanStream("sscanBuffer",{key:t,options:r})}hscanStream(t,r){return this.createScanStream("hscan",{key:t,options:r})}hscanBufferStream(t,r){return this.createScanStream("hscanBuffer",{key:t,options:r})}zscanStream(t,r){return this.createScanStream("zscan",{key:t,options:r})}zscanBufferStream(t,r){return this.createScanStream("zscanBuffer",{key:t,options:r})}handleError(t,r,s){if(typeof r.value>"u"?r.value=this.options.maxRedirections:r.value-=1,r.value<=0){s.maxRedirections(new Error("Too many Cluster redirections. Last error: "+t));return}let n=t.message.split(" ");if(n[0]==="MOVED"){let i=this.options.retryDelayOnMoved;i&&typeof i=="number"?this.delayQueue.push("moved",s.moved.bind(null,n[1],n[2]),{timeout:i}):s.moved(n[1],n[2])}else n[0]==="ASK"?s.ask(n[1],n[2]):n[0]==="TRYAGAIN"?this.delayQueue.push("tryagain",s.tryagain,{timeout:this.options.retryDelayOnTryAgain}):n[0]==="CLUSTERDOWN"&&this.options.retryDelayOnClusterDown>0?this.delayQueue.push("clusterdown",s.connectionClosed,{timeout:this.options.retryDelayOnClusterDown,callback:this.refreshSlotsCache.bind(this)}):t.message===he.CONNECTION_CLOSED_ERROR_MSG&&this.options.retryDelayOnFailover>0&&this.status==="ready"?this.delayQueue.push("failover",s.connectionClosed,{timeout:this.options.retryDelayOnFailover,callback:this.refreshSlotsCache.bind(this)}):s.defaults()}resetOfflineQueue(){this.offlineQueue=new Bo}clearNodesRefreshInterval(){this.slotsTimer&&(clearTimeout(this.slotsTimer),this.slotsTimer=null)}resetNodesRefreshInterval(){if(this.slotsTimer||!this.options.slotsRefreshInterval)return;let t=()=>{this.slotsTimer=setTimeout(()=>{$('refreshing slot caches... (triggered by "slotsRefreshInterval" option)'),this.refreshSlotsCache(()=>{t()})},this.options.slotsRefreshInterval)};t()}setStatus(t){$("status: %s -> %s",this.status||"[empty]",t),this.status=t,process.nextTick(()=>{this.emit(t)})}handleCloseEvent(t){t&&$("closed because %s",t);let r;!this.manuallyClosing&&typeof this.options.clusterRetryStrategy=="function"&&(r=this.options.clusterRetryStrategy.call(this,++this.retryAttempts,t)),typeof r=="number"?(this.setStatus("reconnecting"),this.reconnectTimeout=setTimeout(()=>{this.reconnectTimeout=null,$("Cluster is disconnected. Retrying after %dms",r),this.connect().catch(function(s){$("Got error %s when reconnecting. Ignoring...",s)})},r)):(this.setStatus("end"),this.flushQueue(new Error("None of startup nodes is available")))}flushQueue(t){let r;for(;r=this.offlineQueue.shift();)r.command.reject(t)}executeOfflineCommands(){if(this.offlineQueue.length){$("send %d commands in offline queue",this.offlineQueue.length);let t=this.offlineQueue;this.resetOfflineQueue();let r;for(;r=t.shift();)this.sendCommand(r.command,r.stream,r.node)}}natMapper(t){if(this.options.natMap&&typeof this.options.natMap=="object"){let r=typeof t=="string"?t:`${t.host}:${t.port}`,s=this.options.natMap[r];if(s)return $("NAT mapping %s -> %O",r,s),Object.assign({},s)}return typeof t=="string"?(0,Lt.nodeKeyToRedisOptions)(t):t}getInfoFromNode(t,r){if(!t)return r(new Error("Node is disconnected"));let s=t.duplicate({enableOfflineQueue:!0,enableReadyCheck:!1,retryStrategy:null,connectionName:(0,Lt.getConnectionName)("refresher",this.options.redisOptions&&this.options.redisOptions.connectionName)});s.on("error",he.noop),s.cluster("SLOTS",(0,he.timeout)((n,i)=>{if(s.disconnect(),n)return r(n);if(this.status==="disconnecting"||this.status==="close"||this.status==="end"){$("ignore CLUSTER.SLOTS results (count: %d) since cluster status is %s",i.length,this.status),r();return}let o=[];$("cluster slots result count: %d",i.length);for(let l=0;l<i.length;++l){let c=i[l],f=c[0],u=c[1],d=[];for(let p=2;p<c.length;p++){if(!c[p][0])continue;let m=this.natMapper({host:c[p][0],port:c[p][1]});m.readOnly=p!==2,o.push(m),d.push(m.host+":"+m.port)}$("cluster slots result [%d]: slots %d~%d served by %s",l,f,u,d);for(let p=f;p<=u;p++)this.slots[p]=d}this._groupsIds=Object.create(null);let a=0;for(let l=0;l<16384;l++){let c=(this.slots[l]||[]).join(";");if(!c.length){this._groupsBySlot[l]=void 0;continue}this._groupsIds[c]||(this._groupsIds[c]=++a),this._groupsBySlot[l]=this._groupsIds[c]}this.connectionPool.reset(o),r()},this.options.slotsRefreshTimeout))}invokeReadyDelayedCallbacks(t){for(let r of this._readyDelayedCallbacks)process.nextTick(r,t);this._readyDelayedCallbacks=[]}readyCheck(t){this.cluster("INFO",(r,s)=>{if(r)return t(r);if(typeof s!="string")return t();let n,i=s.split(`\r
`);for(let o=0;o<i.length;++o){let a=i[o].split(":");if(a[0]==="cluster_state"){n=a[1];break}}n==="fail"?($("cluster state not ok (%s)",n),t(null,n)):t()})}resolveSrv(t){return new Promise((r,s)=>{this.options.resolveSrv(t,(n,i)=>{if(n)return s(n);let o=this,a=(0,Lt.groupSrvRecords)(i),l=Object.keys(a).sort((f,u)=>parseInt(f)-parseInt(u));function c(f){if(!l.length)return s(f);let u=l[0],d=a[u],p=(0,Lt.weightSrvRecords)(d);d.records.length||l.shift(),o.dnsLookup(p.name).then(m=>r({host:m,port:p.port}),c)}c()})})}dnsLookup(t){return new Promise((r,s)=>{this.options.dnsLookup(t,(n,i)=>{n?($("failed to resolve hostname %s to IP: %s",t,n.message),s(n)):($("resolved hostname %s to IP %s",t,i),r(i))})})}async resolveStartupNodeHostnames(){if(!Array.isArray(this.startupNodes)||this.startupNodes.length===0)throw new Error("`startupNodes` should contain at least one node.");let t=(0,Lt.normalizeNodeOptions)(this.startupNodes),r=(0,Lt.getUniqueHostnamesFromOptions)(t);if(r.length===0)return t;let s=await Promise.all(r.map((this.options.useSRVRecords?this.resolveSrv:this.dnsLookup).bind(this))),n=(0,he.zipMap)(r,s);return t.map(i=>{let o=n.get(i.host);return o?this.options.useSRVRecords?Object.assign({},i,o):Object.assign({},i,{host:o}):i})}createScanStream(t,{key:r,options:s={}}){return new cd.default({objectMode:!0,key:r,redis:this,command:t,...s})}};(0,fd.default)(gt,Po.EventEmitter);(0,ud.addTransactionSupport)(gt.prototype);Ys.default=gt});var Dr=y(Zs=>{"use strict";Object.defineProperty(Zs,"__esModule",{value:!0});var gd=W(),bd=(0,gd.Debug)("AbstractConnector"),Js=class{constructor(t){this.connecting=!1,this.disconnectTimeout=t}check(t){return!0}disconnect(){if(this.connecting=!1,this.stream){let t=this.stream,r=setTimeout(()=>{bd("stream %s:%s still open, destroying it",t.remoteAddress,t.remotePort),t.destroy()},this.disconnectTimeout);t.on("close",()=>clearTimeout(r)),t.end()}}};Zs.default=Js});var $o=y(tn=>{"use strict";Object.defineProperty(tn,"__esModule",{value:!0});var Sd=require("net"),_d=require("tls"),Ad=W(),Ed=Dr(),en=class extends Ed.default{constructor(t){super(t.disconnectTimeout),this.options=t}connect(t){let{options:r}=this;this.connecting=!0;let s;return"path"in r&&r.path?s={path:r.path}:(s={},"port"in r&&r.port!=null&&(s.port=r.port),"host"in r&&r.host!=null&&(s.host=r.host),"family"in r&&r.family!=null&&(s.family=r.family)),r.tls&&Object.assign(s,r.tls),new Promise((n,i)=>{process.nextTick(()=>{if(!this.connecting){i(new Error(Ad.CONNECTION_CLOSED_ERROR_MSG));return}try{r.tls?this.stream=(0,_d.connect)(s):this.stream=(0,Sd.createConnection)(s)}catch(o){i(o);return}this.stream.once("error",o=>{this.firstError=o}),n(this.stream)})})}};tn.default=en});var qo=y(sn=>{"use strict";Object.defineProperty(sn,"__esModule",{value:!0});function wd(e,t){return(e.host||"127.0.0.1")===(t.host||"127.0.0.1")&&(e.port||26379)===(t.port||26379)}var rn=class{constructor(t){this.cursor=0,this.sentinels=t.slice(0)}next(){let t=this.cursor>=this.sentinels.length;return{done:t,value:t?void 0:this.sentinels[this.cursor++]}}reset(t){t&&this.sentinels.length>1&&this.cursor!==1&&this.sentinels.unshift(...this.sentinels.splice(this.cursor-1)),this.cursor=0}add(t){for(let r=0;r<this.sentinels.length;r++)if(wd(t,this.sentinels[r]))return!1;return this.sentinels.push(t),!0}toString(){return`${JSON.stringify(this.sentinels)} @${this.cursor}`}};sn.default=rn});var Fo=y(Br=>{"use strict";Object.defineProperty(Br,"__esModule",{value:!0});Br.FailoverDetector=void 0;var Cd=W(),nn=(0,Cd.Debug)("FailoverDetector"),jo="+switch-master",on=class{constructor(t,r){this.isDisconnected=!1,this.connector=t,this.sentinels=r}cleanup(){this.isDisconnected=!0;for(let t of this.sentinels)t.client.disconnect()}async subscribe(){nn("Starting FailoverDetector");let t=[];for(let r of this.sentinels){let s=r.client.subscribe(jo).catch(n=>{nn("Failed to subscribe to failover messages on sentinel %s:%s (%s)",r.address.host||"127.0.0.1",r.address.port||26739,n.message)});t.push(s),r.client.on("message",n=>{!this.isDisconnected&&n===jo&&this.disconnect()})}await Promise.all(t)}disconnect(){this.isDisconnected=!0,nn("Failover detected, disconnecting"),this.connector.disconnect()}};Br.FailoverDetector=on});var Lr=y(Jt=>{"use strict";Object.defineProperty(Jt,"__esModule",{value:!0});Jt.SentinelIterator=void 0;var kd=require("net"),Wt=W(),Rd=require("tls"),Uo=qo();Jt.SentinelIterator=Uo.default;var Od=Dr(),vd=nt(),xd=Fo(),Pt=(0,Wt.Debug)("SentinelConnector"),an=class extends Od.default{constructor(t){if(super(t.disconnectTimeout),this.options=t,this.emitter=null,this.failoverDetector=null,!this.options.sentinels.length)throw new Error("Requires at least one sentinel to connect to.");if(!this.options.name)throw new Error("Requires the name of master.");this.sentinelIterator=new Uo.default(this.options.sentinels)}check(t){let r=!t.role||this.options.role===t.role;return r||(Pt("role invalid, expected %s, but got %s",this.options.role,t.role),this.sentinelIterator.next(),this.sentinelIterator.next(),this.sentinelIterator.reset(!0)),r}disconnect(){super.disconnect(),this.failoverDetector&&this.failoverDetector.cleanup()}connect(t){this.connecting=!0,this.retryAttempts=0;let r,s=async()=>{let n=this.sentinelIterator.next();if(n.done){this.sentinelIterator.reset(!1);let l=typeof this.options.sentinelRetryStrategy=="function"?this.options.sentinelRetryStrategy(++this.retryAttempts):null,c=typeof l!="number"?"All sentinels are unreachable and retry is disabled.":`All sentinels are unreachable. Retrying from scratch after ${l}ms.`;r&&(c+=` Last error: ${r.message}`),Pt(c);let f=new Error(c);if(typeof l=="number")return t("error",f),await new Promise(u=>setTimeout(u,l)),s();throw f}let i=null,o=null;try{i=await this.resolve(n.value)}catch(l){o=l}if(!this.connecting)throw new Error(Wt.CONNECTION_CLOSED_ERROR_MSG);let a=n.value.host+":"+n.value.port;if(i)return Pt("resolved: %s:%s from sentinel %s",i.host,i.port,a),this.options.enableTLSForSentinelMode&&this.options.tls?(Object.assign(i,this.options.tls),this.stream=(0,Rd.connect)(i),this.stream.once("secureConnect",this.initFailoverDetector.bind(this))):(this.stream=(0,kd.createConnection)(i),this.stream.once("connect",this.initFailoverDetector.bind(this))),this.stream.once("error",l=>{this.firstError=l}),this.stream;{let l=o?"failed to connect to sentinel "+a+" because "+o.message:"connected to sentinel "+a+" successfully, but got an invalid reply: "+i;return Pt(l),t("sentinelError",new Error(l)),o&&(r=o),s()}};return s()}async updateSentinels(t){if(!this.options.updateSentinels)return;let r=await t.sentinel("sentinels",this.options.name);Array.isArray(r)&&(r.map(Wt.packObject).forEach(s=>{if((s.flags?s.flags.split(","):[]).indexOf("disconnected")===-1&&s.ip&&s.port){let i=this.sentinelNatResolve(Go(s));this.sentinelIterator.add(i)&&Pt("adding sentinel %s:%s",i.host,i.port)}}),Pt("Updated internal sentinels: %s",this.sentinelIterator))}async resolveMaster(t){let r=await t.sentinel("get-master-addr-by-name",this.options.name);return await this.updateSentinels(t),this.sentinelNatResolve(Array.isArray(r)?{host:r[0],port:Number(r[1])}:null)}async resolveSlave(t){let r=await t.sentinel("slaves",this.options.name);if(!Array.isArray(r))return null;let s=r.map(Wt.packObject).filter(n=>n.flags&&!n.flags.match(/(disconnected|s_down|o_down)/));return this.sentinelNatResolve(Id(s,this.options.preferredSlaves))}sentinelNatResolve(t){return!t||!this.options.natMap?t:this.options.natMap[`${t.host}:${t.port}`]||t}connectToSentinel(t,r){return new vd.default({port:t.port||26379,host:t.host,username:this.options.sentinelUsername||null,password:this.options.sentinelPassword||null,family:t.family||("path"in this.options&&this.options.path?void 0:this.options.family),tls:this.options.sentinelTLS,retryStrategy:null,enableReadyCheck:!1,connectTimeout:this.options.connectTimeout,commandTimeout:this.options.sentinelCommandTimeout,...r})}async resolve(t){let r=this.connectToSentinel(t);r.on("error",Td);try{return this.options.role==="slave"?await this.resolveSlave(r):await this.resolveMaster(r)}finally{r.disconnect()}}async initFailoverDetector(){var t;if(!this.options.failoverDetector)return;this.sentinelIterator.reset(!0);let r=[];for(;r.length<this.options.sentinelMaxConnections;){let{done:s,value:n}=this.sentinelIterator.next();if(s)break;let i=this.connectToSentinel(n,{lazyConnect:!0,retryStrategy:this.options.sentinelReconnectStrategy});i.on("reconnecting",()=>{var o;(o=this.emitter)===null||o===void 0||o.emit("sentinelReconnecting")}),r.push({address:n,client:i})}this.sentinelIterator.reset(!1),this.failoverDetector&&this.failoverDetector.cleanup(),this.failoverDetector=new xd.FailoverDetector(this,r),await this.failoverDetector.subscribe(),(t=this.emitter)===null||t===void 0||t.emit("failoverSubscribed")}};Jt.default=an;function Id(e,t){if(e.length===0)return null;let r;if(typeof t=="function")r=t(e);else if(t!==null&&typeof t=="object"){let s=Array.isArray(t)?t:[t];s.sort((n,i)=>(n.prio||(n.prio=1),i.prio||(i.prio=1),n.prio<i.prio?-1:n.prio>i.prio?1:0));for(let n=0;n<s.length;n++){for(let i=0;i<e.length;i++){let o=e[i];if(o.ip===s[n].ip&&o.port===s[n].port){r=o;break}}if(r)break}}return r||(r=(0,Wt.sample)(e)),Go(r)}function Go(e){return{host:e.ip,port:Number(e.port)}}function Td(){}});var Ho=y($t=>{"use strict";Object.defineProperty($t,"__esModule",{value:!0});$t.SentinelConnector=$t.StandaloneConnector=void 0;var Nd=$o();$t.StandaloneConnector=Nd.default;var Md=Lr();$t.SentinelConnector=Md.default});var zo=y(cn=>{"use strict";Object.defineProperty(cn,"__esModule",{value:!0});var Dd=pt(),ln=class extends Dd.AbortError{constructor(t){let r=`Reached the max retries per request limit (which is ${t}). Refer to "maxRetriesPerRequest" option for details.`;super(r),Error.captureStackTrace(this,this.constructor)}get name(){return this.constructor.name}};cn.default=ln});var Xo=y(Pr=>{"use strict";Object.defineProperty(Pr,"__esModule",{value:!0});Pr.MaxRetriesPerRequestError=void 0;var Bd=zo();Pr.MaxRetriesPerRequestError=Bd.default});var Zo=y((Xm,Jo)=>{"use strict";var mn=require("buffer").Buffer,Ld=require("string_decoder").StringDecoder,un=new Ld,Ko=pt(),Pd=Ko.ReplyError,$d=Ko.ParserError,Oe=mn.allocUnsafe(32*1024),ne=0,$r=null,Zt=0,fn=0;function qd(e){let t=e.buffer.length-1;var r=e.offset,s=0,n=1;for(e.buffer[r]===45&&(n=-1,r++);r<t;){let i=e.buffer[r++];if(i===13)return e.offset=r+1,n*s;s=s*10+(i-48)}}function jd(e){let t=e.buffer.length-1;var r=e.offset,s=0,n="";for(e.buffer[r]===45&&(n+="-",r++);r<t;){var i=e.buffer[r++];if(i===13)return e.offset=r+1,s!==0&&(n+=s),n;s>429496728?(n+=s*10+(i-48),s=0):i===48&&s===0?n+=0:s=s*10+(i-48)}}function Vo(e){let t=e.offset,r=e.buffer,s=r.length-1;for(var n=t;n<s;)if(r[n++]===13)return e.offset=n+1,e.optionReturnBuffers===!0?e.buffer.slice(t,n-1):e.buffer.toString("utf8",t,n-1)}function Qo(e){let t=e.buffer.length-1;for(var r=e.offset,s=0;r<t;){let n=e.buffer[r++];if(n===13)return e.offset=r+1,s;s=s*10+(n-48)}}function Fd(e){return e.optionStringNumbers===!0?jd(e):qd(e)}function Ud(e){let t=Qo(e);if(t===void 0)return;if(t<0)return null;let r=e.offset+t;if(r+2>e.buffer.length){e.bigStrSize=r+2,e.totalChunkSize=e.buffer.length,e.bufferCache.push(e.buffer);return}let s=e.offset;return e.offset=r+2,e.optionReturnBuffers===!0?e.buffer.slice(s,r):e.buffer.toString("utf8",s,r)}function Gd(e){var t=Vo(e);if(t!==void 0)return e.optionReturnBuffers===!0&&(t=t.toString()),new Pd(t)}function Hd(e,t){let r=new $d("Protocol error, got "+JSON.stringify(String.fromCharCode(t))+" as reply type byte",JSON.stringify(e.buffer),e.offset);e.buffer=null,e.returnFatalError(r)}function zd(e){let t=Qo(e);if(t===void 0)return;if(t<0)return null;let r=new Array(t);return Yo(e,r,0)}function dn(e,t,r){e.arrayCache.push(t),e.arrayPos.push(r)}function hn(e){let t=e.arrayCache.pop();var r=e.arrayPos.pop();if(e.arrayCache.length){let s=hn(e);if(s===void 0){dn(e,t,r);return}t[r++]=s}return Yo(e,t,r)}function Yo(e,t,r){let s=e.buffer.length;for(;r<t.length;){let n=e.offset;if(e.offset>=s){dn(e,t,r);return}let i=Wo(e,e.buffer[e.offset++]);if(i===void 0){e.arrayCache.length||e.bufferCache.length||(e.offset=n),dn(e,t,r);return}t[r]=i,r++}return t}function Wo(e,t){switch(t){case 36:return Ud(e);case 43:return Vo(e);case 42:return zd(e);case 58:return Fd(e);case 45:return Gd(e);default:return Hd(e,t)}}function Xd(){if(Oe.length>50*1024)if(Zt===1||fn>Zt*2){let e=Math.floor(Oe.length/10),t=e<ne?ne:e;ne=0,Oe=Oe.slice(t,Oe.length)}else fn++,Zt--;else clearInterval($r),Zt=0,fn=0,$r=null}function Kd(e){if(Oe.length<e+ne){let t=e>78643200?2:3;ne>1024*1024*111&&(ne=1024*1024*50),Oe=mn.allocUnsafe(e*t+ne),ne=0,Zt++,$r===null&&($r=setInterval(Xd,50))}}function Vd(e){let t=e.bufferCache,r=e.offset;var s=t.length,n=e.bigStrSize-e.totalChunkSize;if(e.offset=n,n<=2){if(s===2)return t[0].toString("utf8",r,t[0].length+n-2);s--,n=t[t.length-2].length+n}for(var i=un.write(t[0].slice(r)),o=1;o<s-1;o++)i+=un.write(t[o]);return i+=un.end(t[o].slice(0,n-2)),i}function Qd(e){let t=e.bufferCache,r=e.offset,s=e.bigStrSize-r-2;var n=t.length,i=e.bigStrSize-e.totalChunkSize;if(e.offset=i,i<=2){if(n===2)return t[0].slice(r,t[0].length+i-2);n--,i=t[t.length-2].length+i}Kd(s);let o=ne;t[0].copy(Oe,o,r,t[0].length),ne+=t[0].length-r;for(var a=1;a<n-1;a++)t[a].copy(Oe,ne),ne+=t[a].length;return t[a].copy(Oe,ne,0,i-2),ne+=i-2,Oe.slice(o,ne)}var pn=class{constructor(t){if(!t)throw new TypeError("Options are mandatory.");if(typeof t.returnError!="function"||typeof t.returnReply!="function")throw new TypeError("The returnReply and returnError options have to be functions.");this.setReturnBuffers(!!t.returnBuffers),this.setStringNumbers(!!t.stringNumbers),this.returnError=t.returnError,this.returnFatalError=t.returnFatalError||t.returnError,this.returnReply=t.returnReply,this.reset()}reset(){this.offset=0,this.buffer=null,this.bigStrSize=0,this.totalChunkSize=0,this.bufferCache=[],this.arrayCache=[],this.arrayPos=[]}setReturnBuffers(t){if(typeof t!="boolean")throw new TypeError("The returnBuffers argument has to be a boolean");this.optionReturnBuffers=t}setStringNumbers(t){if(typeof t!="boolean")throw new TypeError("The stringNumbers argument has to be a boolean");this.optionStringNumbers=t}execute(t){if(this.buffer===null)this.buffer=t,this.offset=0;else if(this.bigStrSize===0){let s=this.buffer.length,n=s-this.offset,i=mn.allocUnsafe(n+t.length);if(this.buffer.copy(i,0,this.offset,s),t.copy(i,n,0,t.length),this.buffer=i,this.offset=0,this.arrayCache.length){let o=hn(this);if(o===void 0)return;this.returnReply(o)}}else if(this.totalChunkSize+t.length>=this.bigStrSize){this.bufferCache.push(t);var r=this.optionReturnBuffers?Qd(this):Vd(this);if(this.bigStrSize=0,this.bufferCache=[],this.buffer=t,this.arrayCache.length&&(this.arrayCache[0][this.arrayPos[0]++]=r,r=hn(this),r===void 0))return;this.returnReply(r)}else{this.bufferCache.push(t),this.totalChunkSize+=t.length;return}for(;this.offset<this.buffer.length;){let s=this.offset,n=this.buffer[this.offset++],i=Wo(this,n);if(i===void 0){this.arrayCache.length||this.bufferCache.length||(this.offset=s);return}n===45?this.returnError(i):this.returnReply(i)}this.buffer=null}};Jo.exports=pn});var ta=y((Km,ea)=>{"use strict";ea.exports=Zo()});var ra=y(bn=>{"use strict";Object.defineProperty(bn,"__esModule",{value:!0});var gn=class{constructor(){this.set={subscribe:{},psubscribe:{},ssubscribe:{}}}add(t,r){this.set[yn(t)][r]=!0}del(t,r){delete this.set[yn(t)][r]}channels(t){return Object.keys(this.set[yn(t)])}isEmpty(){return this.channels("subscribe").length===0&&this.channels("psubscribe").length===0&&this.channels("ssubscribe").length===0}};bn.default=gn;function yn(e){return e==="unsubscribe"?"subscribe":e==="punsubscribe"?"psubscribe":e==="sunsubscribe"?"ssubscribe":e}});var oa=y(_n=>{"use strict";Object.defineProperty(_n,"__esModule",{value:!0});var sa=Fe(),Yd=W(),Wd=ta(),Jd=ra(),Zd=(0,Yd.Debug)("dataHandler"),Sn=class{constructor(t,r){this.redis=t;let s=new Wd({stringNumbers:r.stringNumbers,returnBuffers:!0,returnError:n=>{this.returnError(n)},returnFatalError:n=>{this.returnFatalError(n)},returnReply:n=>{this.returnReply(n)}});t.stream.on("data",n=>{s.execute(n)})}returnFatalError(t){t.message+=". Please report this.",this.redis.recoverFromFatalError(t,t,{offlineQueue:!1})}returnError(t){let r=this.shiftCommand(t);r&&(t.command={name:r.command.name,args:r.command.args},this.redis.handleReconnection(t,r))}returnReply(t){if(this.handleMonitorReply(t)||this.handleSubscriberReply(t))return;let r=this.shiftCommand(t);r&&(sa.default.checkFlag("ENTER_SUBSCRIBER_MODE",r.command.name)?(this.redis.condition.subscriber=new Jd.default,this.redis.condition.subscriber.add(r.command.name,t[1].toString()),na(r.command,t[2])||this.redis.commandQueue.unshift(r)):sa.default.checkFlag("EXIT_SUBSCRIBER_MODE",r.command.name)?ia(r.command,t[2])||this.redis.commandQueue.unshift(r):r.command.resolve(t))}handleSubscriberReply(t){if(!this.redis.condition.subscriber)return!1;let r=Array.isArray(t)?t[0].toString():null;switch(Zd('receive reply "%s" in subscriber mode',r),r){case"message":this.redis.listeners("message").length>0&&this.redis.emit("message",t[1].toString(),t[2]?t[2].toString():""),this.redis.emit("messageBuffer",t[1],t[2]);break;case"pmessage":{let s=t[1].toString();this.redis.listeners("pmessage").length>0&&this.redis.emit("pmessage",s,t[2].toString(),t[3].toString()),this.redis.emit("pmessageBuffer",s,t[2],t[3]);break}case"smessage":{this.redis.listeners("smessage").length>0&&this.redis.emit("smessage",t[1].toString(),t[2]?t[2].toString():""),this.redis.emit("smessageBuffer",t[1],t[2]);break}case"ssubscribe":case"subscribe":case"psubscribe":{let s=t[1].toString();this.redis.condition.subscriber.add(r,s);let n=this.shiftCommand(t);if(!n)return;na(n.command,t[2])||this.redis.commandQueue.unshift(n);break}case"sunsubscribe":case"unsubscribe":case"punsubscribe":{let s=t[1]?t[1].toString():null;s&&this.redis.condition.subscriber.del(r,s);let n=t[2];Number(n)===0&&(this.redis.condition.subscriber=!1);let i=this.shiftCommand(t);if(!i)return;ia(i.command,n)||this.redis.commandQueue.unshift(i);break}default:{let s=this.shiftCommand(t);if(!s)return;s.command.resolve(t)}}return!0}handleMonitorReply(t){if(this.redis.status!=="monitoring")return!1;let r=t.toString();if(r==="OK")return!1;let s=r.indexOf(" "),n=r.slice(0,s),i=r.indexOf('"'),o=r.slice(i+1,-1).split('" "').map(l=>l.replace(/\\"/g,'"')),a=r.slice(s+2,i-2).split(" ");return this.redis.emit("monitor",n,o,a[1],a[0]),!0}shiftCommand(t){let r=this.redis.commandQueue.shift();if(!r){let s="Command queue state error. If you can reproduce this, please report it.",n=new Error(s+(t instanceof Error?` Last error: ${t.message}`:` Last reply: ${t.toString()}`));return this.redis.emit("error",n),null}return r}};_n.default=Sn;var it=new WeakMap;function na(e,t){let r=it.has(e)?it.get(e):e.args.length;return r-=1,r<=0?(e.resolve(t),it.delete(e),!0):(it.set(e,r),!1)}function ia(e,t){let r=it.has(e)?it.get(e):e.args.length;return r===0?Number(t)===0?(it.delete(e),e.resolve(t),!0):!1:(r-=1,r<=0?(e.resolve(t),!0):(it.set(e,r),!1))}});var aa=y(be=>{"use strict";Object.defineProperty(be,"__esModule",{value:!0});be.readyHandler=be.errorHandler=be.closeHandler=be.connectHandler=void 0;var eh=pt(),th=Fe(),rh=Xo(),er=W(),sh=oa(),Z=(0,er.Debug)("connection");function nh(e){return function(){e.setStatus("connect"),e.resetCommandQueue();let t=!1,{connectionEpoch:r}=e;e.condition.auth&&e.auth(e.condition.auth,function(s){r===e.connectionEpoch&&s&&(s.message.indexOf("no password is set")!==-1?console.warn("[WARN] Redis server does not require a password, but a password was supplied."):s.message.indexOf("without any password configured for the default user")!==-1?console.warn("[WARN] This Redis server's `default` user does not require a password, but a password was supplied"):s.message.indexOf("wrong number of arguments for 'auth' command")!==-1?console.warn(`[ERROR] The server returned "wrong number of arguments for 'auth' command". You are probably passing both username and password to Redis version 5 or below. You should only pass the 'password' option for Redis version 5 and under.`):(t=!0,e.recoverFromFatalError(s,s)))}),e.condition.select&&e.select(e.condition.select).catch(s=>{e.silentEmit("error",s)}),e.options.enableReadyCheck||be.readyHandler(e)(),new sh.default(e,{stringNumbers:e.options.stringNumbers}),e.options.enableReadyCheck&&e._readyCheck(function(s,n){r===e.connectionEpoch&&(s?t||e.recoverFromFatalError(new Error("Ready check failed: "+s.message),s):e.connector.check(n)?be.readyHandler(e)():e.disconnect(!0))})}}be.connectHandler=nh;function An(e){let t=new eh.AbortError("Command aborted due to connection close");return t.command={name:e.name,args:e.args},t}function ih(e){var t;let r=0;for(let s=0;s<e.length;){let n=(t=e.peekAt(s))===null||t===void 0?void 0:t.command,i=n.pipelineIndex;if((i===void 0||i===0)&&(r=0),i!==void 0&&i!==r++){e.remove(s,1),n.reject(An(n));continue}s++}}function oh(e){var t;for(let r=0;r<e.length;){let s=(t=e.peekAt(r))===null||t===void 0?void 0:t.command;if(s.name==="multi")break;if(s.name==="exec"){e.remove(r,1),s.reject(An(s));break}s.inTransaction?(e.remove(r,1),s.reject(An(s))):r++}}function ah(e){return function(){let r=e.status;if(e.setStatus("close"),e.commandQueue.length&&ih(e.commandQueue),e.offlineQueue.length&&oh(e.offlineQueue),r==="ready"&&(e.prevCondition||(e.prevCondition=e.condition),e.commandQueue.length&&(e.prevCommandQueue=e.commandQueue)),e.manuallyClosing)return e.manuallyClosing=!1,Z("skip reconnecting since the connection is manually closed."),t();if(typeof e.options.retryStrategy!="function")return Z("skip reconnecting because `retryStrategy` is not a function"),t();let s=e.options.retryStrategy(++e.retryAttempts);if(typeof s!="number")return Z("skip reconnecting because `retryStrategy` doesn't return a number"),t();Z("reconnect in %sms",s),e.setStatus("reconnecting",s),e.reconnectTimeout=setTimeout(function(){e.reconnectTimeout=null,e.connect().catch(er.noop)},s);let{maxRetriesPerRequest:n}=e.options;typeof n=="number"&&(n<0?Z("maxRetriesPerRequest is negative, ignoring..."):e.retryAttempts%(n+1)===0&&(Z("reach maxRetriesPerRequest limitation, flushing command queue..."),e.flushQueue(new rh.MaxRetriesPerRequestError(n))))};function t(){e.setStatus("end"),e.flushQueue(new Error(er.CONNECTION_CLOSED_ERROR_MSG))}}be.closeHandler=ah;function lh(e){return function(t){Z("error: %s",t),e.silentEmit("error",t)}}be.errorHandler=lh;function ch(e){return function(){if(e.setStatus("ready"),e.retryAttempts=0,e.options.monitor){e.call("monitor").then(()=>e.setStatus("monitoring"),s=>e.emit("error",s));let{sendCommand:r}=e;e.sendCommand=function(s){return th.default.checkFlag("VALID_IN_MONITOR_MODE",s.name)?r.call(e,s):(s.reject(new Error("Connection is in monitoring mode, can't process commands.")),s.promise)},e.once("close",function(){delete e.sendCommand});return}let t=e.prevCondition?e.prevCondition.select:e.condition.select;if(e.options.connectionName&&(Z("set the connection name [%s]",e.options.connectionName),e.client("setname",e.options.connectionName).catch(er.noop)),e.options.readOnly&&(Z("set the connection to readonly mode"),e.readonly().catch(er.noop)),e.prevCondition){let r=e.prevCondition;if(e.prevCondition=null,r.subscriber&&e.options.autoResubscribe){e.condition.select!==t&&(Z("connect to db [%d]",t),e.select(t));let s=r.subscriber.channels("subscribe");s.length&&(Z("subscribe %d channels",s.length),e.subscribe(s));let n=r.subscriber.channels("psubscribe");n.length&&(Z("psubscribe %d channels",n.length),e.psubscribe(n));let i=r.subscriber.channels("ssubscribe");i.length&&(Z("ssubscribe %d channels",i.length),e.ssubscribe(i))}}if(e.prevCommandQueue)if(e.options.autoResendUnfulfilledCommands)for(Z("resend %d unfulfilled commands",e.prevCommandQueue.length);e.prevCommandQueue.length>0;){let r=e.prevCommandQueue.shift();r.select!==e.condition.select&&r.command.name!=="select"&&e.select(r.select),e.sendCommand(r.command,r.stream)}else e.prevCommandQueue=null;if(e.offlineQueue.length){Z("send %d commands in offline queue",e.offlineQueue.length);let r=e.offlineQueue;for(e.resetOfflineQueue();r.length>0;){let s=r.shift();s.select!==e.condition.select&&s.command.name!=="select"&&e.select(s.select),e.sendCommand(s.command,s.stream)}}e.condition.select!==t&&(Z("connect to db [%d]",t),e.select(t))}}be.readyHandler=ch});var la=y(qr=>{"use strict";Object.defineProperty(qr,"__esModule",{value:!0});qr.DEFAULT_REDIS_OPTIONS=void 0;qr.DEFAULT_REDIS_OPTIONS={port:6379,host:"localhost",family:4,connectTimeout:1e4,disconnectTimeout:2e3,retryStrategy:function(e){return Math.min(e*50,2e3)},keepAlive:0,noDelay:!0,connectionName:null,sentinels:null,name:null,role:"master",sentinelRetryStrategy:function(e){return Math.min(e*10,1e3)},sentinelReconnectStrategy:function(){return 6e4},natMap:null,enableTLSForSentinelMode:!1,updateSentinels:!0,failoverDetector:!1,username:null,password:null,db:0,enableOfflineQueue:!0,enableReadyCheck:!0,autoResubscribe:!0,autoResendUnfulfilledCommands:!0,lazyConnect:!1,keyPrefix:"",reconnectOnError:null,readOnly:!1,stringNumbers:!1,maxRetriesPerRequest:20,maxLoadingRetryTime:1e4,enableAutoPipelining:!1,autoPipeliningIgnoredCommands:[],sentinelMaxConnections:10}});var nt=y(Cn=>{"use strict";Object.defineProperty(Cn,"__esModule",{value:!0});var ca=xt(),fa=require("events"),En=et(),uh=Ws(),wn=Fe(),fh=Ho(),dh=Lr(),ot=aa(),hh=la(),ph=kr(),mh=qs(),bt=W(),yh=Fs(),gh=Or(),at=br(),ua=Nr(),lt=(0,bt.Debug)("redis"),Se=class extends gh.default{constructor(t,r,s){if(super(),this.status="wait",this.isCluster=!1,this.reconnectTimeout=null,this.connectionEpoch=0,this.retryAttempts=0,this.manuallyClosing=!1,this._autoPipelines=new Map,this._runningAutoPipelines=new Set,this.parseOptions(t,r,s),fa.EventEmitter.call(this),this.resetCommandQueue(),this.resetOfflineQueue(),this.options.Connector)this.connector=new this.options.Connector(this.options);else if(this.options.sentinels){let n=new dh.default(this.options);n.emitter=this,this.connector=n}else this.connector=new fh.StandaloneConnector(this.options);this.options.scripts&&Object.entries(this.options.scripts).forEach(([n,i])=>{this.defineCommand(n,i)}),this.options.lazyConnect?this.setStatus("wait"):this.connect().catch(at.noop)}static createClient(...t){return new Se(...t)}get autoPipelineQueueSize(){let t=0;for(let r of this._autoPipelines.values())t+=r.length;return t}connect(t){let r=new Promise((s,n)=>{if(this.status==="connecting"||this.status==="connect"||this.status==="ready"){n(new Error("Redis is already connecting/connected"));return}this.connectionEpoch+=1,this.setStatus("connecting");let{options:i}=this;this.condition={select:i.db,auth:i.username?[i.username,i.password]:i.password,subscriber:!1};let o=this;(0,En.default)(this.connector.connect(function(a,l){o.silentEmit(a,l)}),function(a,l){if(a){o.flushQueue(a),o.silentEmit("error",a),n(a),o.setStatus("end");return}let c=i.tls?"secureConnect":"connect";if("sentinels"in i&&i.sentinels&&!i.enableTLSForSentinelMode&&(c="connect"),o.stream=l,i.noDelay&&l.setNoDelay(!0),typeof i.keepAlive=="number"&&(l.connecting?l.once(c,()=>{l.setKeepAlive(!0,i.keepAlive)}):l.setKeepAlive(!0,i.keepAlive)),l.connecting){if(l.once(c,ot.connectHandler(o)),i.connectTimeout){let d=!1;l.setTimeout(i.connectTimeout,function(){if(d)return;l.setTimeout(0),l.destroy();let p=new Error("connect ETIMEDOUT");p.errorno="ETIMEDOUT",p.code="ETIMEDOUT",p.syscall="connect",ot.errorHandler(o)(p)}),l.once(c,function(){d=!0,l.setTimeout(0)})}}else if(l.destroyed){let d=o.connector.firstError;d&&process.nextTick(()=>{ot.errorHandler(o)(d)}),process.nextTick(ot.closeHandler(o))}else process.nextTick(ot.connectHandler(o));l.destroyed||(l.once("error",ot.errorHandler(o)),l.once("close",ot.closeHandler(o)));let f=function(){o.removeListener("close",u),s()};var u=function(){o.removeListener("ready",f),n(new Error(bt.CONNECTION_CLOSED_ERROR_MSG))};o.once("ready",f),o.once("close",u)})});return(0,En.default)(r,t)}disconnect(t=!1){t||(this.manuallyClosing=!0),this.reconnectTimeout&&!t&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null),this.status==="wait"?ot.closeHandler(this)():this.connector.disconnect()}end(){this.disconnect()}duplicate(t){return new Se({...this.options,...t})}get mode(){var t;return this.options.monitor?"monitor":!((t=this.condition)===null||t===void 0)&&t.subscriber?"subscriber":"normal"}monitor(t){let r=this.duplicate({monitor:!0,lazyConnect:!1});return(0,En.default)(new Promise(function(s,n){r.once("error",n),r.once("monitoring",function(){s(r)})}),t)}sendCommand(t,r){var s,n;if(this.status==="wait"&&this.connect().catch(at.noop),this.status==="end")return t.reject(new Error(bt.CONNECTION_CLOSED_ERROR_MSG)),t.promise;if(!((s=this.condition)===null||s===void 0)&&s.subscriber&&!wn.default.checkFlag("VALID_IN_SUBSCRIBER_MODE",t.name))return t.reject(new Error("Connection in subscriber mode, only subscriber commands may be used")),t.promise;typeof this.options.commandTimeout=="number"&&t.setTimeout(this.options.commandTimeout);let i=this.status==="ready"||!r&&this.status==="connect"&&(0,ca.exists)(t.name)&&(0,ca.hasFlag)(t.name,"loading");if(this.stream&&this.stream.writable?this.stream._writableState&&this.stream._writableState.ended&&(i=!1):i=!1,i)lt.enabled&&lt("write command[%s]: %d -> %s(%o)",this._getDescription(),(n=this.condition)===null||n===void 0?void 0:n.select,t.name,t.args),r?"isPipeline"in r&&r.isPipeline?r.write(t.toWritable(r.destination.redis.stream)):r.write(t.toWritable(r)):this.stream.write(t.toWritable(this.stream)),this.commandQueue.push({command:t,stream:r,select:this.condition.select}),wn.default.checkFlag("WILL_DISCONNECT",t.name)&&(this.manuallyClosing=!0);else{if(!this.options.enableOfflineQueue)return t.reject(new Error("Stream isn't writeable and enableOfflineQueue options is false")),t.promise;if(t.name==="quit"&&this.offlineQueue.length===0)return this.disconnect(),t.resolve(Buffer.from("OK")),t.promise;lt.enabled&&lt("queue command[%s]: %d -> %s(%o)",this._getDescription(),this.condition.select,t.name,t.args),this.offlineQueue.push({command:t,stream:r,select:this.condition.select})}if(t.name==="select"&&(0,bt.isInt)(t.args[0])){let o=parseInt(t.args[0],10);this.condition.select!==o&&(this.condition.select=o,this.emit("select",o),lt("switch to db [%d]",this.condition.select))}return t.promise}scanStream(t){return this.createScanStream("scan",{options:t})}scanBufferStream(t){return this.createScanStream("scanBuffer",{options:t})}sscanStream(t,r){return this.createScanStream("sscan",{key:t,options:r})}sscanBufferStream(t,r){return this.createScanStream("sscanBuffer",{key:t,options:r})}hscanStream(t,r){return this.createScanStream("hscan",{key:t,options:r})}hscanBufferStream(t,r){return this.createScanStream("hscanBuffer",{key:t,options:r})}zscanStream(t,r){return this.createScanStream("zscan",{key:t,options:r})}zscanBufferStream(t,r){return this.createScanStream("zscanBuffer",{key:t,options:r})}silentEmit(t,r){let s;if(!(t==="error"&&(s=r,this.status==="end"||this.manuallyClosing&&s instanceof Error&&(s.message===bt.CONNECTION_CLOSED_ERROR_MSG||s.syscall==="connect"||s.syscall==="read"))))return this.listeners(t).length>0?this.emit.apply(this,arguments):(s&&s instanceof Error&&console.error("[ioredis] Unhandled error event:",s.stack),!1)}recoverFromFatalError(t,r,s){this.flushQueue(r,s),this.silentEmit("error",r),this.disconnect(!0)}handleReconnection(t,r){var s;let n=!1;switch(this.options.reconnectOnError&&(n=this.options.reconnectOnError(t)),n){case 1:case!0:this.status!=="reconnecting"&&this.disconnect(!0),r.command.reject(t);break;case 2:this.status!=="reconnecting"&&this.disconnect(!0),((s=this.condition)===null||s===void 0?void 0:s.select)!==r.select&&r.command.name!=="select"&&this.select(r.select),this.sendCommand(r.command);break;default:r.command.reject(t)}}_getDescription(){let t;return"path"in this.options&&this.options.path?t=this.options.path:this.stream&&this.stream.remoteAddress&&this.stream.remotePort?t=this.stream.remoteAddress+":"+this.stream.remotePort:"host"in this.options&&this.options.host?t=this.options.host+":"+this.options.port:t="",this.options.connectionName&&(t+=` (${this.options.connectionName})`),t}resetCommandQueue(){this.commandQueue=new ua}resetOfflineQueue(){this.offlineQueue=new ua}parseOptions(...t){let r={},s=!1;for(let n=0;n<t.length;++n){let i=t[n];if(!(i===null||typeof i>"u"))if(typeof i=="object")(0,at.defaults)(r,i);else if(typeof i=="string")(0,at.defaults)(r,(0,bt.parseURL)(i)),i.startsWith("rediss://")&&(s=!0);else if(typeof i=="number")r.port=i;else throw new Error("Invalid argument "+i)}s&&(0,at.defaults)(r,{tls:!0}),(0,at.defaults)(r,Se.defaultOptions),typeof r.port=="string"&&(r.port=parseInt(r.port,10)),typeof r.db=="string"&&(r.db=parseInt(r.db,10)),this.options=(0,bt.resolveTLSProfile)(r)}setStatus(t,r){lt.enabled&&lt("status[%s]: %s -> %s",this._getDescription(),this.status||"[empty]",t),this.status=t,process.nextTick(this.emit.bind(this,t,r))}createScanStream(t,{key:r,options:s={}}){return new ph.default({objectMode:!0,key:r,redis:this,command:t,...s})}flushQueue(t,r){r=(0,at.defaults)({},r,{offlineQueue:!0,commandQueue:!0});let s;if(r.offlineQueue)for(;s=this.offlineQueue.shift();)s.command.reject(t);if(r.commandQueue&&this.commandQueue.length>0)for(this.stream&&this.stream.removeAllListeners("data");s=this.commandQueue.shift();)s.command.reject(t)}_readyCheck(t){let r=this;this.info(function(s,n){if(s)return s.message&&s.message.includes("NOPERM")?(console.warn(`Skipping the ready check because INFO command fails: "${s.message}". You can disable ready check with "enableReadyCheck". More: https://github.com/luin/ioredis/wiki/Disable-ready-check.`),t(null,{})):t(s);if(typeof n!="string")return t(null,n);let i={},o=n.split(`\r
`);for(let a=0;a<o.length;++a){let[l,...c]=o[a].split(":"),f=c.join(":");f&&(i[l]=f)}if(!i.loading||i.loading==="0")t(null,i);else{let a=(i.loading_eta_seconds||1)*1e3,l=r.options.maxLoadingRetryTime&&r.options.maxLoadingRetryTime<a?r.options.maxLoadingRetryTime:a;lt("Redis server still loading, trying again in "+l+"ms"),setTimeout(function(){r._readyCheck(t)},l)}}).catch(at.noop)}};Se.Cluster=uh.default;Se.Command=wn.default;Se.defaultOptions=hh.DEFAULT_REDIS_OPTIONS;(0,yh.default)(Se,fa.EventEmitter);(0,mh.addTransactionSupport)(Se.prototype);Cn.default=Se});var pa=y((T,ha)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});T.print=T.ReplyError=T.SentinelIterator=T.SentinelConnector=T.AbstractConnector=T.Pipeline=T.ScanStream=T.Command=T.Cluster=T.Redis=T.default=void 0;T=ha.exports=nt().default;var bh=nt();Object.defineProperty(T,"default",{enumerable:!0,get:function(){return bh.default}});var Sh=nt();Object.defineProperty(T,"Redis",{enumerable:!0,get:function(){return Sh.default}});var _h=Ws();Object.defineProperty(T,"Cluster",{enumerable:!0,get:function(){return _h.default}});var Ah=Fe();Object.defineProperty(T,"Command",{enumerable:!0,get:function(){return Ah.default}});var Eh=kr();Object.defineProperty(T,"ScanStream",{enumerable:!0,get:function(){return Eh.default}});var wh=Ls();Object.defineProperty(T,"Pipeline",{enumerable:!0,get:function(){return wh.default}});var Ch=Dr();Object.defineProperty(T,"AbstractConnector",{enumerable:!0,get:function(){return Ch.default}});var da=Lr();Object.defineProperty(T,"SentinelConnector",{enumerable:!0,get:function(){return da.default}});Object.defineProperty(T,"SentinelIterator",{enumerable:!0,get:function(){return da.SentinelIterator}});T.ReplyError=pt().ReplyError;Object.defineProperty(T,"Promise",{get(){return console.warn("ioredis v5 does not support plugging third-party Promise library anymore. Native Promise will be used."),Promise},set(e){console.warn("ioredis v5 does not support plugging third-party Promise library anymore. Native Promise will be used.")}});function kh(e,t){console.log(e?"Error: "+e:"Reply: "+t)}T.print=kh});var ga=y((ey,ya)=>{"use strict";ya.exports=function(...e){try{return JSON.stringify(...e)}catch(t){return"[Cannot display object: "+t.message+"]"}}});var kn=y((ba,Sa)=>{"use strict";var Oh=ga();Sa.exports=class extends Error{constructor(e){let t=e.filter(r=>r!=="").map(r=>typeof r=="string"?r:r instanceof Error?r.message:Oh(r));super(t.join(" ")||"Unknown error"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,ba.assert)}}});var R=y((ry,_a)=>{"use strict";var vh=kn();_a.exports=function(e,...t){if(!e)throw t.length===1&&t[0]instanceof Error?t[0]:new vh(t)}});var St=y((sy,Ea)=>{"use strict";var Rn=R(),Aa={};Ea.exports=function(e,t,r){if(t===!1||t===null||t===void 0)return e;r=r||{},typeof r=="string"&&(r={separator:r});let s=Array.isArray(t);Rn(!s||!r.separator,"Separator option is not valid for array-based chain");let n=s?t:t.split(r.separator||"."),i=e;for(let o=0;o<n.length;++o){let a=n[o],l=r.iterables&&Aa.iterables(i);if(Array.isArray(i)||l==="set"){let c=Number(a);Number.isInteger(c)&&(a=c<0?i.length+c:c)}if(!i||typeof i=="function"&&r.functions===!1||!l&&i[a]===void 0){Rn(!r.strict||o+1===n.length,"Missing segment",a,"in reach path ",t),Rn(typeof i=="object"||r.functions===!0||typeof i!="function","Invalid segment",a,"in reach path ",t),i=r.default;break}l?l==="set"?i=[...i][a]:i=i.get(a):i=i[a]}return i};Aa.iterables=function(e){if(e instanceof Set)return"set";if(e instanceof Map)return"map"}});var On=y((ie,Ca)=>{"use strict";var wa={};ie=Ca.exports={array:Array.prototype,buffer:Buffer&&Buffer.prototype,date:Date.prototype,error:Error.prototype,generic:Object.prototype,map:Map.prototype,promise:Promise.prototype,regex:RegExp.prototype,set:Set.prototype,weakMap:WeakMap.prototype,weakSet:WeakSet.prototype};wa.typeMap=new Map([["[object Error]",ie.error],["[object Map]",ie.map],["[object Promise]",ie.promise],["[object Set]",ie.set],["[object WeakMap]",ie.weakMap],["[object WeakSet]",ie.weakSet]]);ie.getInternalProto=function(e){if(Array.isArray(e))return ie.array;if(Buffer&&e instanceof Buffer)return ie.buffer;if(e instanceof Date)return ie.date;if(e instanceof RegExp)return ie.regex;if(e instanceof Error)return ie.error;let t=Object.prototype.toString.call(e);return wa.typeMap.get(t)||ie.generic}});var vn=y(ka=>{"use strict";ka.keys=function(e,t={}){return t.symbols!==!1?Reflect.ownKeys(e):Object.getOwnPropertyNames(e)}});var oe=y((iy,Ra)=>{"use strict";var xh=St(),pe=On(),Ih=vn(),He={needsProtoHack:new Set([pe.set,pe.map,pe.weakSet,pe.weakMap])};Ra.exports=He.clone=function(e,t={},r=null){if(typeof e!="object"||e===null)return e;let s=He.clone,n=r;if(t.shallow){if(t.shallow!==!0)return He.cloneWithShallow(e,t);s=l=>l}else if(n){let l=n.get(e);if(l)return l}else n=new Map;let i=pe.getInternalProto(e);if(i===pe.buffer)return Buffer&&Buffer.from(e);if(i===pe.date)return new Date(e.getTime());if(i===pe.regex)return new RegExp(e);let o=He.base(e,i,t);if(o===e)return e;if(n&&n.set(e,o),i===pe.set)for(let l of e)o.add(s(l,t,n));else if(i===pe.map)for(let[l,c]of e)o.set(l,s(c,t,n));let a=Ih.keys(e,t);for(let l of a){if(l==="__proto__")continue;if(i===pe.array&&l==="length"){o.length=e.length;continue}let c=Object.getOwnPropertyDescriptor(e,l);c?c.get||c.set?Object.defineProperty(o,l,c):c.enumerable?o[l]=s(e[l],t,n):Object.defineProperty(o,l,{enumerable:!1,writable:!0,configurable:!0,value:s(e[l],t,n)}):Object.defineProperty(o,l,{enumerable:!0,writable:!0,configurable:!0,value:s(e[l],t,n)})}return o};He.cloneWithShallow=function(e,t){let r=t.shallow;t=Object.assign({},t),t.shallow=!1;let s=new Map;for(let n of r){let i=xh(e,n);(typeof i=="object"||typeof i=="function")&&s.set(i,i)}return He.clone(e,t,s)};He.base=function(e,t,r){if(r.prototype===!1)return He.needsProtoHack.has(t)?new t.constructor:t===pe.array?[]:{};let s=Object.getPrototypeOf(e);if(s&&s.isImmutable)return e;if(t===pe.array){let n=[];return s!==t&&Object.setPrototypeOf(n,s),n}if(He.needsProtoHack.has(t)){let n=new s.constructor;return s!==t&&Object.setPrototypeOf(n,s),n}return Object.create(s)}});var Oa=y((oy,Th)=>{Th.exports={name:"joi",description:"Object schema validation",version:"17.9.2",repository:"git://github.com/hapijs/joi",main:"lib/index.js",types:"lib/index.d.ts",browser:"dist/joi-browser.min.js",files:["lib/**/*","dist/*"],keywords:["schema","validation"],dependencies:{"@hapi/hoek":"^9.0.0","@hapi/topo":"^5.0.0","@sideway/address":"^4.1.3","@sideway/formula":"^3.0.1","@sideway/pinpoint":"^2.0.0"},devDependencies:{"@hapi/bourne":"2.x.x","@hapi/code":"8.x.x","@hapi/joi-legacy-test":"npm:@hapi/joi@15.x.x","@hapi/lab":"^25.0.1","@types/node":"^14.18.24",typescript:"4.3.x"},scripts:{prepublishOnly:"cd browser && npm install && npm run build",test:"lab -t 100 -a @hapi/code -L -Y","test-cov-html":"lab -r html -o coverage.html -a @hapi/code"},license:"BSD-3-Clause"}});var jr=y(tr=>{"use strict";var h=xn(),E={};E.wrap=h.string().min(1).max(2).allow(!1);tr.preferences=h.object({allowUnknown:h.boolean(),abortEarly:h.boolean(),artifacts:h.boolean(),cache:h.boolean(),context:h.object(),convert:h.boolean(),dateFormat:h.valid("date","iso","string","time","utc"),debug:h.boolean(),errors:{escapeHtml:h.boolean(),label:h.valid("path","key",!1),language:[h.string(),h.object().ref()],render:h.boolean(),stack:h.boolean(),wrap:{label:E.wrap,array:E.wrap,string:E.wrap}},externals:h.boolean(),messages:h.object(),noDefaults:h.boolean(),nonEnumerables:h.boolean(),presence:h.valid("required","optional","forbidden"),skipFunctions:h.boolean(),stripUnknown:h.object({arrays:h.boolean(),objects:h.boolean()}).or("arrays","objects").allow(!0,!1),warnings:h.boolean()}).strict();E.nameRx=/^[a-zA-Z0-9]\w*$/;E.rule=h.object({alias:h.array().items(h.string().pattern(E.nameRx)).single(),args:h.array().items(h.string(),h.object({name:h.string().pattern(E.nameRx).required(),ref:h.boolean(),assert:h.alternatives([h.function(),h.object().schema()]).conditional("ref",{is:!0,then:h.required()}),normalize:h.function(),message:h.string().when("assert",{is:h.function(),then:h.required()})})),convert:h.boolean(),manifest:h.boolean(),method:h.function().allow(!1),multi:h.boolean(),validate:h.function()});tr.extension=h.object({type:h.alternatives([h.string(),h.object().regex()]).required(),args:h.function(),cast:h.object().pattern(E.nameRx,h.object({from:h.function().maxArity(1).required(),to:h.function().minArity(1).maxArity(2).required()})),base:h.object().schema().when("type",{is:h.object().regex(),then:h.forbidden()}),coerce:[h.function().maxArity(3),h.object({method:h.function().maxArity(3).required(),from:h.array().items(h.string()).single()})],flags:h.object().pattern(E.nameRx,h.object({setter:h.string(),default:h.any()})),manifest:{build:h.function().arity(2)},messages:[h.object(),h.string()],modifiers:h.object().pattern(E.nameRx,h.function().minArity(1).maxArity(2)),overrides:h.object().pattern(E.nameRx,h.function()),prepare:h.function().maxArity(3),rebuild:h.function().arity(1),rules:h.object().pattern(E.nameRx,E.rule),terms:h.object().pattern(E.nameRx,h.object({init:h.array().allow(null).required(),manifest:h.object().pattern(/.+/,[h.valid("schema","single"),h.object({mapped:h.object({from:h.string().required(),to:h.string().required()}).required()})])})),validate:h.function().maxArity(3)}).strict();tr.extensions=h.array().items(h.object(),h.function().arity(1)).strict();E.desc={buffer:h.object({buffer:h.string()}),func:h.object({function:h.function().required(),options:{literal:!0}}),override:h.object({override:!0}),ref:h.object({ref:h.object({type:h.valid("value","global","local"),path:h.array().required(),separator:h.string().length(1).allow(!1),ancestor:h.number().min(0).integer().allow("root"),map:h.array().items(h.array().length(2)).min(1),adjust:h.function(),iterables:h.boolean(),in:h.boolean(),render:h.boolean()}).required()}),regex:h.object({regex:h.string().min(3)}),special:h.object({special:h.valid("deep").required()}),template:h.object({template:h.string().required(),options:h.object()}),value:h.object({value:h.alternatives([h.object(),h.array()]).required()})};E.desc.entity=h.alternatives([h.array().items(h.link("...")),h.boolean(),h.function(),h.number(),h.string(),E.desc.buffer,E.desc.func,E.desc.ref,E.desc.regex,E.desc.special,E.desc.template,E.desc.value,h.link("/")]);E.desc.values=h.array().items(null,h.boolean(),h.function(),h.number().allow(1/0,-1/0),h.string().allow(""),h.symbol(),E.desc.buffer,E.desc.func,E.desc.override,E.desc.ref,E.desc.regex,E.desc.template,E.desc.value);E.desc.messages=h.object().pattern(/.+/,[h.string(),E.desc.template,h.object().pattern(/.+/,[h.string(),E.desc.template])]);tr.description=h.object({type:h.string().required(),flags:h.object({cast:h.string(),default:h.any(),description:h.string(),empty:h.link("/"),failover:E.desc.entity,id:h.string(),label:h.string(),only:!0,presence:["optional","required","forbidden"],result:["raw","strip"],strip:h.boolean(),unit:h.string()}).unknown(),preferences:{allowUnknown:h.boolean(),abortEarly:h.boolean(),artifacts:h.boolean(),cache:h.boolean(),convert:h.boolean(),dateFormat:["date","iso","string","time","utc"],errors:{escapeHtml:h.boolean(),label:["path","key"],language:[h.string(),E.desc.ref],wrap:{label:E.wrap,array:E.wrap}},externals:h.boolean(),messages:E.desc.messages,noDefaults:h.boolean(),nonEnumerables:h.boolean(),presence:["required","optional","forbidden"],skipFunctions:h.boolean(),stripUnknown:h.object({arrays:h.boolean(),objects:h.boolean()}).or("arrays","objects").allow(!0,!1),warnings:h.boolean()},allow:E.desc.values,invalid:E.desc.values,rules:h.array().min(1).items({name:h.string().required(),args:h.object().min(1),keep:h.boolean(),message:[h.string(),E.desc.messages],warn:h.boolean()}),keys:h.object().pattern(/.*/,h.link("/")),link:E.desc.ref}).pattern(/^[a-z]\w*$/,h.any())});var xa=y((ly,va)=>{"use strict";var ct={};va.exports=function(e){if(!e)return"";let t="";for(let r=0;r<e.length;++r){let s=e.charCodeAt(r);ct.isSafe(s)?t+=e[r]:t+=ct.escapeHtmlChar(s)}return t};ct.escapeHtmlChar=function(e){let t=ct.namedHtml.get(e);return t||(e>=256?"&#"+e+";":`&#x${e.toString(16).padStart(2,"0")};`)};ct.isSafe=function(e){return ct.safeCharCodes.has(e)};ct.namedHtml=new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[34,"&quot;"],[160,"&nbsp;"],[162,"&cent;"],[163,"&pound;"],[164,"&curren;"],[169,"&copy;"],[174,"&reg;"]]);ct.safeCharCodes=function(){let e=new Set;for(let t=32;t<123;++t)(t>=97||t>=65&&t<=90||t>=48&&t<=57||t===32||t===46||t===44||t===45||t===58||t===95)&&e.add(t);return e}()});var Ia=y(rr=>{"use strict";var k={operators:["!","^","*","/","%","+","-","<","<=",">",">=","==","!=","&&","||","??"],operatorCharacters:["!","^","*","/","%","+","-","<","=",">","&","|","?"],operatorsOrder:[["^"],["*","/","%"],["+","-"],["<","<=",">",">="],["==","!="],["&&"],["||","??"]],operatorsPrefix:["!","n"],literals:{'"':'"',"`":"`","'":"'","[":"]"},numberRx:/^(?:[0-9]*(\.[0-9]*)?){1}$/,tokenRx:/^[\w\$\#\.\@\:\{\}]+$/,symbol:Symbol("formula"),settings:Symbol("settings")};rr.Parser=class{constructor(e,t={}){if(!t[k.settings]&&t.constants)for(let r in t.constants){let s=t.constants[r];if(s!==null&&!["boolean","number","string"].includes(typeof s))throw new Error(`Formula constant ${r} contains invalid ${typeof s} value type`)}this.settings=t[k.settings]?t:Object.assign({[k.settings]:!0,constants:{},functions:{}},t),this.single=null,this._parts=null,this._parse(e)}_parse(e){let t=[],r="",s=0,n=!1,i=a=>{if(s)throw new Error("Formula missing closing parenthesis");let l=t.length?t[t.length-1]:null;if(!(!n&&!r&&!a)){if(l&&l.type==="reference"&&a===")"){l.type="function",l.value=this._subFormula(r,l.value),r="";return}if(a===")"){let c=new rr.Parser(r,this.settings);t.push({type:"segment",value:c})}else if(n){if(n==="]"){t.push({type:"reference",value:r}),r="";return}t.push({type:"literal",value:r})}else if(k.operatorCharacters.includes(r))l&&l.type==="operator"&&k.operators.includes(l.value+r)?l.value+=r:t.push({type:"operator",value:r});else if(r.match(k.numberRx))t.push({type:"constant",value:parseFloat(r)});else if(this.settings.constants[r]!==void 0)t.push({type:"constant",value:this.settings.constants[r]});else{if(!r.match(k.tokenRx))throw new Error(`Formula contains invalid token: ${r}`);t.push({type:"reference",value:r})}r=""}};for(let a of e)n?a===n?(i(),n=!1):r+=a:s?a==="("?(r+=a,++s):a===")"?(--s,s?r+=a:i(a)):r+=a:a in k.literals?n=k.literals[a]:a==="("?(i(),++s):k.operatorCharacters.includes(a)?(i(),r=a,i()):a!==" "?r+=a:i();i(),t=t.map((a,l)=>a.type!=="operator"||a.value!=="-"||l&&t[l-1].type!=="operator"?a:{type:"operator",value:"n"});let o=!1;for(let a of t){if(a.type==="operator"){if(k.operatorsPrefix.includes(a.value))continue;if(!o)throw new Error("Formula contains an operator in invalid position");if(!k.operators.includes(a.value))throw new Error(`Formula contains an unknown operator ${a.value}`)}else if(o)throw new Error("Formula missing expected operator");o=!o}if(!o)throw new Error("Formula contains invalid trailing operator");t.length===1&&["reference","literal","constant"].includes(t[0].type)&&(this.single={type:t[0].type==="reference"?"reference":"value",value:t[0].value}),this._parts=t.map(a=>{if(a.type==="operator")return k.operatorsPrefix.includes(a.value)?a:a.value;if(a.type!=="reference")return a.value;if(this.settings.tokenRx&&!this.settings.tokenRx.test(a.value))throw new Error(`Formula contains invalid reference ${a.value}`);return this.settings.reference?this.settings.reference(a.value):k.reference(a.value)})}_subFormula(e,t){let r=this.settings.functions[t];if(typeof r!="function")throw new Error(`Formula contains unknown function ${t}`);let s=[];if(e){let n="",i=0,o=!1,a=()=>{if(!n)throw new Error(`Formula contains function ${t} with invalid arguments ${e}`);s.push(n),n=""};for(let l=0;l<e.length;++l){let c=e[l];o?(n+=c,c===o&&(o=!1)):c in k.literals&&!i?(n+=c,o=k.literals[c]):c===","&&!i?a():(n+=c,c==="("?++i:c===")"&&--i)}a()}return s=s.map(n=>new rr.Parser(n,this.settings)),function(n){let i=[];for(let o of s)i.push(o.evaluate(n));return r.call(n,...i)}}evaluate(e){let t=this._parts.slice();for(let r=t.length-2;r>=0;--r){let s=t[r];if(s&&s.type==="operator"){let n=t[r+1];t.splice(r+1,1);let i=k.evaluate(n,e);t[r]=k.single(s.value,i)}}return k.operatorsOrder.forEach(r=>{for(let s=1;s<t.length-1;)if(r.includes(t[s])){let n=t[s],i=k.evaluate(t[s-1],e),o=k.evaluate(t[s+1],e);t.splice(s,2);let a=k.calculate(n,i,o);t[s-1]=a===0?0:a}else s+=2}),k.evaluate(t[0],e)}};rr.Parser.prototype[k.symbol]=!0;k.reference=function(e){return function(t){return t&&t[e]!==void 0?t[e]:null}};k.evaluate=function(e,t){return e===null?null:typeof e=="function"?e(t):e[k.symbol]?e.evaluate(t):e};k.single=function(e,t){if(e==="!")return!t;let r=-t;return r===0?0:r};k.calculate=function(e,t,r){if(e==="??")return k.exists(t)?t:r;if(typeof t=="string"||typeof r=="string"){if(e==="+")return t=k.exists(t)?t:"",r=k.exists(r)?r:"",t+r}else switch(e){case"^":return Math.pow(t,r);case"*":return t*r;case"/":return t/r;case"%":return t%r;case"+":return t+r;case"-":return t-r}switch(e){case"<":return t<r;case"<=":return t<=r;case">":return t>r;case">=":return t>=r;case"==":return t===r;case"!=":return t!==r;case"&&":return t&&r;case"||":return t||r}return null};k.exists=function(e){return e!=null}});var Na=y(Ta=>{"use strict";var Nh=oe(),Mh=M(),_t={annotations:Symbol("annotations")};Ta.error=function(e){if(!this._original||typeof this._original!="object")return this.details[0].message;let t=e?"":"\x1B[31m",r=e?"":"\x1B[41m",s=e?"":"\x1B[0m",n=Nh(this._original);for(let a=this.details.length-1;a>=0;--a){let l=a+1,c=this.details[a],f=c.path,u=n;for(let d=0;;++d){let p=f[d];if(Mh.isSchema(u)&&(u=u.clone()),d+1<f.length&&typeof u[p]!="string")u=u[p];else{let m=u[_t.annotations]||{errors:{},missing:{}};u[_t.annotations]=m;let g=p||c.context.key;u[p]!==void 0?(m.errors[g]=m.errors[g]||[],m.errors[g].push(l)):m.missing[g]=l;break}}}let i={key:/_\$key\$_([, \d]+)_\$end\$_"/g,missing:/"_\$miss\$_([^|]+)\|(\d+)_\$end\$_": "__missing__"/g,arrayIndex:/\s*"_\$idx\$_([, \d]+)_\$end\$_",?\n(.*)/g,specials:/"\[(NaN|Symbol.*|-?Infinity|function.*|\(.*)]"/g},o=_t.safeStringify(n,2).replace(i.key,(a,l)=>`" ${t}[${l}]${s}`).replace(i.missing,(a,l,c)=>`${r}"${l}"${s}${t} [${c}]: -- missing --${s}`).replace(i.arrayIndex,(a,l,c)=>`
${c} ${t}[${l}]${s}`).replace(i.specials,(a,l)=>l);o=`${o}
${t}`;for(let a=0;a<this.details.length;++a){let l=a+1;o=`${o}
[${l}] ${this.details[a].message}`}return o=o+s,o};_t.safeStringify=function(e,t){return JSON.stringify(e,_t.serializer(),t)};_t.serializer=function(){let e=[],t=[],r=(s,n)=>t[0]===n?"[Circular ~]":"[Circular ~."+e.slice(0,t.indexOf(n)).join(".")+"]";return function(s,n){if(t.length>0){let i=t.indexOf(this);~i?(t.length=i+1,e.length=i+1,e[i]=s):(t.push(this),e.push(s)),~t.indexOf(n)&&(n=r.call(this,s,n))}else t.push(n);if(n){let i=n[_t.annotations];if(i){if(Array.isArray(n)){let o=[];for(let a=0;a<n.length;++a)i.errors[a]&&o.push(`_$idx$_${i.errors[a].sort().join(", ")}_$end$_`),o.push(n[a]);n=o}else{for(let o in i.errors)n[`${o}_$key$_${i.errors[o].sort().join(", ")}_$end$_`]=n[o],n[o]=void 0;for(let o in i.missing)n[`_$miss$_${o}|${i.missing[o]}_$end$_`]="__missing__"}return n}}return n===1/0||n===-1/0||Number.isNaN(n)||typeof n=="function"||typeof n=="symbol"?"["+n.toString()+"]":n}}});var ze=y(U=>{"use strict";var Dh=Na(),Bh=M(),Lh=ut();U.Report=class{constructor(e,t,r,s,n,i,o){if(this.code=e,this.flags=s,this.messages=n,this.path=i.path,this.prefs=o,this.state=i,this.value=t,this.message=null,this.template=null,this.local=r||{},this.local.label=U.label(this.flags,this.state,this.prefs,this.messages),this.value!==void 0&&!this.local.hasOwnProperty("value")&&(this.local.value=this.value),this.path.length){let a=this.path[this.path.length-1];typeof a!="object"&&(this.local.key=a)}}_setTemplate(e){if(this.template=e,!this.flags.label&&this.path.length===0){let t=this._template(this.template,"root");t&&(this.local.label=t)}}toString(){if(this.message)return this.message;let e=this.code;if(!this.prefs.errors.render)return this.code;let t=this._template(this.template)||this._template(this.prefs.messages)||this._template(this.messages);return t===void 0?`Error code "${e}" is not defined, your custom type is missing the correct messages definition`:(this.message=t.render(this.value,this.state,this.prefs,this.local,{errors:this.prefs.errors,messages:[this.prefs.messages,this.messages]}),this.prefs.errors.label||(this.message=this.message.replace(/^"" /,"").trim()),this.message)}_template(e,t){return U.template(this.value,e,t||this.code,this.state,this.prefs)}};U.path=function(e){let t="";for(let r of e)typeof r!="object"&&(typeof r=="string"?(t&&(t+="."),t+=r):t+=`[${r}]`);return t};U.template=function(e,t,r,s,n){if(!t)return;if(Lh.isTemplate(t))return r!=="root"?t:null;let i=n.errors.language;if(Bh.isResolvable(i)&&(i=i.resolve(e,s,n)),i&&t[i]){if(t[i][r]!==void 0)return t[i][r];if(t[i]["*"]!==void 0)return t[i]["*"]}return t[r]?t[r]:t["*"]};U.label=function(e,t,r,s){if(e.label)return e.label;if(!r.errors.label)return"";let n=t.path;r.errors.label==="key"&&t.path.length>1&&(n=t.path.slice(-1));let i=U.path(n);return i||U.template(null,r.messages,"root",t,r)||s&&U.template(null,s,"root",t,r)||"value"};U.process=function(e,t,r){if(!e)return null;let{override:s,message:n,details:i}=U.details(e);if(s)return s;if(r.errors.stack)return new U.ValidationError(n,i,t);let o=Error.stackTraceLimit;Error.stackTraceLimit=0;let a=new U.ValidationError(n,i,t);return Error.stackTraceLimit=o,a};U.details=function(e,t={}){let r=[],s=[];for(let n of e){if(n instanceof Error){if(t.override!==!1)return{override:n};let o=n.toString();r.push(o),s.push({message:o,type:"override",context:{error:n}});continue}let i=n.toString();r.push(i),s.push({message:i,path:n.path.filter(o=>typeof o!="object"),type:n.code,context:n.local})}return r.length>1&&(r=[...new Set(r)]),{message:r.join(". "),details:s}};U.ValidationError=class extends Error{constructor(e,t,r){super(e),this._original=r,this.details=t}static isError(e){return e instanceof U.ValidationError}};U.ValidationError.prototype.isJoi=!0;U.ValidationError.prototype.name="ValidationError";U.ValidationError.prototype.annotate=Dh.error});var Xe=y(Ee=>{"use strict";var _e=R(),Ph=oe(),$h=St(),sr=M(),In,Ae={symbol:Symbol("ref"),defaults:{adjust:null,in:!1,iterables:null,map:null,separator:".",type:"value"}};Ee.create=function(e,t={}){_e(typeof e=="string","Invalid reference key:",e),sr.assertOptions(t,["adjust","ancestor","in","iterables","map","prefix","render","separator"]),_e(!t.prefix||typeof t.prefix=="object","options.prefix must be of type object");let r=Object.assign({},Ae.defaults,t);delete r.prefix;let s=r.separator,n=Ae.context(e,s,t.prefix);if(r.type=n.type,e=n.key,r.type==="value")if(n.root&&(_e(!s||e[0]!==s,"Cannot specify relative path with root prefix"),r.ancestor="root",e||(e=null)),s&&s===e)e=null,r.ancestor=0;else if(r.ancestor!==void 0)_e(!s||!e||e[0]!==s,"Cannot combine prefix with ancestor option");else{let[i,o]=Ae.ancestor(e,s);o&&(e=e.slice(o),e===""&&(e=null)),r.ancestor=i}return r.path=s?e===null?[]:e.split(s):[e],new Ae.Ref(r)};Ee.in=function(e,t={}){return Ee.create(e,{...t,in:!0})};Ee.isRef=function(e){return e?!!e[sr.symbols.ref]:!1};Ae.Ref=class{constructor(e){_e(typeof e=="object","Invalid reference construction"),sr.assertOptions(e,["adjust","ancestor","in","iterables","map","path","render","separator","type","depth","key","root","display"]),_e([!1,void 0].includes(e.separator)||typeof e.separator=="string"&&e.separator.length===1,"Invalid separator"),_e(!e.adjust||typeof e.adjust=="function","options.adjust must be a function"),_e(!e.map||Array.isArray(e.map),"options.map must be an array"),_e(!e.map||!e.adjust,"Cannot set both map and adjust options"),Object.assign(this,Ae.defaults,e),_e(this.type==="value"||this.ancestor===void 0,"Non-value references cannot reference ancestors"),Array.isArray(this.map)&&(this.map=new Map(this.map)),this.depth=this.path.length,this.key=this.path.length?this.path.join(this.separator):null,this.root=this.path[0],this.updateDisplay()}resolve(e,t,r,s,n={}){return _e(!this.in||n.in,"Invalid in() reference usage"),this.type==="global"?this._resolve(r.context,t,n):this.type==="local"?this._resolve(s,t,n):this.ancestor?this.ancestor==="root"?this._resolve(t.ancestors[t.ancestors.length-1],t,n):(_e(this.ancestor<=t.ancestors.length,"Invalid reference exceeds the schema root:",this.display),this._resolve(t.ancestors[this.ancestor-1],t,n)):this._resolve(e,t,n)}_resolve(e,t,r){let s;if(this.type==="value"&&t.mainstay.shadow&&r.shadow!==!1&&(s=t.mainstay.shadow.get(this.absolute(t))),s===void 0&&(s=$h(e,this.path,{iterables:this.iterables,functions:!0})),this.adjust&&(s=this.adjust(s)),this.map){let n=this.map.get(s);n!==void 0&&(s=n)}return t.mainstay&&t.mainstay.tracer.resolve(t,this,s),s}toString(){return this.display}absolute(e){return[...e.path.slice(0,-this.ancestor),...this.path]}clone(){return new Ae.Ref(this)}describe(){let e={path:this.path};this.type!=="value"&&(e.type=this.type),this.separator!=="."&&(e.separator=this.separator),this.type==="value"&&this.ancestor!==1&&(e.ancestor=this.ancestor),this.map&&(e.map=[...this.map]);for(let t of["adjust","iterables","render"])this[t]!==null&&this[t]!==void 0&&(e[t]=this[t]);return this.in!==!1&&(e.in=!0),{ref:e}}updateDisplay(){let e=this.key!==null?this.key:"";if(this.type!=="value"){this.display=`ref:${this.type}:${e}`;return}if(!this.separator){this.display=`ref:${e}`;return}if(!this.ancestor){this.display=`ref:${this.separator}${e}`;return}if(this.ancestor==="root"){this.display=`ref:root:${e}`;return}if(this.ancestor===1){this.display=`ref:${e||".."}`;return}let t=new Array(this.ancestor+1).fill(this.separator).join("");this.display=`ref:${t}${e||""}`}};Ae.Ref.prototype[sr.symbols.ref]=!0;Ee.build=function(e){return e=Object.assign({},Ae.defaults,e),e.type==="value"&&e.ancestor===void 0&&(e.ancestor=1),new Ae.Ref(e)};Ae.context=function(e,t,r={}){if(e=e.trim(),r){let s=r.global===void 0?"$":r.global;if(s!==t&&e.startsWith(s))return{key:e.slice(s.length),type:"global"};let n=r.local===void 0?"#":r.local;if(n!==t&&e.startsWith(n))return{key:e.slice(n.length),type:"local"};let i=r.root===void 0?"/":r.root;if(i!==t&&e.startsWith(i))return{key:e.slice(i.length),type:"value",root:!0}}return{key:e,type:"value"}};Ae.ancestor=function(e,t){if(!t)return[1,0];if(e[0]!==t)return[1,0];if(e[1]!==t)return[0,1];let r=2;for(;e[r]===t;)++r;return[r-1,r]};Ee.toSibling=0;Ee.toParent=1;Ee.Manager=class{constructor(){this.refs=[]}register(e,t){if(e){if(t=t===void 0?Ee.toParent:t,Array.isArray(e)){for(let r of e)this.register(r,t);return}if(sr.isSchema(e)){for(let r of e._refs.refs)r.ancestor-t>=0&&this.refs.push({ancestor:r.ancestor-t,root:r.root});return}Ee.isRef(e)&&e.type==="value"&&e.ancestor-t>=0&&this.refs.push({ancestor:e.ancestor-t,root:e.root}),In=In||ut(),In.isTemplate(e)&&this.register(e.refs(),t)}}get length(){return this.refs.length}clone(){let e=new Ee.Manager;return e.refs=Ph(this.refs),e}reset(){this.refs=[]}roots(){return this.refs.filter(e=>!e.ancestor).map(e=>e.root)}}});var ut=y((Pa,$a)=>{"use strict";var Ma=R(),qh=oe(),jh=xa(),Fh=Ia(),Ba=M(),Da=ze(),La=Xe(),x={symbol:Symbol("template"),opens:new Array(1e3).join("\0"),closes:new Array(1e3).join(""),dateFormat:{date:Date.prototype.toDateString,iso:Date.prototype.toISOString,string:Date.prototype.toString,time:Date.prototype.toTimeString,utc:Date.prototype.toUTCString}};$a.exports=Pa=x.Template=class{constructor(e,t){Ma(typeof e=="string","Template source must be a string"),Ma(!e.includes("\0")&&!e.includes(""),"Template source cannot contain reserved control characters"),this.source=e,this.rendered=e,this._template=null,this._settings=qh(t),this._parse()}_parse(){if(!this.source.includes("{"))return;let e=x.encode(this.source),t=x.split(e),r=!1,s=[],n=t.shift();n&&s.push(n);for(let i of t){let o=i[0]!=="{",a=o?"}":"}}",l=i.indexOf(a);if(l===-1||i[1]==="{"){s.push(`{${x.decode(i)}`);continue}let c=i.slice(o?0:1,l),f=c[0]===":";f&&(c=c.slice(1));let u=this._ref(x.decode(c),{raw:o,wrapped:f});s.push(u),typeof u!="string"&&(r=!0);let d=i.slice(l+a.length);d&&s.push(x.decode(d))}if(!r){this.rendered=s.join("");return}this._template=s}static date(e,t){return x.dateFormat[t.dateFormat].call(e)}describe(e={}){if(!this._settings&&e.compact)return this.source;let t={template:this.source};return this._settings&&(t.options=this._settings),t}static build(e){return new x.Template(e.template,e.options)}isDynamic(){return!!this._template}static isTemplate(e){return e?!!e[Ba.symbols.template]:!1}refs(){if(!this._template)return;let e=[];for(let t of this._template)typeof t!="string"&&e.push(...t.refs);return e}resolve(e,t,r,s){return this._template&&this._template.length===1?this._part(this._template[0],e,t,r,s,{}):this.render(e,t,r,s)}_part(e,...t){return e.ref?e.ref.resolve(...t):e.formula.evaluate(t)}render(e,t,r,s,n={}){if(!this.isDynamic())return this.rendered;let i=[];for(let o of this._template)if(typeof o=="string")i.push(o);else{let a=this._part(o,e,t,r,s,n),l=x.stringify(a,e,t,r,s,n);if(l!==void 0){let c=o.raw||(n.errors&&n.errors.escapeHtml)===!1?l:jh(l);i.push(x.wrap(c,o.wrapped&&r.errors.wrap.label))}}return i.join("")}_ref(e,{raw:t,wrapped:r}){let s=[],n=o=>{let a=La.create(o,this._settings);return s.push(a),l=>a.resolve(...l)};try{var i=new Fh.Parser(e,{reference:n,functions:x.functions,constants:x.constants})}catch(o){throw o.message=`Invalid template variable "${e}" fails due to: ${o.message}`,o}if(i.single){if(i.single.type==="reference"){let o=s[0];return{ref:o,raw:t,refs:s,wrapped:r||o.type==="local"&&o.key==="label"}}return x.stringify(i.single.value)}return{formula:i,raw:t,refs:s}}toString(){return this.source}};x.Template.prototype[Ba.symbols.template]=!0;x.Template.prototype.isImmutable=!0;x.encode=function(e){return e.replace(/\\(\{+)/g,(t,r)=>x.opens.slice(0,r.length)).replace(/\\(\}+)/g,(t,r)=>x.closes.slice(0,r.length))};x.decode=function(e){return e.replace(/\u0000/g,"{").replace(/\u0001/g,"}")};x.split=function(e){let t=[],r="";for(let s=0;s<e.length;++s){let n=e[s];if(n==="{"){let i="";for(;s+1<e.length&&e[s+1]==="{";)i+="{",++s;t.push(r),r=i}else r+=n}return t.push(r),t};x.wrap=function(e,t){return t?t.length===1?`${t}${e}${t}`:`${t[0]}${e}${t[1]}`:e};x.stringify=function(e,t,r,s,n,i={}){let o=typeof e,a=s&&s.errors&&s.errors.wrap||{},l=!1;if(La.isRef(e)&&e.render&&(l=e.in,e=e.resolve(t,r,s,n,{in:e.in,...i})),e===null)return"null";if(o==="string")return x.wrap(e,i.arrayItems&&a.string);if(o==="number"||o==="function"||o==="symbol")return e.toString();if(o!=="object")return JSON.stringify(e);if(e instanceof Date)return x.Template.date(e,s);if(e instanceof Map){let f=[];for(let[u,d]of e.entries())f.push(`${u.toString()} -> ${d.toString()}`);e=f}if(!Array.isArray(e))return e.toString();let c=[];for(let f of e)c.push(x.stringify(f,t,r,s,n,{arrayItems:!0,...i}));return x.wrap(c.join(", "),!l&&a.array)};x.constants={true:!0,false:!1,null:null,second:1e3,minute:60*1e3,hour:60*60*1e3,day:24*60*60*1e3};x.functions={if(e,t,r){return e?t:r},length(e){return typeof e=="string"?e.length:!e||typeof e!="object"?null:Array.isArray(e)?e.length:Object.keys(e).length},msg(e){let[t,r,s,n,i]=this,o=i.messages;if(!o)return"";let a=Da.template(t,o[0],e,r,s)||Da.template(t,o[1],e,r,s);return a?a.render(t,r,s,n,i):""},number(e){return typeof e=="number"?e:typeof e=="string"?parseFloat(e):typeof e=="boolean"?e?1:0:e instanceof Date?e.getTime():null}}});var qt=y(nr=>{"use strict";var At=R(),qa=oe(),me=ut();nr.compile=function(e,t){if(typeof e=="string")return At(!t,"Cannot set single message string"),new me(e);if(me.isTemplate(e))return At(!t,"Cannot set single message template"),e;At(typeof e=="object"&&!Array.isArray(e),"Invalid message options"),t=t?qa(t):{};for(let r in e){let s=e[r];if(r==="root"||me.isTemplate(s)){t[r]=s;continue}if(typeof s=="string"){t[r]=new me(s);continue}At(typeof s=="object"&&!Array.isArray(s),"Invalid message for",r);let n=r;t[n]=t[n]||{};for(r in s){let i=s[r];if(r==="root"||me.isTemplate(i)){t[n][r]=i;continue}At(typeof i=="string","Invalid message for",r,"in",n),t[n][r]=new me(i)}}return t};nr.decompile=function(e){let t={};for(let r in e){let s=e[r];if(r==="root"){t.root=s;continue}if(me.isTemplate(s)){t[r]=s.describe({compact:!0});continue}let n=r;t[n]={};for(r in s){let i=s[r];if(r==="root"){t[n].root=i;continue}t[n][r]=i.describe({compact:!0})}}return t};nr.merge=function(e,t){if(!e)return nr.compile(t);if(!t)return e;if(typeof t=="string")return new me(t);if(me.isTemplate(t))return t;let r=qa(e);for(let s in t){let n=t[s];if(s==="root"||me.isTemplate(n)){r[s]=n;continue}if(typeof n=="string"){r[s]=new me(n);continue}At(typeof n=="object"&&!Array.isArray(n),"Invalid message for",s);let i=s;r[i]=r[i]||{};for(s in n){let o=n[s];if(s==="root"||me.isTemplate(o)){r[i][s]=o;continue}At(typeof o=="string","Invalid message for",s,"in",i),r[i][s]=new me(o)}}return r}});var M=y(D=>{"use strict";var Fr=R(),Uh=kn(),Gh=Oa(),Tn,Nn,Hh={isoDate:/^(?:[-+]\d{2})?(?:\d{4}(?!\d{2}\b))(?:(-?)(?:(?:0[1-9]|1[0-2])(?:\1(?:[12]\d|0[1-9]|3[01]))?|W(?:[0-4]\d|5[0-2])(?:-?[1-7])?|(?:00[1-9]|0[1-9]\d|[12]\d{2}|3(?:[0-5]\d|6[1-6])))(?![T]$|[T][\d]+Z$)(?:[T\s](?:(?:(?:[01]\d|2[0-3])(?:(:?)[0-5]\d)?|24\:?00)(?:[.,]\d+(?!:))?)(?:\2[0-5]\d(?:[.,]\d+)?)?(?:[Z]|(?:[+-])(?:[01]\d|2[0-3])(?::?[0-5]\d)?)?)?)?$/};D.version=Gh.version;D.defaults={abortEarly:!0,allowUnknown:!1,artifacts:!1,cache:!0,context:null,convert:!0,dateFormat:"iso",errors:{escapeHtml:!1,label:"path",language:null,render:!0,stack:!1,wrap:{label:'"',array:"[]"}},externals:!0,messages:{},nonEnumerables:!1,noDefaults:!1,presence:"optional",skipFunctions:!1,stripUnknown:!1,warnings:!1};D.symbols={any:Symbol.for("@hapi/joi/schema"),arraySingle:Symbol("arraySingle"),deepDefault:Symbol("deepDefault"),errors:Symbol("errors"),literal:Symbol("literal"),override:Symbol("override"),parent:Symbol("parent"),prefs:Symbol("prefs"),ref:Symbol("ref"),template:Symbol("template"),values:Symbol("values")};D.assertOptions=function(e,t,r="Options"){Fr(e&&typeof e=="object"&&!Array.isArray(e),"Options must be of type object");let s=Object.keys(e).filter(n=>!t.includes(n));Fr(s.length===0,`${r} contain unknown keys: ${s}`)};D.checkPreferences=function(e){Nn=Nn||jr();let t=Nn.preferences.validate(e);if(t.error)throw new Uh([t.error.details[0].message])};D.compare=function(e,t,r){switch(r){case"=":return e===t;case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}};D.default=function(e,t){return e===void 0?t:e};D.isIsoDate=function(e){return Hh.isoDate.test(e)};D.isNumber=function(e){return typeof e=="number"&&!isNaN(e)};D.isResolvable=function(e){return e?e[D.symbols.ref]||e[D.symbols.template]:!1};D.isSchema=function(e,t={}){let r=e&&e[D.symbols.any];return r?(Fr(t.legacy||r.version===D.version,"Cannot mix different versions of joi schemas"),!0):!1};D.isValues=function(e){return e[D.symbols.values]};D.limit=function(e){return Number.isSafeInteger(e)&&e>=0};D.preferences=function(e,t){Tn=Tn||qt(),e=e||{},t=t||{};let r=Object.assign({},e,t);return t.errors&&e.errors&&(r.errors=Object.assign({},e.errors,t.errors),r.errors.wrap=Object.assign({},e.errors.wrap,t.errors.wrap)),t.messages&&(r.messages=Tn.compile(t.messages,e.messages)),delete r[D.symbols.prefs],r};D.tryWithPath=function(e,t,r={}){try{return e()}catch(s){throw s.path!==void 0?s.path=t+"."+s.path:s.path=t,r.append&&(s.message=`${s.message} (${s.path})`),s}};D.validateArg=function(e,t,{assert:r,message:s}){if(D.isSchema(r)){let n=r.validate(e);return n.error?n.error.message:void 0}else if(!r(e))return t?`${t} ${s}`:s};D.verifyFlat=function(e,t){for(let r of e)Fr(!Array.isArray(r),"Method no longer accepts array arguments:",t)}});var Mn=y(ja=>{"use strict";var zh=R(),Xh=oe(),Kh=M(),jt={max:1e3,supported:new Set(["undefined","boolean","number","string"])};ja.provider={provision(e){return new jt.Cache(e)}};jt.Cache=class{constructor(e={}){Kh.assertOptions(e,["max"]),zh(e.max===void 0||e.max&&e.max>0&&isFinite(e.max),"Invalid max cache size"),this._max=e.max||jt.max,this._map=new Map,this._list=new jt.List}get length(){return this._map.size}set(e,t){if(e!==null&&!jt.supported.has(typeof e))return;let r=this._map.get(e);if(r){r.value=t,this._list.first(r);return}r=this._list.unshift({key:e,value:t}),this._map.set(e,r),this._compact()}get(e){let t=this._map.get(e);if(t)return this._list.first(t),Xh(t.value)}_compact(){if(this._map.size>this._max){let e=this._list.pop();this._map.delete(e.key)}}};jt.List=class{constructor(){this.tail=null,this.head=null}unshift(e){return e.next=null,e.prev=this.head,this.head&&(this.head.next=e),this.head=e,this.tail||(this.tail=e),e}first(e){e!==this.head&&(this._remove(e),this.unshift(e))}pop(){return this._remove(this.tail)}_remove(e){let{next:t,prev:r}=e;return t.prev=r,r&&(r.next=t),e===this.tail&&(this.tail=t),e.prev=null,e.next=null,e}}});var Et=y(Ke=>{"use strict";var q=R(),ye=M(),Ft=Xe(),we={};Ke.schema=function(e,t,r={}){ye.assertOptions(r,["appendPath","override"]);try{return we.schema(e,t,r)}catch(s){throw r.appendPath&&s.path!==void 0&&(s.message=`${s.message} (${s.path})`),s}};we.schema=function(e,t,r){q(t!==void 0,"Invalid undefined schema"),Array.isArray(t)&&(q(t.length,"Invalid empty array schema"),t.length===1&&(t=t[0]));let s=(n,...i)=>r.override!==!1?n.valid(e.override,...i):n.valid(...i);if(we.simple(t))return s(e,t);if(typeof t=="function")return e.custom(t);if(q(typeof t=="object","Invalid schema content:",typeof t),ye.isResolvable(t))return s(e,t);if(ye.isSchema(t))return t;if(Array.isArray(t)){for(let n of t)if(!we.simple(n))return e.alternatives().try(...t);return s(e,...t)}return t instanceof RegExp?e.string().regex(t):t instanceof Date?s(e.date(),t):(q(Object.getPrototypeOf(t)===Object.getPrototypeOf({}),"Schema can only contain plain objects"),e.object().keys(t))};Ke.ref=function(e,t){return Ft.isRef(e)?e:Ft.create(e,t)};Ke.compile=function(e,t,r={}){ye.assertOptions(r,["legacy"]);let s=t&&t[ye.symbols.any];if(s)return q(r.legacy||s.version===ye.version,"Cannot mix different versions of joi schemas:",s.version,ye.version),t;if(typeof t!="object"||!r.legacy)return Ke.schema(e,t,{appendPath:!0});let n=we.walk(t);return n?n.compile(n.root,t):Ke.schema(e,t,{appendPath:!0})};we.walk=function(e){if(typeof e!="object")return null;if(Array.isArray(e)){for(let r of e){let s=we.walk(r);if(s)return s}return null}let t=e[ye.symbols.any];if(t)return{root:e[t.root],compile:t.compile};q(Object.getPrototypeOf(e)===Object.getPrototypeOf({}),"Schema can only contain plain objects");for(let r in e){let s=we.walk(e[r]);if(s)return s}return null};we.simple=function(e){return e===null||["boolean","string","number"].includes(typeof e)};Ke.when=function(e,t,r){if(r===void 0&&(q(t&&typeof t=="object","Missing options"),r=t,t=Ft.create(".")),Array.isArray(r)&&(r={switch:r}),ye.assertOptions(r,["is","not","then","otherwise","switch","break"]),ye.isSchema(t))return q(r.is===void 0,'"is" can not be used with a schema condition'),q(r.not===void 0,'"not" can not be used with a schema condition'),q(r.switch===void 0,'"switch" can not be used with a schema condition'),we.condition(e,{is:t,then:r.then,otherwise:r.otherwise,break:r.break});if(q(Ft.isRef(t)||typeof t=="string","Invalid condition:",t),q(r.not===void 0||r.is===void 0,'Cannot combine "is" with "not"'),r.switch===void 0){let n=r;r.not!==void 0&&(n={is:r.not,then:r.otherwise,otherwise:r.then,break:r.break});let i=n.is!==void 0?e.$_compile(n.is):e.$_root.invalid(null,!1,0,"").required();return q(n.then!==void 0||n.otherwise!==void 0,'options must have at least one of "then", "otherwise", or "switch"'),q(n.break===void 0||n.then===void 0||n.otherwise===void 0,"Cannot specify then, otherwise, and break all together"),r.is!==void 0&&!Ft.isRef(r.is)&&!ye.isSchema(r.is)&&(i=i.required()),we.condition(e,{ref:Ke.ref(t),is:i,then:n.then,otherwise:n.otherwise,break:n.break})}q(Array.isArray(r.switch),'"switch" must be an array'),q(r.is===void 0,'Cannot combine "switch" with "is"'),q(r.not===void 0,'Cannot combine "switch" with "not"'),q(r.then===void 0,'Cannot combine "switch" with "then"');let s={ref:Ke.ref(t),switch:[],break:r.break};for(let n=0;n<r.switch.length;++n){let i=r.switch[n],o=n===r.switch.length-1;ye.assertOptions(i,o?["is","then","otherwise"]:["is","then"]),q(i.is!==void 0,'Switch statement missing "is"'),q(i.then!==void 0,'Switch statement missing "then"');let a={is:e.$_compile(i.is),then:e.$_compile(i.then)};if(!Ft.isRef(i.is)&&!ye.isSchema(i.is)&&(a.is=a.is.required()),o){q(r.otherwise===void 0||i.otherwise===void 0,'Cannot specify "otherwise" inside and outside a "switch"');let l=r.otherwise!==void 0?r.otherwise:i.otherwise;l!==void 0&&(q(s.break===void 0,"Cannot specify both otherwise and break"),a.otherwise=e.$_compile(l))}s.switch.push(a)}return s};we.condition=function(e,t){for(let r of["then","otherwise"])t[r]===void 0?delete t[r]:t[r]=e.$_compile(t[r]);return t}});var Dn=y(Ua=>{"use strict";var ft=R(),Vh=oe(),Fa=M(),Qh=qt(),Me={};Ua.type=function(e,t){let r=Object.getPrototypeOf(e),s=Vh(r),n=e._assign(Object.create(s)),i=Object.assign({},t);delete i.base,s._definition=i;let o=r._definition||{};i.messages=Qh.merge(o.messages,i.messages),i.properties=Object.assign({},o.properties,i.properties),n.type=i.type,i.flags=Object.assign({},o.flags,i.flags);let a=Object.assign({},o.terms);if(i.terms)for(let u in i.terms){let d=i.terms[u];ft(n.$_terms[u]===void 0,"Invalid term override for",i.type,u),n.$_terms[u]=d.init,a[u]=d}i.terms=a,i.args||(i.args=o.args),i.prepare=Me.prepare(i.prepare,o.prepare),i.coerce&&(typeof i.coerce=="function"&&(i.coerce={method:i.coerce}),i.coerce.from&&!Array.isArray(i.coerce.from)&&(i.coerce={method:i.coerce.method,from:[].concat(i.coerce.from)})),i.coerce=Me.coerce(i.coerce,o.coerce),i.validate=Me.validate(i.validate,o.validate);let l=Object.assign({},o.rules);if(i.rules)for(let u in i.rules){let d=i.rules[u];ft(typeof d=="object","Invalid rule definition for",i.type,u);let p=d.method;if(p===void 0&&(p=function(){return this.$_addRule(u)}),p&&(ft(!s[u],"Rule conflict in",i.type,u),s[u]=p),ft(!l[u],"Rule conflict in",i.type,u),l[u]=d,d.alias){let m=[].concat(d.alias);for(let g of m)s[g]=d.method}d.args&&(d.argsByName=new Map,d.args=d.args.map(m=>(typeof m=="string"&&(m={name:m}),ft(!d.argsByName.has(m.name),"Duplicated argument name",m.name),Fa.isSchema(m.assert)&&(m.assert=m.assert.strict().label(m.name)),d.argsByName.set(m.name,m),m)))}i.rules=l;let c=Object.assign({},o.modifiers);if(i.modifiers)for(let u in i.modifiers){ft(!s[u],"Rule conflict in",i.type,u);let d=i.modifiers[u];ft(typeof d=="function","Invalid modifier definition for",i.type,u);let p=function(m){return this.rule({[u]:m})};s[u]=p,c[u]=d}if(i.modifiers=c,i.overrides){s._super=r,n.$_super={};for(let u in i.overrides)ft(r[u],"Cannot override missing",u),i.overrides[u][Fa.symbols.parent]=r[u],n.$_super[u]=r[u].bind(n);Object.assign(s,i.overrides)}i.cast=Object.assign({},o.cast,i.cast);let f=Object.assign({},o.manifest,i.manifest);return f.build=Me.build(i.manifest&&i.manifest.build,o.manifest&&o.manifest.build),i.manifest=f,i.rebuild=Me.rebuild(i.rebuild,o.rebuild),n};Me.build=function(e,t){return!e||!t?e||t:function(r,s){return t(e(r,s),s)}};Me.coerce=function(e,t){return!e||!t?e||t:{from:e.from&&t.from?[...new Set([...e.from,...t.from])]:null,method(r,s){let n;if((!t.from||t.from.includes(typeof r))&&(n=t.method(r,s),n)){if(n.errors||n.value===void 0)return n;r=n.value}if(!e.from||e.from.includes(typeof r)){let i=e.method(r,s);if(i)return i}return n}}};Me.prepare=function(e,t){return!e||!t?e||t:function(r,s){let n=e(r,s);if(n){if(n.errors||n.value===void 0)return n;r=n.value}return t(r,s)||n}};Me.rebuild=function(e,t){return!e||!t?e||t:function(r){t(r),e(r)}};Me.validate=function(e,t){return!e||!t?e||t:function(r,s){let n=t(r,s);if(n){if(n.errors&&(!Array.isArray(n.errors)||n.errors.length))return n;r=n.value}return e(r,s)||n}}});var Pn=y(Ln=>{"use strict";var De=R(),Ur=oe(),wt=M(),Yh=qt(),Ga=Xe(),Wh=ut(),Bn,ae={};Ln.describe=function(e){let t=e._definition,r={type:e.type,flags:{},rules:[]};for(let s in e._flags)s[0]!=="_"&&(r.flags[s]=ae.describe(e._flags[s]));Object.keys(r.flags).length||delete r.flags,e._preferences&&(r.preferences=Ur(e._preferences,{shallow:["messages"]}),delete r.preferences[wt.symbols.prefs],r.preferences.messages&&(r.preferences.messages=Yh.decompile(r.preferences.messages))),e._valids&&(r.allow=e._valids.describe()),e._invalids&&(r.invalid=e._invalids.describe());for(let s of e._rules){if(t.rules[s.name].manifest===!1)continue;let i={name:s.name};for(let o in t.modifiers)s[o]!==void 0&&(i[o]=ae.describe(s[o]));if(s.args){i.args={};for(let o in s.args){let a=s.args[o];o==="options"&&!Object.keys(a).length||(i.args[o]=ae.describe(a,{assign:o}))}Object.keys(i.args).length||delete i.args}r.rules.push(i)}r.rules.length||delete r.rules;for(let s in e.$_terms){if(s[0]==="_")continue;De(!r[s],"Cannot describe schema due to internal name conflict with",s);let n=e.$_terms[s];if(!n)continue;if(n instanceof Map){n.size&&(r[s]=[...n.entries()]);continue}if(wt.isValues(n)){r[s]=n.describe();continue}De(t.terms[s],"Term",s,"missing configuration");let i=t.terms[s].manifest,o=typeof i=="object";if(!n.length&&!o)continue;let a=[];for(let l of n)a.push(ae.describe(l));if(o){let{from:l,to:c}=i.mapped;r[s]={};for(let f of a)r[s][f[c]]=f[l];continue}if(i==="single"){De(a.length===1,"Term",s,"contains more than one item"),r[s]=a[0];continue}r[s]=a}return ae.validate(e.$_root,r),r};ae.describe=function(e,t={}){if(Array.isArray(e))return e.map(ae.describe);if(e===wt.symbols.deepDefault)return{special:"deep"};if(typeof e!="object"||e===null)return e;if(t.assign==="options")return Ur(e);if(Buffer&&Buffer.isBuffer(e))return{buffer:e.toString("binary")};if(e instanceof Date)return e.toISOString();if(e instanceof Error)return e;if(e instanceof RegExp)return t.assign==="regex"?e.toString():{regex:e.toString()};if(e[wt.symbols.literal])return{function:e.literal};if(typeof e.describe=="function")return t.assign==="ref"?e.describe().ref:e.describe();let r={};for(let s in e){let n=e[s];n!==void 0&&(r[s]=ae.describe(n,{assign:s}))}return r};Ln.build=function(e,t){return new ae.Builder(e).parse(t)};ae.Builder=class{constructor(e){this.joi=e}parse(e){ae.validate(this.joi,e);let t=this.joi[e.type]()._bare(),r=t._definition;if(e.flags)for(let n in e.flags){let i=r.flags[n]&&r.flags[n].setter||n;De(typeof t[i]=="function","Invalid flag",n,"for type",e.type),t=t[i](this.build(e.flags[n]))}if(e.preferences&&(t=t.preferences(this.build(e.preferences))),e.allow&&(t=t.allow(...this.build(e.allow))),e.invalid&&(t=t.invalid(...this.build(e.invalid))),e.rules)for(let n of e.rules){De(typeof t[n.name]=="function","Invalid rule",n.name,"for type",e.type);let i=[];if(n.args){let a={};for(let f in n.args)a[f]=this.build(n.args[f],{assign:f});let l=Object.keys(a),c=r.rules[n.name].args;if(c){De(l.length<=c.length,"Invalid number of arguments for",e.type,n.name,"(expected up to",c.length,", found",l.length,")");for(let{name:f}of c)i.push(a[f])}else De(l.length===1,"Invalid number of arguments for",e.type,n.name,"(expected up to 1, found",l.length,")"),i.push(a[l[0]])}t=t[n.name](...i);let o={};for(let a in r.modifiers)n[a]!==void 0&&(o[a]=this.build(n[a]));Object.keys(o).length&&(t=t.rule(o))}let s={};for(let n in e){if(["allow","flags","invalid","whens","preferences","rules","type"].includes(n))continue;De(r.terms[n],"Term",n,"missing configuration");let i=r.terms[n].manifest;if(i==="schema"){s[n]=e[n].map(o=>this.parse(o));continue}if(i==="values"){s[n]=e[n].map(o=>this.build(o));continue}if(i==="single"){s[n]=this.build(e[n]);continue}if(typeof i=="object"){s[n]={};for(let o in e[n]){let a=e[n][o];s[n][o]=this.parse(a)}continue}s[n]=this.build(e[n])}return e.whens&&(s.whens=e.whens.map(n=>this.build(n))),t=r.manifest.build(t,s),t.$_temp.ruleset=!1,t}build(e,t={}){if(e===null)return null;if(Array.isArray(e))return e.map(s=>this.build(s));if(e instanceof Error)return e;if(t.assign==="options")return Ur(e);if(t.assign==="regex")return ae.regex(e);if(t.assign==="ref")return Ga.build(e);if(typeof e!="object")return e;if(Object.keys(e).length===1){if(e.buffer)return De(Buffer,"Buffers are not supported"),Buffer&&Buffer.from(e.buffer,"binary");if(e.function)return{[wt.symbols.literal]:!0,literal:e.function};if(e.override)return wt.symbols.override;if(e.ref)return Ga.build(e.ref);if(e.regex)return ae.regex(e.regex);if(e.special)return De(["deep"].includes(e.special),"Unknown special value",e.special),wt.symbols.deepDefault;if(e.value)return Ur(e.value)}if(e.type)return this.parse(e);if(e.template)return Wh.build(e);let r={};for(let s in e)r[s]=this.build(e[s],{assign:s});return r}};ae.regex=function(e){let t=e.lastIndexOf("/"),r=e.slice(1,t),s=e.slice(t+1);return new RegExp(r,s)};ae.validate=function(e,t){Bn=Bn||jr(),e.assert(t,Bn.description)}});var ir=y((vy,Ha)=>{"use strict";var Be=On(),ee={mismatched:null};Ha.exports=function(e,t,r){return r=Object.assign({prototype:!0},r),!!ee.isDeepEqual(e,t,r,[])};ee.isDeepEqual=function(e,t,r,s){if(e===t)return e!==0||1/e===1/t;let n=typeof e;if(n!==typeof t||e===null||t===null)return!1;if(n==="function"){if(!r.deepFunction||e.toString()!==t.toString())return!1}else if(n!=="object")return e!==e&&t!==t;let i=ee.getSharedType(e,t,!!r.prototype);switch(i){case Be.buffer:return Buffer&&Buffer.prototype.equals.call(e,t);case Be.promise:return e===t;case Be.regex:return e.toString()===t.toString();case ee.mismatched:return!1}for(let o=s.length-1;o>=0;--o)if(s[o].isSame(e,t))return!0;s.push(new ee.SeenEntry(e,t));try{return!!ee.isDeepEqualObj(i,e,t,r,s)}finally{s.pop()}};ee.getSharedType=function(e,t,r){if(r)return Object.getPrototypeOf(e)!==Object.getPrototypeOf(t)?ee.mismatched:Be.getInternalProto(e);let s=Be.getInternalProto(e);return s!==Be.getInternalProto(t)?ee.mismatched:s};ee.valueOf=function(e){let t=e.valueOf;if(t===void 0)return e;try{return t.call(e)}catch(r){return r}};ee.hasOwnEnumerableProperty=function(e,t){return Object.prototype.propertyIsEnumerable.call(e,t)};ee.isSetSimpleEqual=function(e,t){for(let r of Set.prototype.values.call(e))if(!Set.prototype.has.call(t,r))return!1;return!0};ee.isDeepEqualObj=function(e,t,r,s,n){let{isDeepEqual:i,valueOf:o,hasOwnEnumerableProperty:a}=ee,{keys:l,getOwnPropertySymbols:c}=Object;if(e===Be.array)if(s.part){for(let m of t)for(let g of r)if(i(m,g,s,n))return!0}else{if(t.length!==r.length)return!1;for(let m=0;m<t.length;++m)if(!i(t[m],r[m],s,n))return!1;return!0}else if(e===Be.set){if(t.size!==r.size)return!1;if(!ee.isSetSimpleEqual(t,r)){let m=new Set(Set.prototype.values.call(r));for(let g of Set.prototype.values.call(t)){if(m.delete(g))continue;let S=!1;for(let A of m)if(i(g,A,s,n)){m.delete(A),S=!0;break}if(!S)return!1}}}else if(e===Be.map){if(t.size!==r.size)return!1;for(let[m,g]of Map.prototype.entries.call(t))if(g===void 0&&!Map.prototype.has.call(r,m)||!i(g,Map.prototype.get.call(r,m),s,n))return!1}else if(e===Be.error&&(t.name!==r.name||t.message!==r.message))return!1;let f=o(t),u=o(r);if((t!==f||r!==u)&&!i(f,u,s,n))return!1;let d=l(t);if(!s.part&&d.length!==l(r).length&&!s.skip)return!1;let p=0;for(let m of d){if(s.skip&&s.skip.includes(m)){r[m]===void 0&&++p;continue}if(!a(r,m)||!i(t[m],r[m],s,n))return!1}if(!s.part&&d.length-p!==l(r).length)return!1;if(s.symbols!==!1){let m=c(t),g=new Set(c(r));for(let S of m){if(!s.skip||!s.skip.includes(S)){if(a(t,S)){if(!a(r,S)||!i(t[S],r[S],s,n))return!1}else if(a(r,S))return!1}g.delete(S)}for(let S of g)if(a(r,S))return!1}return!0};ee.SeenEntry=class{constructor(e,t){this.obj=e,this.ref=t}isSame(e,t){return this.obj===e&&this.ref===t}}});var Xa=y(za=>{"use strict";za.location=function(e=0){let t=Error.prepareStackTrace;Error.prepareStackTrace=(n,i)=>i;let r={};Error.captureStackTrace(r,this);let s=r.stack[e+1];return Error.prepareStackTrace=t,{filename:s.getFileName(),line:s.getLineNumber()}}});var qn=y($n=>{"use strict";var Ka=ir(),Va=Xa(),Jh=ze(),te={codes:{error:1,pass:2,full:3},labels:{0:"never used",1:"always error",2:"always pass"}};$n.setup=function(e){let t=function(){return e._tracer=e._tracer||new te.Tracer,e._tracer};e.trace=t,e[Symbol.for("@hapi/lab/coverage/initialize")]=t,e.untrace=()=>{e._tracer=null}};$n.location=function(e){return e.$_setFlag("_tracerLocation",Va.location(2))};te.Tracer=class{constructor(){this.name="Joi",this._schemas=new Map}_register(e){let t=this._schemas.get(e);if(t)return t.store;let r=new te.Store(e),{filename:s,line:n}=e._flags._tracerLocation||Va.location(5);return this._schemas.set(e,{filename:s,line:n,store:r}),r}_combine(e,t){for(let{store:r}of this._schemas.values())r._combine(e,t)}report(e){let t=[];for(let{filename:r,line:s,store:n}of this._schemas.values()){if(e&&e!==r)continue;let i=[],o=[];for(let[a,l]of n._sources.entries()){if(te.sub(l.paths,o))continue;if(!l.entry){i.push({status:"never reached",paths:[...l.paths]}),o.push(...l.paths);continue}for(let f of["valid","invalid"]){let u=a[`_${f}s`];if(!u)continue;let d=new Set(u._values),p=new Set(u._refs);for(let{value:m,ref:g}of l[f])d.delete(m),p.delete(g);(d.size||p.size)&&i.push({status:[...d,...[...p].map(m=>m.display)],rule:`${f}s`})}let c=a._rules.map(f=>f.name);for(let f of["default","failover"])a._flags[f]!==void 0&&c.push(f);for(let f of c){let u=te.labels[l.rule[f]||0];if(u){let d={rule:f,status:u};l.paths.size&&(d.paths=[...l.paths]),i.push(d)}}}i.length&&t.push({filename:r,line:s,missing:i,severity:"error",message:`Schema missing tests for ${i.map(te.message).join(", ")}`})}return t.length?t:null}};te.Store=class{constructor(e){this.active=!0,this._sources=new Map,this._combos=new Map,this._scan(e)}debug(e,t,r,s){e.mainstay.debug&&e.mainstay.debug.push({type:t,name:r,result:s,path:e.path})}entry(e,t){te.debug(t,{type:"entry"}),this._record(e,r=>{r.entry=!0})}filter(e,t,r,s){te.debug(t,{type:r,...s}),this._record(e,n=>{n[r].add(s)})}log(e,t,r,s,n){te.debug(t,{type:r,name:s,result:n==="full"?"pass":n}),this._record(e,i=>{i[r][s]=i[r][s]||0,i[r][s]|=te.codes[n]})}resolve(e,t,r){if(!e.mainstay.debug)return;let s={type:"resolve",ref:t.display,to:r,path:e.path};e.mainstay.debug.push(s)}value(e,t,r,s,n){if(!e.mainstay.debug||Ka(r,s))return;let i={type:"value",by:t,from:r,to:s,path:e.path};n&&(i.name=n),e.mainstay.debug.push(i)}_record(e,t){let r=this._sources.get(e);if(r){t(r);return}let s=this._combos.get(e);for(let n of s)this._record(n,t)}_scan(e,t){let r=t||[],s=this._sources.get(e);s||(s={paths:new Set,entry:!1,rule:{},valid:new Set,invalid:new Set},this._sources.set(e,s)),r.length&&s.paths.add(r);let n=(i,o)=>{let a=te.id(i,o);this._scan(i,r.concat(a))};e.$_modify({each:n,ref:!1})}_combine(e,t){this._combos.set(e,t)}};te.message=function(e){return`${e.paths?Jh.path(e.paths[0])+(e.rule?":":""):""}${e.rule||""} (${e.status})`};te.id=function(e,{source:t,name:r,path:s,key:n}){return e._flags.id?e._flags.id:n||(r=`@${r}`,t==="terms"?[r,s[Math.min(s.length-1,1)]]:r)};te.sub=function(e,t){for(let r of e)for(let s of t)if(Ka(r.slice(0,s.length),s))return!0;return!1};te.debug=function(e,t){e.mainstay.debug&&(t.path=e.debug?[...e.path,e.debug]:e.path,e.mainstay.debug.push(t))}});var Gr=y((Dy,Wa)=>{"use strict";var jn=R(),Qa=oe(),Zh=vn(),Ya={};Wa.exports=Ya.merge=function(e,t,r){if(jn(e&&typeof e=="object","Invalid target value: must be an object"),jn(t==null||typeof t=="object","Invalid source value: must be null, undefined, or an object"),!t)return e;if(r=Object.assign({nullOverride:!0,mergeArrays:!0},r),Array.isArray(t)){jn(Array.isArray(e),"Cannot merge array onto an object"),r.mergeArrays||(e.length=0);for(let n=0;n<t.length;++n)e.push(Qa(t[n],{symbols:r.symbols}));return e}let s=Zh.keys(t,r);for(let n=0;n<s.length;++n){let i=s[n];if(i==="__proto__"||!Object.prototype.propertyIsEnumerable.call(t,i))continue;let o=t[i];if(o&&typeof o=="object"){if(e[i]===o)continue;!e[i]||typeof e[i]!="object"||Array.isArray(e[i])!==Array.isArray(o)||o instanceof Date||Buffer&&Buffer.isBuffer(o)||o instanceof RegExp?e[i]=Qa(o,{symbols:r.symbols}):Ya.merge(e[i],o,r)}else(o!=null||r.nullOverride)&&(e[i]=o)}return e}});var Ja=y(Hr=>{"use strict";var Ve=R(),Fn=M(),ep=Xe(),Le={};Hr.Ids=Le.Ids=class{constructor(){this._byId=new Map,this._byKey=new Map,this._schemaChain=!1}clone(){let e=new Le.Ids;return e._byId=new Map(this._byId),e._byKey=new Map(this._byKey),e._schemaChain=this._schemaChain,e}concat(e){e._schemaChain&&(this._schemaChain=!0);for(let[t,r]of e._byId.entries())Ve(!this._byKey.has(t),"Schema id conflicts with existing key:",t),this._byId.set(t,r);for(let[t,r]of e._byKey.entries())Ve(!this._byId.has(t),"Schema key conflicts with existing id:",t),this._byKey.set(t,r)}fork(e,t,r){let s=this._collect(e);s.push({schema:r});let n=s.shift(),i={id:n.id,schema:t(n.schema)};Ve(Fn.isSchema(i.schema),"adjuster function failed to return a joi schema type");for(let o of s)i={id:o.id,schema:Le.fork(o.schema,i.id,i.schema)};return i.schema}labels(e,t=[]){let r=e[0],s=this._get(r);if(!s)return[...t,...e].join(".");let n=e.slice(1);return t=[...t,s.schema._flags.label||r],n.length?s.schema._ids.labels(n,t):t.join(".")}reach(e,t=[]){let r=e[0],s=this._get(r);Ve(s,"Schema does not contain path",[...t,...e].join("."));let n=e.slice(1);return n.length?s.schema._ids.reach(n,[...t,r]):s.schema}register(e,{key:t}={}){if(!e||!Fn.isSchema(e))return;(e.$_property("schemaChain")||e._ids._schemaChain)&&(this._schemaChain=!0);let r=e._flags.id;if(r){let s=this._byId.get(r);Ve(!s||s.schema===e,"Cannot add different schemas with the same id:",r),Ve(!this._byKey.has(r),"Schema id conflicts with existing key:",r),this._byId.set(r,{schema:e,id:r})}t&&(Ve(!this._byKey.has(t),"Schema already contains key:",t),Ve(!this._byId.has(t),"Schema key conflicts with existing id:",t),this._byKey.set(t,{schema:e,id:t}))}reset(){this._byId=new Map,this._byKey=new Map,this._schemaChain=!1}_collect(e,t=[],r=[]){let s=e[0],n=this._get(s);Ve(n,"Schema does not contain path",[...t,...e].join(".")),r=[n,...r];let i=e.slice(1);return i.length?n.schema._ids._collect(i,[...t,s],r):r}_get(e){return this._byId.get(e)||this._byKey.get(e)}};Le.fork=function(e,t,r){let s=(i,{key:o})=>{if(t===(i._flags.id||o))return r},n=Hr.schema(e,{each:s,ref:!1});return n?n.$_mutateRebuild():e};Hr.schema=function(e,t){let r;for(let s in e._flags){if(s[0]==="_")continue;let n=Le.scan(e._flags[s],{source:"flags",name:s},t);n!==void 0&&(r=r||e.clone(),r._flags[s]=n)}for(let s=0;s<e._rules.length;++s){let n=e._rules[s],i=Le.scan(n.args,{source:"rules",name:n.name},t);if(i!==void 0){r=r||e.clone();let o=Object.assign({},n);o.args=i,r._rules[s]=o,r._singleRules.get(n.name)===n&&r._singleRules.set(n.name,o)}}for(let s in e.$_terms){if(s[0]==="_")continue;let n=Le.scan(e.$_terms[s],{source:"terms",name:s},t);n!==void 0&&(r=r||e.clone(),r.$_terms[s]=n)}return r};Le.scan=function(e,t,r,s,n){let i=s||[];if(e===null||typeof e!="object")return;let o;if(Array.isArray(e)){for(let a=0;a<e.length;++a){let l=t.source==="terms"&&t.name==="keys"&&e[a].key,c=Le.scan(e[a],t,r,[a,...i],l);c!==void 0&&(o=o||e.slice(),o[a]=c)}return o}if(r.schema!==!1&&Fn.isSchema(e)||r.ref!==!1&&ep.isRef(e)){let a=r.each(e,{...t,path:i,key:n});return a===e?void 0:a}for(let a in e){if(a[0]==="_")continue;let l=Le.scan(e[a],t,r,[a,...i],n);l!==void 0&&(o=o||Object.assign({},e),o[a]=l)}return o}});var el=y((Py,Za)=>{"use strict";Za.exports=function(){}});var sl=y(($y,rl)=>{"use strict";var tp=oe(),tl=St(),rp=M(),Pe={value:Symbol("value")};rl.exports=Pe.State=class{constructor(e,t,r){this.path=e,this.ancestors=t,this.mainstay=r.mainstay,this.schemas=r.schemas,this.debug=null}localize(e,t=null,r=null){let s=new Pe.State(e,t,this);return r&&s.schemas&&(s.schemas=[Pe.schemas(r),...s.schemas]),s}nest(e,t){let r=new Pe.State(this.path,this.ancestors,this);return r.schemas=r.schemas&&[Pe.schemas(e),...r.schemas],r.debug=t,r}shadow(e,t){this.mainstay.shadow=this.mainstay.shadow||new Pe.Shadow,this.mainstay.shadow.set(this.path,e,t)}snapshot(){this.mainstay.shadow&&(this._snapshot=tp(this.mainstay.shadow.node(this.path))),this.mainstay.snapshot()}restore(){this.mainstay.shadow&&(this.mainstay.shadow.override(this.path,this._snapshot),this._snapshot=void 0),this.mainstay.restore()}commit(){this.mainstay.shadow&&(this.mainstay.shadow.override(this.path,this._snapshot),this._snapshot=void 0),this.mainstay.commit()}};Pe.schemas=function(e){return rp.isSchema(e)?{schema:e}:e};Pe.Shadow=class{constructor(){this._values=null}set(e,t,r){if(!e.length||r==="strip"&&typeof e[e.length-1]=="number")return;this._values=this._values||new Map;let s=this._values;for(let n=0;n<e.length;++n){let i=e[n],o=s.get(i);o||(o=new Map,s.set(i,o)),s=o}s[Pe.value]=t}get(e){let t=this.node(e);if(t)return t[Pe.value]}node(e){if(this._values)return tl(this._values,e,{iterables:!0})}override(e,t){if(!this._values)return;let r=e.slice(0,-1),s=e[e.length-1],n=tl(this._values,r,{iterables:!0});if(t){n.set(s,t);return}n&&n.delete(s)}}});var il=y(ar=>{"use strict";var or=R(),nl=oe(),Ut=el(),sp=St(),G=M(),dt=ze(),np=sl(),w={result:Symbol("result")};ar.entry=function(e,t,r){let s=G.defaults;r&&(or(r.warnings===void 0,"Cannot override warnings preference in synchronous validation"),or(r.artifacts===void 0,"Cannot override artifacts preference in synchronous validation"),s=G.preferences(G.defaults,r));let n=w.entry(e,t,s);or(!n.mainstay.externals.length,"Schema with external rules must use validateAsync()");let i={value:n.value};return n.error&&(i.error=n.error),n.mainstay.warnings.length&&(i.warning=dt.details(n.mainstay.warnings)),n.mainstay.debug&&(i.debug=n.mainstay.debug),n.mainstay.artifacts&&(i.artifacts=n.mainstay.artifacts),i};ar.entryAsync=async function(e,t,r){let s=G.defaults;r&&(s=G.preferences(G.defaults,r));let n=w.entry(e,t,s),i=n.mainstay;if(n.error)throw i.debug&&(n.error.debug=i.debug),n.error;if(i.externals.length){let a=n.value,l=[];for(let c of i.externals){let f=c.state.path,u=c.schema.type==="link"?i.links.get(c.schema):null,d=a,p,m,g=f.length?[a]:[],S=f.length?sp(e,f):e;if(f.length){p=f[f.length-1];let A=a;for(let v of f.slice(0,-1))A=A[v],g.unshift(A);m=g[0],d=m[p]}try{let A=(z,X)=>(u||c.schema).$_createError(z,d,X,c.state,s),v=await c.method(d,{schema:c.schema,linked:u,state:c.state,prefs:r,original:S,error:A,errorsArray:w.errorsArray,warn:(z,X)=>i.warnings.push((u||c.schema).$_createError(z,d,X,c.state,s)),message:(z,X)=>(u||c.schema).$_createError("external",d,X,c.state,s,{messages:z})});if(v===void 0||v===d)continue;if(v instanceof dt.Report){if(i.tracer.log(c.schema,c.state,"rule","external","error"),l.push(v),s.abortEarly)break;continue}if(Array.isArray(v)&&v[G.symbols.errors]){if(i.tracer.log(c.schema,c.state,"rule","external","error"),l.push(...v),s.abortEarly)break;continue}m?(i.tracer.value(c.state,"rule",d,v,"external"),m[p]=v):(i.tracer.value(c.state,"rule",a,v,"external"),a=v)}catch(A){throw s.errors.label&&(A.message+=` (${c.label})`),A}}if(n.value=a,l.length)throw n.error=dt.process(l,e,s),i.debug&&(n.error.debug=i.debug),n.error}if(!s.warnings&&!s.debug&&!s.artifacts)return n.value;let o={value:n.value};return i.warnings.length&&(o.warning=dt.details(i.warnings)),i.debug&&(o.debug=i.debug),i.artifacts&&(o.artifacts=i.artifacts),o};w.Mainstay=class{constructor(e,t,r){this.externals=[],this.warnings=[],this.tracer=e,this.debug=t,this.links=r,this.shadow=null,this.artifacts=null,this._snapshots=[]}snapshot(){this._snapshots.push({externals:this.externals.slice(),warnings:this.warnings.slice()})}restore(){let e=this._snapshots.pop();this.externals=e.externals,this.warnings=e.warnings}commit(){this._snapshots.pop()}};w.entry=function(e,t,r){let{tracer:s,cleanup:n}=w.tracer(t,r),i=r.debug?[]:null,o=t._ids._schemaChain?new Map:null,a=new w.Mainstay(s,i,o),l=t._ids._schemaChain?[{schema:t}]:null,c=new np([],[],{mainstay:a,schemas:l}),f=ar.validate(e,t,c,r);n&&t.$_root.untrace();let u=dt.process(f.errors,e,r);return{value:f.value,error:u,mainstay:a}};w.tracer=function(e,t){return e.$_root._tracer?{tracer:e.$_root._tracer._register(e)}:t.debug?(or(e.$_root.trace,"Debug mode not supported"),{tracer:e.$_root.trace()._register(e),cleanup:!0}):{tracer:w.ignore}};ar.validate=function(e,t,r,s,n={}){if(t.$_terms.whens&&(t=t._generate(e,r,s).schema),t._preferences&&(s=w.prefs(t,s)),t._cache&&s.cache){let u=t._cache.get(e);if(r.mainstay.tracer.debug(r,"validate","cached",!!u),u)return u}let i=(u,d,p)=>t.$_createError(u,e,d,p||r,s),o={original:e,prefs:s,schema:t,state:r,error:i,errorsArray:w.errorsArray,warn:(u,d,p)=>r.mainstay.warnings.push(i(u,d,p)),message:(u,d)=>t.$_createError("custom",e,d,r,s,{messages:u})};r.mainstay.tracer.entry(t,r);let a=t._definition;if(a.prepare&&e!==void 0&&s.convert){let u=a.prepare(e,o);if(u){if(r.mainstay.tracer.value(r,"prepare",e,u.value),u.errors)return w.finalize(u.value,[].concat(u.errors),o);e=u.value}}if(a.coerce&&e!==void 0&&s.convert&&(!a.coerce.from||a.coerce.from.includes(typeof e))){let u=a.coerce.method(e,o);if(u){if(r.mainstay.tracer.value(r,"coerced",e,u.value),u.errors)return w.finalize(u.value,[].concat(u.errors),o);e=u.value}}let l=t._flags.empty;l&&l.$_match(w.trim(e,t),r.nest(l),G.defaults)&&(r.mainstay.tracer.value(r,"empty",e,void 0),e=void 0);let c=n.presence||t._flags.presence||(t._flags._endedSwitch?null:s.presence);if(e===void 0){if(c==="forbidden")return w.finalize(e,null,o);if(c==="required")return w.finalize(e,[t.$_createError("any.required",e,null,r,s)],o);if(c==="optional"){if(t._flags.default!==G.symbols.deepDefault)return w.finalize(e,null,o);r.mainstay.tracer.value(r,"default",e,{}),e={}}}else if(c==="forbidden")return w.finalize(e,[t.$_createError("any.unknown",e,null,r,s)],o);let f=[];if(t._valids){let u=t._valids.get(e,r,s,t._flags.insensitive);if(u)return s.convert&&(r.mainstay.tracer.value(r,"valids",e,u.value),e=u.value),r.mainstay.tracer.filter(t,r,"valid",u),w.finalize(e,null,o);if(t._flags.only){let d=t.$_createError("any.only",e,{valids:t._valids.values({display:!0})},r,s);if(s.abortEarly)return w.finalize(e,[d],o);f.push(d)}}if(t._invalids){let u=t._invalids.get(e,r,s,t._flags.insensitive);if(u){r.mainstay.tracer.filter(t,r,"invalid",u);let d=t.$_createError("any.invalid",e,{invalids:t._invalids.values({display:!0})},r,s);if(s.abortEarly)return w.finalize(e,[d],o);f.push(d)}}if(a.validate){let u=a.validate(e,o);if(u&&(r.mainstay.tracer.value(r,"base",e,u.value),e=u.value,u.errors)){if(!Array.isArray(u.errors))return f.push(u.errors),w.finalize(e,f,o);if(u.errors.length)return f.push(...u.errors),w.finalize(e,f,o)}}return t._rules.length?w.rules(e,f,o):w.finalize(e,f,o)};w.rules=function(e,t,r){let{schema:s,state:n,prefs:i}=r;for(let o of s._rules){let a=s._definition.rules[o.method];if(a.convert&&i.convert){n.mainstay.tracer.log(s,n,"rule",o.name,"full");continue}let l,c=o.args;if(o._resolve.length){c=Object.assign({},c);for(let u of o._resolve){let d=a.argsByName.get(u),p=c[u].resolve(e,n,i),m=d.normalize?d.normalize(p):p,g=G.validateArg(m,null,d);if(g){l=s.$_createError("any.ref",p,{arg:u,ref:c[u],reason:g},n,i);break}c[u]=m}}l=l||a.validate(e,r,c,o);let f=w.rule(l,o);if(f.errors){if(n.mainstay.tracer.log(s,n,"rule",o.name,"error"),o.warn){n.mainstay.warnings.push(...f.errors);continue}if(i.abortEarly)return w.finalize(e,f.errors,r);t.push(...f.errors)}else n.mainstay.tracer.log(s,n,"rule",o.name,"pass"),n.mainstay.tracer.value(n,"rule",e,f.value,o.name),e=f.value}return w.finalize(e,t,r)};w.rule=function(e,t){return e instanceof dt.Report?(w.error(e,t),{errors:[e],value:null}):Array.isArray(e)&&e[G.symbols.errors]?(e.forEach(r=>w.error(r,t)),{errors:e,value:null}):{errors:null,value:e}};w.error=function(e,t){return t.message&&e._setTemplate(t.message),e};w.finalize=function(e,t,r){t=t||[];let{schema:s,state:n,prefs:i}=r;if(t.length){let a=w.default("failover",void 0,t,r);a!==void 0&&(n.mainstay.tracer.value(n,"failover",e,a),e=a,t=[])}if(t.length&&s._flags.error)if(typeof s._flags.error=="function"){t=s._flags.error(t),Array.isArray(t)||(t=[t]);for(let a of t)or(a instanceof Error||a instanceof dt.Report,"error() must return an Error object")}else t=[s._flags.error];if(e===void 0){let a=w.default("default",e,t,r);n.mainstay.tracer.value(n,"default",e,a),e=a}if(s._flags.cast&&e!==void 0){let a=s._definition.cast[s._flags.cast];if(a.from(e)){let l=a.to(e,r);n.mainstay.tracer.value(n,"cast",e,l,s._flags.cast),e=l}}if(s.$_terms.externals&&i.externals&&i._externals!==!1)for(let{method:a}of s.$_terms.externals)n.mainstay.externals.push({method:a,schema:s,state:n,label:dt.label(s._flags,n,i)});let o={value:e,errors:t.length?t:null};return s._flags.result&&(o.value=s._flags.result==="strip"?void 0:r.original,n.mainstay.tracer.value(n,s._flags.result,e,o.value),n.shadow(e,s._flags.result)),s._cache&&i.cache!==!1&&!s._refs.length&&s._cache.set(r.original,o),e!==void 0&&!o.errors&&s._flags.artifact!==void 0&&(n.mainstay.artifacts=n.mainstay.artifacts||new Map,n.mainstay.artifacts.has(s._flags.artifact)||n.mainstay.artifacts.set(s._flags.artifact,[]),n.mainstay.artifacts.get(s._flags.artifact).push(n.path)),o};w.prefs=function(e,t){let r=t===G.defaults;return r&&e._preferences[G.symbols.prefs]?e._preferences[G.symbols.prefs]:(t=G.preferences(t,e._preferences),r&&(e._preferences[G.symbols.prefs]=t),t)};w.default=function(e,t,r,s){let{schema:n,state:i,prefs:o}=s,a=n._flags[e];if(o.noDefaults||a===void 0)return t;if(i.mainstay.tracer.log(n,i,"rule",e,"full"),!a)return a;if(typeof a=="function"){let l=a.length?[nl(i.ancestors[0]),s]:[];try{return a(...l)}catch(c){r.push(n.$_createError(`any.${e}`,null,{error:c},i,o));return}}return typeof a!="object"?a:a[G.symbols.literal]?a.literal:G.isResolvable(a)?a.resolve(t,i,o):nl(a)};w.trim=function(e,t){if(typeof e!="string")return e;let r=t.$_getRule("trim");return!r||!r.args.enabled?e:e.trim()};w.ignore={active:!1,debug:Ut,entry:Ut,filter:Ut,log:Ut,resolve:Ut,value:Ut};w.errorsArray=function(){let e=[];return e[G.symbols.errors]=!0,e}});var Gn=y((Gy,al)=>{"use strict";var ip=R(),ol=ir(),Un=M(),Qe={};al.exports=Qe.Values=class{constructor(e,t){this._values=new Set(e),this._refs=new Set(t),this._lowercase=Qe.lowercases(e),this._override=!1}get length(){return this._values.size+this._refs.size}add(e,t){if(Un.isResolvable(e)){this._refs.has(e)||(this._refs.add(e),t&&t.register(e));return}this.has(e,null,null,!1)||(this._values.add(e),typeof e=="string"&&this._lowercase.set(e.toLowerCase(),e))}static merge(e,t,r){if(e=e||new Qe.Values,t){if(t._override)return t.clone();for(let s of[...t._values,...t._refs])e.add(s)}if(r)for(let s of[...r._values,...r._refs])e.remove(s);return e.length?e:null}remove(e){if(Un.isResolvable(e)){this._refs.delete(e);return}this._values.delete(e),typeof e=="string"&&this._lowercase.delete(e.toLowerCase())}has(e,t,r,s){return!!this.get(e,t,r,s)}get(e,t,r,s){if(!this.length)return!1;if(this._values.has(e))return{value:e};if(typeof e=="string"&&e&&s){let n=this._lowercase.get(e.toLowerCase());if(n)return{value:n}}if(!this._refs.size&&typeof e!="object")return!1;if(typeof e=="object"){for(let n of this._values)if(ol(n,e))return{value:n}}if(t)for(let n of this._refs){let i=n.resolve(e,t,r,null,{in:!0});if(i===void 0)continue;let o=!n.in||typeof i!="object"?[i]:Array.isArray(i)?i:Object.keys(i);for(let a of o)if(typeof a==typeof e){if(s&&e&&typeof e=="string"){if(a.toLowerCase()===e.toLowerCase())return{value:a,ref:n}}else if(ol(a,e))return{value:a,ref:n}}}return!1}override(){this._override=!0}values(e){if(e&&e.display){let t=[];for(let r of[...this._values,...this._refs])r!==void 0&&t.push(r);return t}return Array.from([...this._values,...this._refs])}clone(){let e=new Qe.Values(this._values,this._refs);return e._override=this._override,e}concat(e){ip(!e._override,"Cannot concat override set of values");let t=new Qe.Values([...this._values,...e._values],[...this._refs,...e._refs]);return t._override=this._override,t}describe(){let e=[];this._override&&e.push({override:!0});for(let t of this._values.values())e.push(t&&typeof t=="object"?{value:t}:t);for(let t of this._refs.values())e.push(t.describe());return e}};Qe.Values.prototype[Un.symbols.values]=!0;Qe.Values.prototype.slice=Qe.Values.prototype.clone;Qe.lowercases=function(e){let t=new Map;if(e)for(let r of e)typeof r=="string"&&t.set(r.toLowerCase(),r);return t}});var ml=y((zy,pl)=>{"use strict";var b=R(),ll=oe(),cl=ir(),Hn=Gr(),op=Mn(),F=M(),zn=Et(),ap=ze(),lp=Dn(),ul=Pn(),cp=qt(),fl=Ja(),dl=Xe(),hl=qn(),zr=il(),Xr=Gn(),V={};V.Base=class{constructor(e){this.type=e,this.$_root=null,this._definition={},this._reset()}_reset(){this._ids=new fl.Ids,this._preferences=null,this._refs=new dl.Manager,this._cache=null,this._valids=null,this._invalids=null,this._flags={},this._rules=[],this._singleRules=new Map,this.$_terms={},this.$_temp={ruleset:null,whens:{}}}describe(){return b(typeof ul.describe=="function","Manifest functionality disabled"),ul.describe(this)}allow(...e){return F.verifyFlat(e,"allow"),this._values(e,"_valids")}alter(e){b(e&&typeof e=="object"&&!Array.isArray(e),"Invalid targets argument"),b(!this._inRuleset(),"Cannot set alterations inside a ruleset");let t=this.clone();t.$_terms.alterations=t.$_terms.alterations||[];for(let r in e){let s=e[r];b(typeof s=="function","Alteration adjuster for",r,"must be a function"),t.$_terms.alterations.push({target:r,adjuster:s})}return t.$_temp.ruleset=!1,t}artifact(e){return b(e!==void 0,"Artifact cannot be undefined"),b(!this._cache,"Cannot set an artifact with a rule cache"),this.$_setFlag("artifact",e)}cast(e){return b(e===!1||typeof e=="string","Invalid to value"),b(e===!1||this._definition.cast[e],"Type",this.type,"does not support casting to",e),this.$_setFlag("cast",e===!1?void 0:e)}default(e,t){return this._default("default",e,t)}description(e){return b(e&&typeof e=="string","Description must be a non-empty string"),this.$_setFlag("description",e)}empty(e){let t=this.clone();return e!==void 0&&(e=t.$_compile(e,{override:!1})),t.$_setFlag("empty",e,{clone:!1})}error(e){return b(e,"Missing error"),b(e instanceof Error||typeof e=="function","Must provide a valid Error object or a function"),this.$_setFlag("error",e)}example(e,t={}){return b(e!==void 0,"Missing example"),F.assertOptions(t,["override"]),this._inner("examples",e,{single:!0,override:t.override})}external(e,t){return typeof e=="object"&&(b(!t,"Cannot combine options with description"),t=e.description,e=e.method),b(typeof e=="function","Method must be a function"),b(t===void 0||t&&typeof t=="string","Description must be a non-empty string"),this._inner("externals",{method:e,description:t},{single:!0})}failover(e,t){return this._default("failover",e,t)}forbidden(){return this.presence("forbidden")}id(e){return e?(b(typeof e=="string","id must be a non-empty string"),b(/^[^\.]+$/.test(e),"id cannot contain period character"),this.$_setFlag("id",e)):this.$_setFlag("id",void 0)}invalid(...e){return this._values(e,"_invalids")}label(e){return b(e&&typeof e=="string","Label name must be a non-empty string"),this.$_setFlag("label",e)}meta(e){return b(e!==void 0,"Meta cannot be undefined"),this._inner("metas",e,{single:!0})}note(...e){b(e.length,"Missing notes");for(let t of e)b(t&&typeof t=="string","Notes must be non-empty strings");return this._inner("notes",e)}only(e=!0){return b(typeof e=="boolean","Invalid mode:",e),this.$_setFlag("only",e)}optional(){return this.presence("optional")}prefs(e){b(e,"Missing preferences"),b(e.context===void 0,"Cannot override context"),b(e.externals===void 0,"Cannot override externals"),b(e.warnings===void 0,"Cannot override warnings"),b(e.debug===void 0,"Cannot override debug"),F.checkPreferences(e);let t=this.clone();return t._preferences=F.preferences(t._preferences,e),t}presence(e){return b(["optional","required","forbidden"].includes(e),"Unknown presence mode",e),this.$_setFlag("presence",e)}raw(e=!0){return this.$_setFlag("result",e?"raw":void 0)}result(e){return b(["raw","strip"].includes(e),"Unknown result mode",e),this.$_setFlag("result",e)}required(){return this.presence("required")}strict(e){let t=this.clone(),r=e===void 0?!1:!e;return t._preferences=F.preferences(t._preferences,{convert:r}),t}strip(e=!0){return this.$_setFlag("result",e?"strip":void 0)}tag(...e){b(e.length,"Missing tags");for(let t of e)b(t&&typeof t=="string","Tags must be non-empty strings");return this._inner("tags",e)}unit(e){return b(e&&typeof e=="string","Unit name must be a non-empty string"),this.$_setFlag("unit",e)}valid(...e){F.verifyFlat(e,"valid");let t=this.allow(...e);return t.$_setFlag("only",!!t._valids,{clone:!1}),t}when(e,t){let r=this.clone();r.$_terms.whens||(r.$_terms.whens=[]);let s=zn.when(r,e,t);if(!["any","link"].includes(r.type)){let n=s.is?[s]:s.switch;for(let i of n)b(!i.then||i.then.type==="any"||i.then.type===r.type,"Cannot combine",r.type,"with",i.then&&i.then.type),b(!i.otherwise||i.otherwise.type==="any"||i.otherwise.type===r.type,"Cannot combine",r.type,"with",i.otherwise&&i.otherwise.type)}return r.$_terms.whens.push(s),r.$_mutateRebuild()}cache(e){b(!this._inRuleset(),"Cannot set caching inside a ruleset"),b(!this._cache,"Cannot override schema cache"),b(this._flags.artifact===void 0,"Cannot cache a rule with an artifact");let t=this.clone();return t._cache=e||op.provider.provision(),t.$_temp.ruleset=!1,t}clone(){let e=Object.create(Object.getPrototypeOf(this));return this._assign(e)}concat(e){b(F.isSchema(e),"Invalid schema object"),b(this.type==="any"||e.type==="any"||e.type===this.type,"Cannot merge type",this.type,"with another type:",e.type),b(!this._inRuleset(),"Cannot concatenate onto a schema with open ruleset"),b(!e._inRuleset(),"Cannot concatenate a schema with open ruleset");let t=this.clone();if(this.type==="any"&&e.type!=="any"){let r=e.clone();for(let s of Object.keys(t))s!=="type"&&(r[s]=t[s]);t=r}t._ids.concat(e._ids),t._refs.register(e,dl.toSibling),t._preferences=t._preferences?F.preferences(t._preferences,e._preferences):e._preferences,t._valids=Xr.merge(t._valids,e._valids,e._invalids),t._invalids=Xr.merge(t._invalids,e._invalids,e._valids);for(let r of e._singleRules.keys())t._singleRules.has(r)&&(t._rules=t._rules.filter(s=>s.keep||s.name!==r),t._singleRules.delete(r));for(let r of e._rules)e._definition.rules[r.method].multi||t._singleRules.set(r.name,r),t._rules.push(r);if(t._flags.empty&&e._flags.empty){t._flags.empty=t._flags.empty.concat(e._flags.empty);let r=Object.assign({},e._flags);delete r.empty,Hn(t._flags,r)}else if(e._flags.empty){t._flags.empty=e._flags.empty;let r=Object.assign({},e._flags);delete r.empty,Hn(t._flags,r)}else Hn(t._flags,e._flags);for(let r in e.$_terms){let s=e.$_terms[r];if(!s){t.$_terms[r]||(t.$_terms[r]=s);continue}if(!t.$_terms[r]){t.$_terms[r]=s.slice();continue}t.$_terms[r]=t.$_terms[r].concat(s)}return this.$_root._tracer&&this.$_root._tracer._combine(t,[this,e]),t.$_mutateRebuild()}extend(e){return b(!e.base,"Cannot extend type with another base"),lp.type(this,e)}extract(e){return e=Array.isArray(e)?e:e.split("."),this._ids.reach(e)}fork(e,t){b(!this._inRuleset(),"Cannot fork inside a ruleset");let r=this;for(let s of[].concat(e))s=Array.isArray(s)?s:s.split("."),r=r._ids.fork(s,t,r);return r.$_temp.ruleset=!1,r}rule(e){let t=this._definition;F.assertOptions(e,Object.keys(t.modifiers)),b(this.$_temp.ruleset!==!1,"Cannot apply rules to empty ruleset or the last rule added does not support rule properties");let r=this.$_temp.ruleset===null?this._rules.length-1:this.$_temp.ruleset;b(r>=0&&r<this._rules.length,"Cannot apply rules to empty ruleset");let s=this.clone();for(let n=r;n<s._rules.length;++n){let i=s._rules[n],o=ll(i);for(let a in e)t.modifiers[a](o,e[a]),b(o.name===i.name,"Cannot change rule name");s._rules[n]=o,s._singleRules.get(o.name)===i&&s._singleRules.set(o.name,o)}return s.$_temp.ruleset=!1,s.$_mutateRebuild()}get ruleset(){b(!this._inRuleset(),"Cannot start a new ruleset without closing the previous one");let e=this.clone();return e.$_temp.ruleset=e._rules.length,e}get $(){return this.ruleset}tailor(e){e=[].concat(e),b(!this._inRuleset(),"Cannot tailor inside a ruleset");let t=this;if(this.$_terms.alterations)for(let{target:r,adjuster:s}of this.$_terms.alterations)e.includes(r)&&(t=s(t),b(F.isSchema(t),"Alteration adjuster for",r,"failed to return a schema object"));return t=t.$_modify({each:r=>r.tailor(e),ref:!1}),t.$_temp.ruleset=!1,t.$_mutateRebuild()}tracer(){return hl.location?hl.location(this):this}validate(e,t){return zr.entry(e,this,t)}validateAsync(e,t){return zr.entryAsync(e,this,t)}$_addRule(e){typeof e=="string"&&(e={name:e}),b(e&&typeof e=="object","Invalid options"),b(e.name&&typeof e.name=="string","Invalid rule name");for(let i in e)b(i[0]!=="_","Cannot set private rule properties");let t=Object.assign({},e);t._resolve=[],t.method=t.method||t.name;let r=this._definition.rules[t.method],s=t.args;b(r,"Unknown rule",t.method);let n=this.clone();if(s){b(Object.keys(s).length===1||Object.keys(s).length===this._definition.rules[t.name].args.length,"Invalid rule definition for",this.type,t.name);for(let i in s){let o=s[i];if(r.argsByName){let a=r.argsByName.get(i);if(a.ref&&F.isResolvable(o))t._resolve.push(i),n.$_mutateRegister(o);else if(a.normalize&&(o=a.normalize(o),s[i]=o),a.assert){let l=F.validateArg(o,i,a);b(!l,l,"or reference")}}if(o===void 0){delete s[i];continue}s[i]=o}}return r.multi||(n._ruleRemove(t.name,{clone:!1}),n._singleRules.set(t.name,t)),n.$_temp.ruleset===!1&&(n.$_temp.ruleset=null),r.priority?n._rules.unshift(t):n._rules.push(t),n}$_compile(e,t){return zn.schema(this.$_root,e,t)}$_createError(e,t,r,s,n,i={}){let o=i.flags!==!1?this._flags:{},a=i.messages?cp.merge(this._definition.messages,i.messages):this._definition.messages;return new ap.Report(e,t,r,o,a,s,n)}$_getFlag(e){return this._flags[e]}$_getRule(e){return this._singleRules.get(e)}$_mapLabels(e){return e=Array.isArray(e)?e:e.split("."),this._ids.labels(e)}$_match(e,t,r,s){r=Object.assign({},r),r.abortEarly=!0,r._externals=!1,t.snapshot();let n=!zr.validate(e,this,t,r,s).errors;return t.restore(),n}$_modify(e){return F.assertOptions(e,["each","once","ref","schema"]),fl.schema(this,e)||this}$_mutateRebuild(){b(!this._inRuleset(),"Cannot add this rule inside a ruleset"),this._refs.reset(),this._ids.reset();let e=(t,{source:r,name:s,path:n,key:i})=>{let o=this._definition[r][s]&&this._definition[r][s].register;o!==!1&&this.$_mutateRegister(t,{family:o,key:i})};return this.$_modify({each:e}),this._definition.rebuild&&this._definition.rebuild(this),this.$_temp.ruleset=!1,this}$_mutateRegister(e,{family:t,key:r}={}){this._refs.register(e,t),this._ids.register(e,{key:r})}$_property(e){return this._definition.properties[e]}$_reach(e){return this._ids.reach(e)}$_rootReferences(){return this._refs.roots()}$_setFlag(e,t,r={}){b(e[0]==="_"||!this._inRuleset(),"Cannot set flag inside a ruleset");let s=this._definition.flags[e]||{};if(cl(t,s.default)&&(t=void 0),cl(t,this._flags[e]))return this;let n=r.clone!==!1?this.clone():this;return t!==void 0?(n._flags[e]=t,n.$_mutateRegister(t)):delete n._flags[e],e[0]!=="_"&&(n.$_temp.ruleset=!1),n}$_parent(e,...t){return this[e][F.symbols.parent].call(this,...t)}$_validate(e,t,r){return zr.validate(e,this,t,r)}_assign(e){e.type=this.type,e.$_root=this.$_root,e.$_temp=Object.assign({},this.$_temp),e.$_temp.whens={},e._ids=this._ids.clone(),e._preferences=this._preferences,e._valids=this._valids&&this._valids.clone(),e._invalids=this._invalids&&this._invalids.clone(),e._rules=this._rules.slice(),e._singleRules=ll(this._singleRules,{shallow:!0}),e._refs=this._refs.clone(),e._flags=Object.assign({},this._flags),e._cache=null,e.$_terms={};for(let t in this.$_terms)e.$_terms[t]=this.$_terms[t]?this.$_terms[t].slice():null;e.$_super={};for(let t in this.$_super)e.$_super[t]=this._super[t].bind(e);return e}_bare(){let e=this.clone();e._reset();let t=e._definition.terms;for(let r in t){let s=t[r];e.$_terms[r]=s.init}return e.$_mutateRebuild()}_default(e,t,r={}){return F.assertOptions(r,"literal"),b(t!==void 0,"Missing",e,"value"),b(typeof t=="function"||!r.literal,"Only function value supports literal option"),typeof t=="function"&&r.literal&&(t={[F.symbols.literal]:!0,literal:t}),this.$_setFlag(e,t)}_generate(e,t,r){if(!this.$_terms.whens)return{schema:this};let s=[],n=[];for(let a=0;a<this.$_terms.whens.length;++a){let l=this.$_terms.whens[a];if(l.concat){s.push(l.concat),n.push(`${a}.concat`);continue}let c=l.ref?l.ref.resolve(e,t,r):e,f=l.is?[l]:l.switch,u=n.length;for(let d=0;d<f.length;++d){let{is:p,then:m,otherwise:g}=f[d],S=`${a}${l.switch?"."+d:""}`;if(p.$_match(c,t.nest(p,`${S}.is`),r)){if(m){let A=t.localize([...t.path,`${S}.then`],t.ancestors,t.schemas),{schema:v,id:z}=m._generate(e,A,r);s.push(v),n.push(`${S}.then${z?`(${z})`:""}`);break}}else if(g){let A=t.localize([...t.path,`${S}.otherwise`],t.ancestors,t.schemas),{schema:v,id:z}=g._generate(e,A,r);s.push(v),n.push(`${S}.otherwise${z?`(${z})`:""}`);break}}if(l.break&&n.length>u)break}let i=n.join(", ");if(t.mainstay.tracer.debug(t,"rule","when",i),!i)return{schema:this};if(!t.mainstay.tracer.active&&this.$_temp.whens[i])return{schema:this.$_temp.whens[i],id:i};let o=this;this._definition.generate&&(o=this._definition.generate(this,e,t,r));for(let a of s)o=o.concat(a);return this.$_root._tracer&&this.$_root._tracer._combine(o,[this,...s]),this.$_temp.whens[i]=o,{schema:o,id:i}}_inner(e,t,r={}){b(!this._inRuleset(),`Cannot set ${e} inside a ruleset`);let s=this.clone();return(!s.$_terms[e]||r.override)&&(s.$_terms[e]=[]),r.single?s.$_terms[e].push(t):s.$_terms[e].push(...t),s.$_temp.ruleset=!1,s}_inRuleset(){return this.$_temp.ruleset!==null&&this.$_temp.ruleset!==!1}_ruleRemove(e,t={}){if(!this._singleRules.has(e))return this;let r=t.clone!==!1?this.clone():this;r._singleRules.delete(e);let s=[];for(let n=0;n<r._rules.length;++n){let i=r._rules[n];if(i.name===e&&!i.keep){r._inRuleset()&&n<r.$_temp.ruleset&&--r.$_temp.ruleset;continue}s.push(i)}return r._rules=s,r}_values(e,t){F.verifyFlat(e,t.slice(1,-1));let r=this.clone(),s=e[0]===F.symbols.override;if(s&&(e=e.slice(1)),!r[t]&&e.length?r[t]=new Xr:s&&(r[t]=e.length?new Xr:null,r.$_mutateRebuild()),!r[t])return r;s&&r[t].override();for(let n of e){b(n!==void 0,"Cannot call allow/valid/invalid with undefined"),b(n!==F.symbols.override,"Override must be the first value");let i=t==="_invalids"?"_valids":"_invalids";r[i]&&(r[i].remove(n),r[i].length||(b(t==="_valids"||!r._flags.only,"Setting invalid value",n,"leaves schema rejecting all values due to previous valid rule"),r[i]=null)),r[t].add(n,r._refs)}return r}};V.Base.prototype[F.symbols.any]={version:F.version,compile:zn.compile,root:"$_root"};V.Base.prototype.isImmutable=!0;V.Base.prototype.deny=V.Base.prototype.invalid;V.Base.prototype.disallow=V.Base.prototype.invalid;V.Base.prototype.equal=V.Base.prototype.valid;V.Base.prototype.exist=V.Base.prototype.required;V.Base.prototype.not=V.Base.prototype.invalid;V.Base.prototype.options=V.Base.prototype.prefs;V.Base.prototype.preferences=V.Base.prototype.prefs;pl.exports=new V.Base});var Ce=y((Ky,yl)=>{"use strict";var Kr=R(),up=ml(),fp=M(),dp=qt();yl.exports=up.extend({type:"any",flags:{only:{default:!1}},terms:{alterations:{init:null},examples:{init:null},externals:{init:null},metas:{init:[]},notes:{init:[]},shared:{init:null},tags:{init:[]},whens:{init:null}},rules:{custom:{method(e,t){return Kr(typeof e=="function","Method must be a function"),Kr(t===void 0||t&&typeof t=="string","Description must be a non-empty string"),this.$_addRule({name:"custom",args:{method:e,description:t}})},validate(e,t,{method:r}){try{return r(e,t)}catch(s){return t.error("any.custom",{error:s})}},args:["method","description"],multi:!0},messages:{method(e){return this.prefs({messages:e})}},shared:{method(e){Kr(fp.isSchema(e)&&e._flags.id,"Schema must be a schema with an id");let t=this.clone();return t.$_terms.shared=t.$_terms.shared||[],t.$_terms.shared.push(e),t.$_mutateRegister(e),t}},warning:{method(e,t){return Kr(e&&typeof e=="string","Invalid warning code"),this.$_addRule({name:"warning",args:{code:e,local:t},warn:!0})},validate(e,t,{code:r,local:s}){return t.error(r,s)},args:["code","local"],multi:!0}},modifiers:{keep(e,t=!0){e.keep=t},message(e,t){e.message=dp.compile(t)},warn(e,t=!0){e.warn=t}},manifest:{build(e,t){for(let r in t){let s=t[r];if(["examples","externals","metas","notes","tags"].includes(r)){for(let n of s)e=e[r.slice(0,-1)](n);continue}if(r==="alterations"){let n={};for(let{target:i,adjuster:o}of s)n[i]=o;e=e.alter(n);continue}if(r==="whens"){for(let n of s){let{ref:i,is:o,not:a,then:l,otherwise:c,concat:f}=n;f?e=e.concat(f):i?e=e.when(i,{is:o,not:a,then:l,otherwise:c,switch:n.switch,break:n.break}):e=e.when(o,{then:l,otherwise:c,break:n.break})}continue}if(r==="shared")for(let n of s)e=e.shared(n)}return e}},messages:{"any.custom":"{{#label}} failed custom validation because {{#error.message}}","any.default":"{{#label}} threw an error when running default method","any.failover":"{{#label}} threw an error when running failover method","any.invalid":"{{#label}} contains an invalid value","any.only":'{{#label}} must be {if(#valids.length == 1, "", "one of ")}{{#valids}}',"any.ref":"{{#label}} {{#arg}} references {{:#ref}} which {{#reason}}","any.required":"{{#label}} is required","any.unknown":"{{#label}} is not allowed"}})});var Sl=y((Vy,bl)=>{"use strict";var Ct=R(),hp=Gr(),pp=Ce(),gl=M(),mp=Et(),Vr=ze(),yp=Xe(),Gt={};bl.exports=pp.extend({type:"alternatives",flags:{match:{default:"any"}},terms:{matches:{init:[],register:yp.toSibling}},args(e,...t){return t.length===1&&Array.isArray(t[0])?e.try(...t[0]):e.try(...t)},validate(e,t){let{schema:r,error:s,state:n,prefs:i}=t;if(r._flags.match){let a=[],l=[];for(let f=0;f<r.$_terms.matches.length;++f){let u=r.$_terms.matches[f],d=n.nest(u.schema,`match.${f}`);d.snapshot();let p=u.schema.$_validate(e,d,i);p.errors?(l.push(p.errors),d.restore()):(a.push(p.value),d.commit())}if(a.length===0){let f={details:l.map(u=>Vr.details(u,{override:!1}))};return{errors:s("alternatives.any",f)}}if(r._flags.match==="one")return a.length===1?{value:a[0]}:{errors:s("alternatives.one")};if(a.length!==r.$_terms.matches.length){let f={details:l.map(u=>Vr.details(u,{override:!1}))};return{errors:s("alternatives.all",f)}}let c=f=>f.$_terms.matches.some(u=>u.schema.type==="object"||u.schema.type==="alternatives"&&c(u.schema));return c(r)?{value:a.reduce((f,u)=>hp(f,u,{mergeArrays:!1}))}:{value:a[a.length-1]}}let o=[];for(let a=0;a<r.$_terms.matches.length;++a){let l=r.$_terms.matches[a];if(l.schema){let u=n.nest(l.schema,`match.${a}`);u.snapshot();let d=l.schema.$_validate(e,u,i);if(!d.errors)return u.commit(),d;u.restore(),o.push({schema:l.schema,reports:d.errors});continue}let c=l.ref?l.ref.resolve(e,n,i):e,f=l.is?[l]:l.switch;for(let u=0;u<f.length;++u){let d=f[u],{is:p,then:m,otherwise:g}=d,S=`match.${a}${l.switch?"."+u:""}`;if(p.$_match(c,n.nest(p,`${S}.is`),i)){if(m)return m.$_validate(e,n.nest(m,`${S}.then`),i)}else if(g)return g.$_validate(e,n.nest(g,`${S}.otherwise`),i)}}return Gt.errors(o,t)},rules:{conditional:{method(e,t){Ct(!this._flags._endedSwitch,"Unreachable condition"),Ct(!this._flags.match,"Cannot combine match mode",this._flags.match,"with conditional rule"),Ct(t.break===void 0,"Cannot use break option with alternatives conditional");let r=this.clone(),s=mp.when(r,e,t),n=s.is?[s]:s.switch;for(let i of n)if(i.then&&i.otherwise){r.$_setFlag("_endedSwitch",!0,{clone:!1});break}return r.$_terms.matches.push(s),r.$_mutateRebuild()}},match:{method(e){if(Ct(["any","one","all"].includes(e),"Invalid alternatives match mode",e),e!=="any")for(let t of this.$_terms.matches)Ct(t.schema,"Cannot combine match mode",e,"with conditional rules");return this.$_setFlag("match",e)}},try:{method(...e){Ct(e.length,"Missing alternative schemas"),gl.verifyFlat(e,"try"),Ct(!this._flags._endedSwitch,"Unreachable condition");let t=this.clone();for(let r of e)t.$_terms.matches.push({schema:t.$_compile(r)});return t.$_mutateRebuild()}}},overrides:{label(e){let t=this.$_parent("label",e),r=(s,n)=>n.path[0]!=="is"?s.label(e):void 0;return t.$_modify({each:r,ref:!1})}},rebuild(e){let t=r=>{gl.isSchema(r)&&r.type==="array"&&e.$_setFlag("_arrayItems",!0,{clone:!1})};e.$_modify({each:t})},manifest:{build(e,t){if(t.matches)for(let r of t.matches){let{schema:s,ref:n,is:i,not:o,then:a,otherwise:l}=r;s?e=e.try(s):n?e=e.conditional(n,{is:i,then:a,not:o,otherwise:l,switch:r.switch}):e=e.conditional(i,{then:a,otherwise:l})}return e}},messages:{"alternatives.all":"{{#label}} does not match all of the required types","alternatives.any":"{{#label}} does not match any of the allowed types","alternatives.match":"{{#label}} does not match any of the allowed types","alternatives.one":"{{#label}} matches more than one allowed type","alternatives.types":"{{#label}} must be one of {{#types}}"}});Gt.errors=function(e,{error:t,state:r}){if(!e.length)return{errors:t("alternatives.any")};if(e.length===1)return{errors:e[0].reports};let s=new Set,n=[];for(let{reports:i,schema:o}of e){if(i.length>1)return Gt.unmatched(e,t);let a=i[0];if(!(a instanceof Vr.Report))return Gt.unmatched(e,t);if(a.state.path.length!==r.path.length){n.push({type:o.type,report:a});continue}if(a.code==="any.only"){for(let f of a.local.valids)s.add(f);continue}let[l,c]=a.code.split(".");if(c!=="base"){n.push({type:o.type,report:a});continue}s.add(l)}return n.length?n.length===1?{errors:n[0].report}:Gt.unmatched(e,t):{errors:t("alternatives.types",{types:[...s]})}};Gt.unmatched=function(e,t){let r=[];for(let s of e)r.push(...s.reports);return{errors:t("alternatives.match",Vr.details(r,{override:!1}))}}});var Al=y((Qy,_l)=>{"use strict";var lr=R(),gp=ir(),bp=St(),Sp=Ce(),ke=M(),_p=Et(),L={};_l.exports=Sp.extend({type:"array",flags:{single:{default:!1},sparse:{default:!1}},terms:{items:{init:[],manifest:"schema"},ordered:{init:[],manifest:"schema"},_exclusions:{init:[]},_inclusions:{init:[]},_requireds:{init:[]}},coerce:{from:"object",method(e,{schema:t,state:r,prefs:s}){if(!Array.isArray(e))return;let n=t.$_getRule("sort");if(n)return L.sort(t,e,n.args.options,r,s)}},validate(e,{schema:t,error:r}){if(!Array.isArray(e)){if(t._flags.single){let s=[e];return s[ke.symbols.arraySingle]=!0,{value:s}}return{errors:r("array.base")}}if(!(!t.$_getRule("items")&&!t.$_terms.externals))return{value:e.slice()}},rules:{has:{method(e){e=this.$_compile(e,{appendPath:!0});let t=this.$_addRule({name:"has",args:{schema:e}});return t.$_mutateRegister(e),t},validate(e,{state:t,prefs:r,error:s},{schema:n}){let i=[e,...t.ancestors];for(let a=0;a<e.length;++a){let l=t.localize([...t.path,a],i,n);if(n.$_match(e[a],l,r))return e}let o=n._flags.label;return o?s("array.hasKnown",{patternLabel:o}):s("array.hasUnknown",null)},multi:!0},items:{method(...e){ke.verifyFlat(e,"items");let t=this.$_addRule("items");for(let r=0;r<e.length;++r){let s=ke.tryWithPath(()=>this.$_compile(e[r]),r,{append:!0});t.$_terms.items.push(s)}return t.$_mutateRebuild()},validate(e,{schema:t,error:r,state:s,prefs:n,errorsArray:i}){let o=t.$_terms._requireds.slice(),a=t.$_terms.ordered.slice(),l=[...t.$_terms._inclusions,...o],c=!e[ke.symbols.arraySingle];delete e[ke.symbols.arraySingle];let f=i(),u=e.length;for(let d=0;d<u;++d){let p=e[d],m=!1,g=!1,S=c?d:new Number(d),A=[...s.path,S];if(!t._flags.sparse&&p===void 0){if(f.push(r("array.sparse",{key:S,path:A,pos:d,value:void 0},s.localize(A))),n.abortEarly)return f;a.shift();continue}let v=[e,...s.ancestors];for(let N of t.$_terms._exclusions)if(N.$_match(p,s.localize(A,v,N),n,{presence:"ignore"})){if(f.push(r("array.excludes",{pos:d,value:p},s.localize(A))),n.abortEarly)return f;m=!0,a.shift();break}if(m)continue;if(t.$_terms.ordered.length){if(a.length){let N=a.shift(),j=N.$_validate(p,s.localize(A,v,N),n);if(j.errors){if(f.push(...j.errors),n.abortEarly)return f}else if(N._flags.result==="strip")L.fastSplice(e,d),--d,--u;else if(!t._flags.sparse&&j.value===void 0){if(f.push(r("array.sparse",{key:S,path:A,pos:d,value:void 0},s.localize(A))),n.abortEarly)return f;continue}else e[d]=j.value;continue}else if(!t.$_terms.items.length){if(f.push(r("array.orderedLength",{pos:d,limit:t.$_terms.ordered.length})),n.abortEarly)return f;break}}let z=[],X=o.length;for(let N=0;N<X;++N){let j=s.localize(A,v,o[N]);j.snapshot();let ue=o[N].$_validate(p,j,n);if(z[N]=ue,!ue.errors){if(j.commit(),e[d]=ue.value,g=!0,L.fastSplice(o,N),--N,--X,!t._flags.sparse&&ue.value===void 0&&(f.push(r("array.sparse",{key:S,path:A,pos:d,value:void 0},s.localize(A))),n.abortEarly))return f;break}j.restore()}if(g)continue;let Xt=n.stripUnknown&&!!n.stripUnknown.arrays||!1;X=l.length;for(let N of l){let j,ue=o.indexOf(N);if(ue!==-1)j=z[ue];else{let qe=s.localize(A,v,N);if(qe.snapshot(),j=N.$_validate(p,qe,n),!j.errors){qe.commit(),N._flags.result==="strip"?(L.fastSplice(e,d),--d,--u):!t._flags.sparse&&j.value===void 0?(f.push(r("array.sparse",{key:S,path:A,pos:d,value:void 0},s.localize(A))),m=!0):e[d]=j.value,g=!0;break}qe.restore()}if(X===1){if(Xt){L.fastSplice(e,d),--d,--u,g=!0;break}if(f.push(...j.errors),n.abortEarly)return f;m=!0;break}}if(!m&&(t.$_terms._inclusions.length||t.$_terms._requireds.length)&&!g){if(Xt){L.fastSplice(e,d),--d,--u;continue}if(f.push(r("array.includes",{pos:d,value:p},s.localize(A))),n.abortEarly)return f}}return o.length&&L.fillMissedErrors(t,f,o,e,s,n),a.length&&(L.fillOrderedErrors(t,f,a,e,s,n),f.length||L.fillDefault(a,e,s,n)),f.length?f:e},priority:!0,manifest:!1},length:{method(e){return this.$_addRule({name:"length",args:{limit:e},operator:"="})},validate(e,t,{limit:r},{name:s,operator:n,args:i}){return ke.compare(e.length,r,n)?e:t.error("array."+s,{limit:i.limit,value:e})},args:[{name:"limit",ref:!0,assert:ke.limit,message:"must be a positive integer"}]},max:{method(e){return this.$_addRule({name:"max",method:"length",args:{limit:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"length",args:{limit:e},operator:">="})}},ordered:{method(...e){ke.verifyFlat(e,"ordered");let t=this.$_addRule("items");for(let r=0;r<e.length;++r){let s=ke.tryWithPath(()=>this.$_compile(e[r]),r,{append:!0});L.validateSingle(s,t),t.$_mutateRegister(s),t.$_terms.ordered.push(s)}return t.$_mutateRebuild()}},single:{method(e){let t=e===void 0?!0:!!e;return lr(!t||!this._flags._arrayItems,"Cannot specify single rule when array has array items"),this.$_setFlag("single",t)}},sort:{method(e={}){ke.assertOptions(e,["by","order"]);let t={order:e.order||"ascending"};return e.by&&(t.by=_p.ref(e.by,{ancestor:0}),lr(!t.by.ancestor,"Cannot sort by ancestor")),this.$_addRule({name:"sort",args:{options:t}})},validate(e,{error:t,state:r,prefs:s,schema:n},{options:i}){let{value:o,errors:a}=L.sort(n,e,i,r,s);if(a)return a;for(let l=0;l<e.length;++l)if(e[l]!==o[l])return t("array.sort",{order:i.order,by:i.by?i.by.key:"value"});return e},convert:!0},sparse:{method(e){let t=e===void 0?!0:!!e;return this._flags.sparse===t?this:(t?this.clone():this.$_addRule("items")).$_setFlag("sparse",t,{clone:!1})}},unique:{method(e,t={}){lr(!e||typeof e=="function"||typeof e=="string","comparator must be a function or a string"),ke.assertOptions(t,["ignoreUndefined","separator"]);let r={name:"unique",args:{options:t,comparator:e}};if(e)if(typeof e=="string"){let s=ke.default(t.separator,".");r.path=s?e.split(s):[e]}else r.comparator=e;return this.$_addRule(r)},validate(e,{state:t,error:r,schema:s},{comparator:n,options:i},{comparator:o,path:a}){let l={string:Object.create(null),number:Object.create(null),undefined:Object.create(null),boolean:Object.create(null),object:new Map,function:new Map,custom:new Map},c=o||gp,f=i.ignoreUndefined;for(let u=0;u<e.length;++u){let d=a?bp(e[u],a):e[u],p=o?l.custom:l[typeof d];if(lr(p,"Failed to find unique map container for type",typeof d),p instanceof Map){let m=p.entries(),g;for(;!(g=m.next()).done;)if(c(g.value[0],d)){let S=t.localize([...t.path,u],[e,...t.ancestors]),A={pos:u,value:e[u],dupePos:g.value[1],dupeValue:e[g.value[1]]};return a&&(A.path=n),r("array.unique",A,S)}p.set(d,u)}else{if((!f||d!==void 0)&&p[d]!==void 0){let m={pos:u,value:e[u],dupePos:p[d],dupeValue:e[p[d]]};a&&(m.path=n);let g=t.localize([...t.path,u],[e,...t.ancestors]);return r("array.unique",m,g)}p[d]=u}}return e},args:["comparator","options"],multi:!0}},cast:{set:{from:Array.isArray,to(e,t){return new Set(e)}}},rebuild(e){e.$_terms._inclusions=[],e.$_terms._exclusions=[],e.$_terms._requireds=[];for(let t of e.$_terms.items)L.validateSingle(t,e),t._flags.presence==="required"?e.$_terms._requireds.push(t):t._flags.presence==="forbidden"?e.$_terms._exclusions.push(t):e.$_terms._inclusions.push(t);for(let t of e.$_terms.ordered)L.validateSingle(t,e)},manifest:{build(e,t){return t.items&&(e=e.items(...t.items)),t.ordered&&(e=e.ordered(...t.ordered)),e}},messages:{"array.base":"{{#label}} must be an array","array.excludes":"{{#label}} contains an excluded value","array.hasKnown":"{{#label}} does not contain at least one required match for type {:#patternLabel}","array.hasUnknown":"{{#label}} does not contain at least one required match","array.includes":"{{#label}} does not match any of the allowed types","array.includesRequiredBoth":"{{#label}} does not contain {{#knownMisses}} and {{#unknownMisses}} other required value(s)","array.includesRequiredKnowns":"{{#label}} does not contain {{#knownMisses}}","array.includesRequiredUnknowns":"{{#label}} does not contain {{#unknownMisses}} required value(s)","array.length":"{{#label}} must contain {{#limit}} items","array.max":"{{#label}} must contain less than or equal to {{#limit}} items","array.min":"{{#label}} must contain at least {{#limit}} items","array.orderedLength":"{{#label}} must contain at most {{#limit}} items","array.sort":"{{#label}} must be sorted in {#order} order by {{#by}}","array.sort.mismatching":"{{#label}} cannot be sorted due to mismatching types","array.sort.unsupported":"{{#label}} cannot be sorted due to unsupported type {#type}","array.sparse":"{{#label}} must not be a sparse array item","array.unique":"{{#label}} contains a duplicate value"}});L.fillMissedErrors=function(e,t,r,s,n,i){let o=[],a=0;for(let l of r){let c=l._flags.label;c?o.push(c):++a}o.length?a?t.push(e.$_createError("array.includesRequiredBoth",s,{knownMisses:o,unknownMisses:a},n,i)):t.push(e.$_createError("array.includesRequiredKnowns",s,{knownMisses:o},n,i)):t.push(e.$_createError("array.includesRequiredUnknowns",s,{unknownMisses:a},n,i))};L.fillOrderedErrors=function(e,t,r,s,n,i){let o=[];for(let a of r)a._flags.presence==="required"&&o.push(a);o.length&&L.fillMissedErrors(e,t,o,s,n,i)};L.fillDefault=function(e,t,r,s){let n=[],i=!0;for(let o=e.length-1;o>=0;--o){let a=e[o],l=[t,...r.ancestors],c=a.$_validate(void 0,r.localize(r.path,l,a),s).value;if(i){if(c===void 0)continue;i=!1}n.unshift(c)}n.length&&t.push(...n)};L.fastSplice=function(e,t){let r=t;for(;r<e.length;)e[r++]=e[r];--e.length};L.validateSingle=function(e,t){(e.type==="array"||e._flags._arrayItems)&&(lr(!t._flags.single,"Cannot specify array item with single rule enabled"),t.$_setFlag("_arrayItems",!0,{clone:!1}))};L.sort=function(e,t,r,s,n){let i=r.order==="ascending"?1:-1,o=-1*i,a=i,l=(c,f)=>{let u=L.compare(c,f,o,a);if(u!==null||(r.by&&(c=r.by.resolve(c,s,n),f=r.by.resolve(f,s,n)),u=L.compare(c,f,o,a),u!==null))return u;let d=typeof c;if(d!==typeof f)throw e.$_createError("array.sort.mismatching",t,null,s,n);if(d!=="number"&&d!=="string")throw e.$_createError("array.sort.unsupported",t,{type:d},s,n);return d==="number"?(c-f)*i:c<f?o:a};try{return{value:t.slice().sort(l)}}catch(c){return{errors:c}}};L.compare=function(e,t,r,s){return e===t?0:e===void 0?1:t===void 0?-1:e===null?s:t===null?r:null}});var Rl=y((Yy,kl)=>{"use strict";var El=R(),Ap=Ce(),wl=M(),Cl=Gn(),Xn={};Xn.isBool=function(e){return typeof e=="boolean"};kl.exports=Ap.extend({type:"boolean",flags:{sensitive:{default:!1}},terms:{falsy:{init:null,manifest:"values"},truthy:{init:null,manifest:"values"}},coerce(e,{schema:t}){if(typeof e!="boolean"){if(typeof e=="string"){let r=t._flags.sensitive?e:e.toLowerCase();e=r==="true"?!0:r==="false"?!1:e}return typeof e!="boolean"&&(e=t.$_terms.truthy&&t.$_terms.truthy.has(e,null,null,!t._flags.sensitive)||(t.$_terms.falsy&&t.$_terms.falsy.has(e,null,null,!t._flags.sensitive)?!1:e)),{value:e}}},validate(e,{error:t}){if(typeof e!="boolean")return{value:e,errors:t("boolean.base")}},rules:{truthy:{method(...e){wl.verifyFlat(e,"truthy");let t=this.clone();t.$_terms.truthy=t.$_terms.truthy||new Cl;for(let r=0;r<e.length;++r){let s=e[r];El(s!==void 0,"Cannot call truthy with undefined"),t.$_terms.truthy.add(s)}return t}},falsy:{method(...e){wl.verifyFlat(e,"falsy");let t=this.clone();t.$_terms.falsy=t.$_terms.falsy||new Cl;for(let r=0;r<e.length;++r){let s=e[r];El(s!==void 0,"Cannot call falsy with undefined"),t.$_terms.falsy.add(s)}return t}},sensitive:{method(e=!0){return this.$_setFlag("sensitive",e)}}},cast:{number:{from:Xn.isBool,to(e,t){return e?1:0}},string:{from:Xn.isBool,to(e,t){return e?"true":"false"}}},manifest:{build(e,t){return t.truthy&&(e=e.truthy(...t.truthy)),t.falsy&&(e=e.falsy(...t.falsy)),e}},messages:{"boolean.base":"{{#label}} must be a boolean"}})});var Il=y((Wy,xl)=>{"use strict";var Ol=R(),Ep=Ce(),vl=M(),wp=ut(),ve={};ve.isDate=function(e){return e instanceof Date};xl.exports=Ep.extend({type:"date",coerce:{from:["number","string"],method(e,{schema:t}){return{value:ve.parse(e,t._flags.format)||e}}},validate(e,{schema:t,error:r,prefs:s}){if(e instanceof Date&&!isNaN(e.getTime()))return;let n=t._flags.format;return!s.convert||!n||typeof e!="string"?{value:e,errors:r("date.base")}:{value:e,errors:r("date.format",{format:n})}},rules:{compare:{method:!1,validate(e,t,{date:r},{name:s,operator:n,args:i}){let o=r==="now"?Date.now():r.getTime();return vl.compare(e.getTime(),o,n)?e:t.error("date."+s,{limit:i.date,value:e})},args:[{name:"date",ref:!0,normalize:e=>e==="now"?e:ve.parse(e),assert:e=>e!==null,message:"must have a valid date format"}]},format:{method(e){return Ol(["iso","javascript","unix"].includes(e),"Unknown date format",e),this.$_setFlag("format",e)}},greater:{method(e){return this.$_addRule({name:"greater",method:"compare",args:{date:e},operator:">"})}},iso:{method(){return this.format("iso")}},less:{method(e){return this.$_addRule({name:"less",method:"compare",args:{date:e},operator:"<"})}},max:{method(e){return this.$_addRule({name:"max",method:"compare",args:{date:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"compare",args:{date:e},operator:">="})}},timestamp:{method(e="javascript"){return Ol(["javascript","unix"].includes(e),'"type" must be one of "javascript, unix"'),this.format(e)}}},cast:{number:{from:ve.isDate,to(e,t){return e.getTime()}},string:{from:ve.isDate,to(e,{prefs:t}){return wp.date(e,t)}}},messages:{"date.base":"{{#label}} must be a valid date","date.format":'{{#label}} must be in {msg("date.format." + #format) || #format} format',"date.greater":"{{#label}} must be greater than {{:#limit}}","date.less":"{{#label}} must be less than {{:#limit}}","date.max":"{{#label}} must be less than or equal to {{:#limit}}","date.min":"{{#label}} must be greater than or equal to {{:#limit}}","date.format.iso":"ISO 8601 date","date.format.javascript":"timestamp or number of milliseconds","date.format.unix":"timestamp or number of seconds"}});ve.parse=function(e,t){if(e instanceof Date)return e;if(typeof e!="string"&&(isNaN(e)||!isFinite(e))||/^\s*$/.test(e))return null;if(t==="iso")return vl.isIsoDate(e)?ve.date(e.toString()):null;let r=e;if(typeof e=="string"&&/^[+-]?\d+(\.\d+)?$/.test(e)&&(e=parseFloat(e)),t){if(t==="javascript")return ve.date(1*e);if(t==="unix")return ve.date(1e3*e);if(typeof r=="string")return null}return ve.date(e)};ve.date=function(e){let t=new Date(e);return isNaN(t.getTime())?null:t}});var Bl=y((Jy,Dl)=>{"use strict";var Qr=R(),Nl=oe(),Ml=Gr(),Tl=St(),Yr={};Dl.exports=function(e,t,r={}){if(Qr(e&&typeof e=="object","Invalid defaults value: must be an object"),Qr(!t||t===!0||typeof t=="object","Invalid source value: must be true, falsy or an object"),Qr(typeof r=="object","Invalid options: must be an object"),!t)return null;if(r.shallow)return Yr.applyToDefaultsWithShallow(e,t,r);let s=Nl(e);if(t===!0)return s;let n=r.nullOverride!==void 0?r.nullOverride:!1;return Ml(s,t,{nullOverride:n,mergeArrays:!1})};Yr.applyToDefaultsWithShallow=function(e,t,r){let s=r.shallow;Qr(Array.isArray(s),"Invalid keys");let n=new Map,i=t===!0?null:new Set;for(let l of s){l=Array.isArray(l)?l:l.split(".");let c=Tl(e,l);c&&typeof c=="object"?n.set(c,i&&Tl(t,l)||c):i&&i.add(l)}let o=Nl(e,{},n);if(!i)return o;for(let l of i)Yr.reachCopy(o,t,l);let a=r.nullOverride!==void 0?r.nullOverride:!1;return Ml(o,t,{nullOverride:a,mergeArrays:!1})};Yr.reachCopy=function(e,t,r){for(let i of r){if(!(i in t))return;let o=t[i];if(typeof o!="object"||o===null)return;t=o}let s=t,n=e;for(let i=0;i<r.length-1;++i){let o=r[i];typeof n[o]!="object"&&(n[o]={}),n=n[o]}n[r[r.length-1]]=s}});var $l=y(Pl=>{"use strict";var kt=R(),Ll={};Pl.Sorter=class{constructor(){this._items=[],this.nodes=[]}add(e,t){t=t||{};let r=[].concat(t.before||[]),s=[].concat(t.after||[]),n=t.group||"?",i=t.sort||0;kt(!r.includes(n),`Item cannot come before itself: ${n}`),kt(!r.includes("?"),"Item cannot come before unassociated items"),kt(!s.includes(n),`Item cannot come after itself: ${n}`),kt(!s.includes("?"),"Item cannot come after unassociated items"),Array.isArray(e)||(e=[e]);for(let o of e){let a={seq:this._items.length,sort:i,before:r,after:s,group:n,node:o};this._items.push(a)}if(!t.manual){let o=this._sort();kt(o,"item",n!=="?"?`added into group ${n}`:"","created a dependencies error")}return this.nodes}merge(e){Array.isArray(e)||(e=[e]);for(let r of e)if(r)for(let s of r._items)this._items.push(Object.assign({},s));this._items.sort(Ll.mergeSort);for(let r=0;r<this._items.length;++r)this._items[r].seq=r;let t=this._sort();return kt(t,"merge created a dependencies error"),this.nodes}sort(){let e=this._sort();return kt(e,"sort created a dependencies error"),this.nodes}_sort(){let e={},t=Object.create(null),r=Object.create(null);for(let a of this._items){let l=a.seq,c=a.group;r[c]=r[c]||[],r[c].push(l),e[l]=a.before;for(let f of a.after)t[f]=t[f]||[],t[f].push(l)}for(let a in e){let l=[];for(let c in e[a]){let f=e[a][c];r[f]=r[f]||[],l.push(...r[f])}e[a]=l}for(let a in t)if(r[a])for(let l of r[a])e[l].push(...t[a]);let s={};for(let a in e){let l=e[a];for(let c of l)s[c]=s[c]||[],s[c].push(a)}let n={},i=[];for(let a=0;a<this._items.length;++a){let l=a;if(s[a]){l=null;for(let c=0;c<this._items.length;++c){if(n[c]===!0)continue;s[c]||(s[c]=[]);let f=s[c].length,u=0;for(let d=0;d<f;++d)n[s[c][d]]&&++u;if(u===f){l=c;break}}}l!==null&&(n[l]=!0,i.push(l))}if(i.length!==this._items.length)return!1;let o={};for(let a of this._items)o[a.seq]=a;this._items=[],this.nodes=[];for(let a of i){let l=o[a];this.nodes.push(l.node),this._items.push(l)}return!0}};Ll.mergeSort=(e,t)=>e.sort===t.sort?0:e.sort<t.sort?-1:1});var Vn=y((tg,Fl)=>{"use strict";var Cp=Bl(),Re=R(),ql=oe(),kp=$l(),Rp=Ce(),re=M(),Kn=Et(),Op=ze(),jl=Xe(),Wr=ut(),_={renameDefaults:{alias:!1,multiple:!1,override:!1}};Fl.exports=Rp.extend({type:"_keys",properties:{typeof:"object"},flags:{unknown:{default:!1}},terms:{dependencies:{init:null},keys:{init:null,manifest:{mapped:{from:"schema",to:"key"}}},patterns:{init:null},renames:{init:null}},args(e,t){return e.keys(t)},validate(e,{schema:t,error:r,state:s,prefs:n}){if(!e||typeof e!==t.$_property("typeof")||Array.isArray(e))return{value:e,errors:r("object.base",{type:t.$_property("typeof")})};if(!t.$_terms.renames&&!t.$_terms.dependencies&&!t.$_terms.keys&&!t.$_terms.patterns&&!t.$_terms.externals)return;e=_.clone(e,n);let i=[];if(t.$_terms.renames&&!_.rename(t,e,s,n,i))return{value:e,errors:i};if(!t.$_terms.keys&&!t.$_terms.patterns&&!t.$_terms.dependencies)return{value:e,errors:i};let o=new Set(Object.keys(e));if(t.$_terms.keys){let a=[e,...s.ancestors];for(let l of t.$_terms.keys){let c=l.key,f=e[c];o.delete(c);let u=s.localize([...s.path,c],a,l),d=l.schema.$_validate(f,u,n);if(d.errors){if(n.abortEarly)return{value:e,errors:d.errors};d.value!==void 0&&(e[c]=d.value),i.push(...d.errors)}else l.schema._flags.result==="strip"||d.value===void 0&&f!==void 0?delete e[c]:d.value!==void 0&&(e[c]=d.value)}}if(o.size||t._flags._hasPatternMatch){let a=_.unknown(t,e,o,i,s,n);if(a)return a}if(t.$_terms.dependencies)for(let a of t.$_terms.dependencies){if(a.key!==null&&_.isPresent(a.options)(a.key.resolve(e,s,n,null,{shadow:!1}))===!1)continue;let l=_.dependencies[a.rel](t,a,e,s,n);if(l){let c=t.$_createError(l.code,e,l.context,s,n);if(n.abortEarly)return{value:e,errors:c};i.push(c)}}return{value:e,errors:i}},rules:{and:{method(...e){return re.verifyFlat(e,"and"),_.dependency(this,"and",null,e)}},append:{method(e){return e==null||Object.keys(e).length===0?this:this.keys(e)}},assert:{method(e,t,r){Wr.isTemplate(e)||(e=Kn.ref(e)),Re(r===void 0||typeof r=="string","Message must be a string"),t=this.$_compile(t,{appendPath:!0});let s=this.$_addRule({name:"assert",args:{subject:e,schema:t,message:r}});return s.$_mutateRegister(e),s.$_mutateRegister(t),s},validate(e,{error:t,prefs:r,state:s},{subject:n,schema:i,message:o}){let a=n.resolve(e,s,r),l=jl.isRef(n)?n.absolute(s):[];return i.$_match(a,s.localize(l,[e,...s.ancestors],i),r)?e:t("object.assert",{subject:n,message:o})},args:["subject","schema","message"],multi:!0},instance:{method(e,t){return Re(typeof e=="function","constructor must be a function"),t=t||e.name,this.$_addRule({name:"instance",args:{constructor:e,name:t}})},validate(e,t,{constructor:r,name:s}){return e instanceof r?e:t.error("object.instance",{type:s,value:e})},args:["constructor","name"]},keys:{method(e){Re(e===void 0||typeof e=="object","Object schema must be a valid object"),Re(!re.isSchema(e),"Object schema cannot be a joi schema");let t=this.clone();if(!e)t.$_terms.keys=null;else if(!Object.keys(e).length)t.$_terms.keys=new _.Keys;else{t.$_terms.keys=t.$_terms.keys?t.$_terms.keys.filter(r=>!e.hasOwnProperty(r.key)):new _.Keys;for(let r in e)re.tryWithPath(()=>t.$_terms.keys.push({key:r,schema:this.$_compile(e[r])}),r)}return t.$_mutateRebuild()}},length:{method(e){return this.$_addRule({name:"length",args:{limit:e},operator:"="})},validate(e,t,{limit:r},{name:s,operator:n,args:i}){return re.compare(Object.keys(e).length,r,n)?e:t.error("object."+s,{limit:i.limit,value:e})},args:[{name:"limit",ref:!0,assert:re.limit,message:"must be a positive integer"}]},max:{method(e){return this.$_addRule({name:"max",method:"length",args:{limit:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"length",args:{limit:e},operator:">="})}},nand:{method(...e){return re.verifyFlat(e,"nand"),_.dependency(this,"nand",null,e)}},or:{method(...e){return re.verifyFlat(e,"or"),_.dependency(this,"or",null,e)}},oxor:{method(...e){return _.dependency(this,"oxor",null,e)}},pattern:{method(e,t,r={}){let s=e instanceof RegExp;s||(e=this.$_compile(e,{appendPath:!0})),Re(t!==void 0,"Invalid rule"),re.assertOptions(r,["fallthrough","matches"]),s&&Re(!e.flags.includes("g")&&!e.flags.includes("y"),"pattern should not use global or sticky mode"),t=this.$_compile(t,{appendPath:!0});let n=this.clone();n.$_terms.patterns=n.$_terms.patterns||[];let i={[s?"regex":"schema"]:e,rule:t};return r.matches&&(i.matches=this.$_compile(r.matches),i.matches.type!=="array"&&(i.matches=i.matches.$_root.array().items(i.matches)),n.$_mutateRegister(i.matches),n.$_setFlag("_hasPatternMatch",!0,{clone:!1})),r.fallthrough&&(i.fallthrough=!0),n.$_terms.patterns.push(i),n.$_mutateRegister(t),n}},ref:{method(){return this.$_addRule("ref")},validate(e,t){return jl.isRef(e)?e:t.error("object.refType",{value:e})}},regex:{method(){return this.$_addRule("regex")},validate(e,t){return e instanceof RegExp?e:t.error("object.regex",{value:e})}},rename:{method(e,t,r={}){Re(typeof e=="string"||e instanceof RegExp,"Rename missing the from argument"),Re(typeof t=="string"||t instanceof Wr,"Invalid rename to argument"),Re(t!==e,"Cannot rename key to same name:",e),re.assertOptions(r,["alias","ignoreUndefined","override","multiple"]);let s=this.clone();s.$_terms.renames=s.$_terms.renames||[];for(let n of s.$_terms.renames)Re(n.from!==e,"Cannot rename the same key multiple times");return t instanceof Wr&&s.$_mutateRegister(t),s.$_terms.renames.push({from:e,to:t,options:Cp(_.renameDefaults,r)}),s}},schema:{method(e="any"){return this.$_addRule({name:"schema",args:{type:e}})},validate(e,t,{type:r}){return re.isSchema(e)&&(r==="any"||e.type===r)?e:t.error("object.schema",{type:r})}},unknown:{method(e){return this.$_setFlag("unknown",e!==!1)}},with:{method(e,t,r={}){return _.dependency(this,"with",e,t,r)}},without:{method(e,t,r={}){return _.dependency(this,"without",e,t,r)}},xor:{method(...e){return re.verifyFlat(e,"xor"),_.dependency(this,"xor",null,e)}}},overrides:{default(e,t){return e===void 0&&(e=re.symbols.deepDefault),this.$_parent("default",e,t)}},rebuild(e){if(e.$_terms.keys){let t=new kp.Sorter;for(let r of e.$_terms.keys)re.tryWithPath(()=>t.add(r,{after:r.schema.$_rootReferences(),group:r.key}),r.key);e.$_terms.keys=new _.Keys(...t.nodes)}},manifest:{build(e,t){if(t.keys&&(e=e.keys(t.keys)),t.dependencies)for(let{rel:r,key:s=null,peers:n,options:i}of t.dependencies)e=_.dependency(e,r,s,n,i);if(t.patterns)for(let{regex:r,schema:s,rule:n,fallthrough:i,matches:o}of t.patterns)e=e.pattern(r||s,n,{fallthrough:i,matches:o});if(t.renames)for(let{from:r,to:s,options:n}of t.renames)e=e.rename(r,s,n);return e}},messages:{"object.and":"{{#label}} contains {{#presentWithLabels}} without its required peers {{#missingWithLabels}}","object.assert":'{{#label}} is invalid because {if(#subject.key, `"` + #subject.key + `" failed to ` + (#message || "pass the assertion test"), #message || "the assertion failed")}',"object.base":"{{#label}} must be of type {{#type}}","object.instance":"{{#label}} must be an instance of {{:#type}}","object.length":'{{#label}} must have {{#limit}} key{if(#limit == 1, "", "s")}',"object.max":'{{#label}} must have less than or equal to {{#limit}} key{if(#limit == 1, "", "s")}',"object.min":'{{#label}} must have at least {{#limit}} key{if(#limit == 1, "", "s")}',"object.missing":"{{#label}} must contain at least one of {{#peersWithLabels}}","object.nand":"{{:#mainWithLabel}} must not exist simultaneously with {{#peersWithLabels}}","object.oxor":"{{#label}} contains a conflict between optional exclusive peers {{#peersWithLabels}}","object.pattern.match":"{{#label}} keys failed to match pattern requirements","object.refType":"{{#label}} must be a Joi reference","object.regex":"{{#label}} must be a RegExp object","object.rename.multiple":"{{#label}} cannot rename {{:#from}} because multiple renames are disabled and another key was already renamed to {{:#to}}","object.rename.override":"{{#label}} cannot rename {{:#from}} because override is disabled and target {{:#to}} exists","object.schema":"{{#label}} must be a Joi schema of {{#type}} type","object.unknown":"{{#label}} is not allowed","object.with":"{{:#mainWithLabel}} missing required peer {{:#peerWithLabel}}","object.without":"{{:#mainWithLabel}} conflict with forbidden peer {{:#peerWithLabel}}","object.xor":"{{#label}} contains a conflict between exclusive peers {{#peersWithLabels}}"}});_.clone=function(e,t){if(typeof e=="object"){if(t.nonEnumerables)return ql(e,{shallow:!0});let s=Object.create(Object.getPrototypeOf(e));return Object.assign(s,e),s}let r=function(...s){return e.apply(this,s)};return r.prototype=ql(e.prototype),Object.defineProperty(r,"name",{value:e.name,writable:!1}),Object.defineProperty(r,"length",{value:e.length,writable:!1}),Object.assign(r,e),r};_.dependency=function(e,t,r,s,n){Re(r===null||typeof r=="string",t,"key must be a strings"),n||(n=s.length>1&&typeof s[s.length-1]=="object"?s.pop():{}),re.assertOptions(n,["separator","isPresent"]),s=[].concat(s);let i=re.default(n.separator,"."),o=[];for(let l of s)Re(typeof l=="string",t,"peers must be strings"),o.push(Kn.ref(l,{separator:i,ancestor:0,prefix:!1}));r!==null&&(r=Kn.ref(r,{separator:i,ancestor:0,prefix:!1}));let a=e.clone();return a.$_terms.dependencies=a.$_terms.dependencies||[],a.$_terms.dependencies.push(new _.Dependency(t,r,o,s,n)),a};_.dependencies={and(e,t,r,s,n){let i=[],o=[],a=t.peers.length,l=_.isPresent(t.options);for(let c of t.peers)l(c.resolve(r,s,n,null,{shadow:!1}))===!1?i.push(c.key):o.push(c.key);if(i.length!==a&&o.length!==a)return{code:"object.and",context:{present:o,presentWithLabels:_.keysToLabels(e,o),missing:i,missingWithLabels:_.keysToLabels(e,i)}}},nand(e,t,r,s,n){let i=[],o=_.isPresent(t.options);for(let c of t.peers)o(c.resolve(r,s,n,null,{shadow:!1}))&&i.push(c.key);if(i.length!==t.peers.length)return;let a=t.paths[0],l=t.paths.slice(1);return{code:"object.nand",context:{main:a,mainWithLabel:_.keysToLabels(e,a),peers:l,peersWithLabels:_.keysToLabels(e,l)}}},or(e,t,r,s,n){let i=_.isPresent(t.options);for(let o of t.peers)if(i(o.resolve(r,s,n,null,{shadow:!1})))return;return{code:"object.missing",context:{peers:t.paths,peersWithLabels:_.keysToLabels(e,t.paths)}}},oxor(e,t,r,s,n){let i=[],o=_.isPresent(t.options);for(let l of t.peers)o(l.resolve(r,s,n,null,{shadow:!1}))&&i.push(l.key);if(!i.length||i.length===1)return;let a={peers:t.paths,peersWithLabels:_.keysToLabels(e,t.paths)};return a.present=i,a.presentWithLabels=_.keysToLabels(e,i),{code:"object.oxor",context:a}},with(e,t,r,s,n){let i=_.isPresent(t.options);for(let o of t.peers)if(i(o.resolve(r,s,n,null,{shadow:!1}))===!1)return{code:"object.with",context:{main:t.key.key,mainWithLabel:_.keysToLabels(e,t.key.key),peer:o.key,peerWithLabel:_.keysToLabels(e,o.key)}}},without(e,t,r,s,n){let i=_.isPresent(t.options);for(let o of t.peers)if(i(o.resolve(r,s,n,null,{shadow:!1})))return{code:"object.without",context:{main:t.key.key,mainWithLabel:_.keysToLabels(e,t.key.key),peer:o.key,peerWithLabel:_.keysToLabels(e,o.key)}}},xor(e,t,r,s,n){let i=[],o=_.isPresent(t.options);for(let l of t.peers)o(l.resolve(r,s,n,null,{shadow:!1}))&&i.push(l.key);if(i.length===1)return;let a={peers:t.paths,peersWithLabels:_.keysToLabels(e,t.paths)};return i.length===0?{code:"object.missing",context:a}:(a.present=i,a.presentWithLabels=_.keysToLabels(e,i),{code:"object.xor",context:a})}};_.keysToLabels=function(e,t){return Array.isArray(t)?t.map(r=>e.$_mapLabels(r)):e.$_mapLabels(t)};_.isPresent=function(e){return typeof e.isPresent=="function"?e.isPresent:t=>t!==void 0};_.rename=function(e,t,r,s,n){let i={};for(let o of e.$_terms.renames){let a=[],l=typeof o.from!="string";if(!l)Object.prototype.hasOwnProperty.call(t,o.from)&&(t[o.from]!==void 0||!o.options.ignoreUndefined)&&a.push(o);else for(let c in t){if(t[c]===void 0&&o.options.ignoreUndefined||c===o.to)continue;let f=o.from.exec(c);f&&a.push({from:c,to:o.to,match:f})}for(let c of a){let f=c.from,u=c.to;if(u instanceof Wr&&(u=u.render(t,r,s,c.match)),f!==u){if(!o.options.multiple&&i[u]&&(n.push(e.$_createError("object.rename.multiple",t,{from:f,to:u,pattern:l},r,s)),s.abortEarly)||Object.prototype.hasOwnProperty.call(t,u)&&!o.options.override&&!i[u]&&(n.push(e.$_createError("object.rename.override",t,{from:f,to:u,pattern:l},r,s)),s.abortEarly))return!1;t[f]===void 0?delete t[u]:t[u]=t[f],i[u]=!0,o.options.alias||delete t[f]}}}return!0};_.unknown=function(e,t,r,s,n,i){if(e.$_terms.patterns){let a=!1,l=e.$_terms.patterns.map(f=>{if(f.matches)return a=!0,[]}),c=[t,...n.ancestors];for(let f of r){let u=t[f],d=[...n.path,f];for(let p=0;p<e.$_terms.patterns.length;++p){let m=e.$_terms.patterns[p];if(m.regex){let A=m.regex.test(f);if(n.mainstay.tracer.debug(n,"rule",`pattern.${p}`,A?"pass":"error"),!A)continue}else if(!m.schema.$_match(f,n.nest(m.schema,`pattern.${p}`),i))continue;r.delete(f);let g=n.localize(d,c,{schema:m.rule,key:f}),S=m.rule.$_validate(u,g,i);if(S.errors){if(i.abortEarly)return{value:t,errors:S.errors};s.push(...S.errors)}if(m.matches&&l[p].push(f),t[f]=S.value,!m.fallthrough)break}}if(a)for(let f=0;f<l.length;++f){let u=l[f];if(!u)continue;let d=e.$_terms.patterns[f].matches,p=n.localize(n.path,c,d),m=d.$_validate(u,p,i);if(m.errors){let g=Op.details(m.errors,{override:!1});g.matches=u;let S=e.$_createError("object.pattern.match",t,g,n,i);if(i.abortEarly)return{value:t,errors:S};s.push(S)}}}if(!r.size||!e.$_terms.keys&&!e.$_terms.patterns)return;if(i.stripUnknown&&!e._flags.unknown||i.skipFunctions){let a=i.stripUnknown?i.stripUnknown===!0?!0:!!i.stripUnknown.objects:!1;for(let l of r)a?(delete t[l],r.delete(l)):typeof t[l]=="function"&&r.delete(l)}if(!re.default(e._flags.unknown,i.allowUnknown))for(let a of r){let l=n.localize([...n.path,a],[]),c=e.$_createError("object.unknown",t[a],{child:a},l,i,{flags:!1});if(i.abortEarly)return{value:t,errors:c};s.push(c)}};_.Dependency=class{constructor(e,t,r,s,n){this.rel=e,this.key=t,this.peers=r,this.paths=s,this.options=n}describe(){let e={rel:this.rel,peers:this.paths};return this.key!==null&&(e.key=this.key.key),this.peers[0].separator!=="."&&(e.options={...e.options,separator:this.peers[0].separator}),this.options.isPresent&&(e.options={...e.options,isPresent:this.options.isPresent}),e}};_.Keys=class extends Array{concat(e){let t=this.slice(),r=new Map;for(let s=0;s<t.length;++s)r.set(t[s].key,s);for(let s of e){let n=s.key,i=r.get(n);i!==void 0?t[i]={key:n,schema:t[i].schema.concat(s.schema)}:t.push(s)}return t}}});var Gl=y((ng,Ul)=>{"use strict";var Qn=R(),vp=Vn();Ul.exports=vp.extend({type:"function",properties:{typeof:"function"},rules:{arity:{method(e){return Qn(Number.isSafeInteger(e)&&e>=0,"n must be a positive integer"),this.$_addRule({name:"arity",args:{n:e}})},validate(e,t,{n:r}){return e.length===r?e:t.error("function.arity",{n:r})}},class:{method(){return this.$_addRule("class")},validate(e,t){return/^\s*class\s/.test(e.toString())?e:t.error("function.class",{value:e})}},minArity:{method(e){return Qn(Number.isSafeInteger(e)&&e>0,"n must be a strict positive integer"),this.$_addRule({name:"minArity",args:{n:e}})},validate(e,t,{n:r}){return e.length>=r?e:t.error("function.minArity",{n:r})}},maxArity:{method(e){return Qn(Number.isSafeInteger(e)&&e>=0,"n must be a positive integer"),this.$_addRule({name:"maxArity",args:{n:e}})},validate(e,t,{n:r}){return e.length<=r?e:t.error("function.maxArity",{n:r})}}},messages:{"function.arity":"{{#label}} must have an arity of {{#n}}","function.class":"{{#label}} must be a class","function.maxArity":"{{#label}} must have an arity lesser or equal to {{#n}}","function.minArity":"{{#label}} must have an arity greater or equal to {{#n}}"}})});var zl=y((ig,Hl)=>{"use strict";var Ye=R(),xp=Ce(),Ip=M(),Tp=Et(),Np=ze(),We={};Hl.exports=xp.extend({type:"link",properties:{schemaChain:!0},terms:{link:{init:null,manifest:"single",register:!1}},args(e,t){return e.ref(t)},validate(e,{schema:t,state:r,prefs:s}){Ye(t.$_terms.link,"Uninitialized link schema");let n=We.generate(t,e,r,s),i=t.$_terms.link[0].ref;return n.$_validate(e,r.nest(n,`link:${i.display}:${n.type}`),s)},generate(e,t,r,s){return We.generate(e,t,r,s)},rules:{ref:{method(e){Ye(!this.$_terms.link,"Cannot reinitialize schema"),e=Tp.ref(e),Ye(e.type==="value"||e.type==="local","Invalid reference type:",e.type),Ye(e.type==="local"||e.ancestor==="root"||e.ancestor>0,"Link cannot reference itself");let t=this.clone();return t.$_terms.link=[{ref:e}],t}},relative:{method(e=!0){return this.$_setFlag("relative",e)}}},overrides:{concat(e){Ye(this.$_terms.link,"Uninitialized link schema"),Ye(Ip.isSchema(e),"Invalid schema object"),Ye(e.type!=="link","Cannot merge type link with another link");let t=this.clone();return t.$_terms.whens||(t.$_terms.whens=[]),t.$_terms.whens.push({concat:e}),t.$_mutateRebuild()}},manifest:{build(e,t){return Ye(t.link,"Invalid link description missing link"),e.ref(t.link)}}});We.generate=function(e,t,r,s){let n=r.mainstay.links.get(e);if(n)return n._generate(t,r,s).schema;let i=e.$_terms.link[0].ref,{perspective:o,path:a}=We.perspective(i,r);We.assert(o,"which is outside of schema boundaries",i,e,r,s);try{n=a.length?o.$_reach(a):o}catch{We.assert(!1,"to non-existing schema",i,e,r,s)}return We.assert(n.type!=="link","which is another link",i,e,r,s),e._flags.relative||r.mainstay.links.set(e,n),n._generate(t,r,s).schema};We.perspective=function(e,t){if(e.type==="local"){for(let{schema:r,key:s}of t.schemas){if((r._flags.id||s)===e.path[0])return{perspective:r,path:e.path.slice(1)};if(r.$_terms.shared){for(let i of r.$_terms.shared)if(i._flags.id===e.path[0])return{perspective:i,path:e.path.slice(1)}}}return{perspective:null,path:null}}return e.ancestor==="root"?{perspective:t.schemas[t.schemas.length-1].schema,path:e.path}:{perspective:t.schemas[e.ancestor]&&t.schemas[e.ancestor].schema,path:e.path}};We.assert=function(e,t,r,s,n,i){e||Ye(!1,`"${Np.label(s._flags,n,i)}" contains link reference "${r.display}" ${t}`)}});var Kl=y((og,Xl)=>{"use strict";var Yn=R(),Mp=Ce(),Wn=M(),xe={numberRx:/^\s*[+-]?(?:(?:\d+(?:\.\d*)?)|(?:\.\d+))(?:e([+-]?\d+))?\s*$/i,precisionRx:/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/,exponentialPartRegex:/[eE][+-]?\d+$/,leadingSignAndZerosRegex:/^[+-]?(0*)?/,dotRegex:/\./,trailingZerosRegex:/0+$/};Xl.exports=Mp.extend({type:"number",flags:{unsafe:{default:!1}},coerce:{from:"string",method(e,{schema:t,error:r}){if(!e.match(xe.numberRx))return;e=e.trim();let n={value:parseFloat(e)};if(n.value===0&&(n.value=0),!t._flags.unsafe)if(e.match(/e/i)){if(xe.extractSignificantDigits(e)!==xe.extractSignificantDigits(String(n.value)))return n.errors=r("number.unsafe"),n}else{let i=n.value.toString();if(i.match(/e/i))return n;if(i!==xe.normalizeDecimal(e))return n.errors=r("number.unsafe"),n}return n}},validate(e,{schema:t,error:r,prefs:s}){if(e===1/0||e===-1/0)return{value:e,errors:r("number.infinity")};if(!Wn.isNumber(e))return{value:e,errors:r("number.base")};let n={value:e};if(s.convert){let i=t.$_getRule("precision");if(i){let o=Math.pow(10,i.args.limit);n.value=Math.round(n.value*o)/o}}return n.value===0&&(n.value=0),!t._flags.unsafe&&(e>Number.MAX_SAFE_INTEGER||e<Number.MIN_SAFE_INTEGER)&&(n.errors=r("number.unsafe")),n},rules:{compare:{method:!1,validate(e,t,{limit:r},{name:s,operator:n,args:i}){return Wn.compare(e,r,n)?e:t.error("number."+s,{limit:i.limit,value:e})},args:[{name:"limit",ref:!0,assert:Wn.isNumber,message:"must be a number"}]},greater:{method(e){return this.$_addRule({name:"greater",method:"compare",args:{limit:e},operator:">"})}},integer:{method(){return this.$_addRule("integer")},validate(e,t){return Math.trunc(e)-e===0?e:t.error("number.integer")}},less:{method(e){return this.$_addRule({name:"less",method:"compare",args:{limit:e},operator:"<"})}},max:{method(e){return this.$_addRule({name:"max",method:"compare",args:{limit:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"compare",args:{limit:e},operator:">="})}},multiple:{method(e){return this.$_addRule({name:"multiple",args:{base:e}})},validate(e,t,{base:r},s){return e*(1/r)%1===0?e:t.error("number.multiple",{multiple:s.args.base,value:e})},args:[{name:"base",ref:!0,assert:e=>typeof e=="number"&&isFinite(e)&&e>0,message:"must be a positive number"}],multi:!0},negative:{method(){return this.sign("negative")}},port:{method(){return this.$_addRule("port")},validate(e,t){return Number.isSafeInteger(e)&&e>=0&&e<=65535?e:t.error("number.port")}},positive:{method(){return this.sign("positive")}},precision:{method(e){return Yn(Number.isSafeInteger(e),"limit must be an integer"),this.$_addRule({name:"precision",args:{limit:e}})},validate(e,t,{limit:r}){let s=e.toString().match(xe.precisionRx);return Math.max((s[1]?s[1].length:0)-(s[2]?parseInt(s[2],10):0),0)<=r?e:t.error("number.precision",{limit:r,value:e})},convert:!0},sign:{method(e){return Yn(["negative","positive"].includes(e),"Invalid sign",e),this.$_addRule({name:"sign",args:{sign:e}})},validate(e,t,{sign:r}){return r==="negative"&&e<0||r==="positive"&&e>0?e:t.error(`number.${r}`)}},unsafe:{method(e=!0){return Yn(typeof e=="boolean","enabled must be a boolean"),this.$_setFlag("unsafe",e)}}},cast:{string:{from:e=>typeof e=="number",to(e,t){return e.toString()}}},messages:{"number.base":"{{#label}} must be a number","number.greater":"{{#label}} must be greater than {{#limit}}","number.infinity":"{{#label}} cannot be infinity","number.integer":"{{#label}} must be an integer","number.less":"{{#label}} must be less than {{#limit}}","number.max":"{{#label}} must be less than or equal to {{#limit}}","number.min":"{{#label}} must be greater than or equal to {{#limit}}","number.multiple":"{{#label}} must be a multiple of {{#multiple}}","number.negative":"{{#label}} must be a negative number","number.port":"{{#label}} must be a valid port","number.positive":"{{#label}} must be a positive number","number.precision":"{{#label}} must have no more than {{#limit}} decimal places","number.unsafe":"{{#label}} must be a safe number"}});xe.extractSignificantDigits=function(e){return e.replace(xe.exponentialPartRegex,"").replace(xe.dotRegex,"").replace(xe.trailingZerosRegex,"").replace(xe.leadingSignAndZerosRegex,"")};xe.normalizeDecimal=function(e){return e=e.replace(/^\+/,"").replace(/\.0*$/,"").replace(/^(-?)\.([^\.]*)$/,"$10.$2").replace(/^(-?)0+([0-9])/,"$1$2"),e.includes(".")&&e.endsWith("0")&&(e=e.replace(/0+$/,"")),e==="-0"?"0":e}});var Ql=y((ag,Vl)=>{"use strict";var Dp=Vn();Vl.exports=Dp.extend({type:"object",cast:{map:{from:e=>e&&typeof e=="object",to(e,t){return new Map(Object.entries(e))}}}})});var Jn=y(Jr=>{"use strict";Jr.codes={EMPTY_STRING:"Address must be a non-empty string",FORBIDDEN_UNICODE:"Address contains forbidden Unicode characters",MULTIPLE_AT_CHAR:"Address cannot contain more than one @ character",MISSING_AT_CHAR:"Address must contain one @ character",EMPTY_LOCAL:"Address local part cannot be empty",ADDRESS_TOO_LONG:"Address too long",LOCAL_TOO_LONG:"Address local part too long",EMPTY_LOCAL_SEGMENT:"Address local part contains empty dot-separated segment",INVALID_LOCAL_CHARS:"Address local part contains invalid character",DOMAIN_NON_EMPTY_STRING:"Domain must be a non-empty string",DOMAIN_TOO_LONG:"Domain too long",DOMAIN_INVALID_UNICODE_CHARS:"Domain contains forbidden Unicode characters",DOMAIN_INVALID_CHARS:"Domain contains invalid character",DOMAIN_INVALID_TLDS_CHARS:"Domain contains invalid tld character",DOMAIN_SEGMENTS_COUNT:"Domain lacks the minimum required number of segments",DOMAIN_SEGMENTS_COUNT_MAX:"Domain contains too many segments",DOMAIN_FORBIDDEN_TLDS:"Domain uses forbidden TLD",DOMAIN_EMPTY_SEGMENT:"Domain contains empty dot-separated segment",DOMAIN_LONG_SEGMENT:"Domain contains dot-separated segment that is too long"};Jr.code=function(e){return{code:e,error:Jr.codes[e]}}});var Zn=y(Zr=>{"use strict";var Bp=require("url"),Ie=Jn(),ht={minDomainSegments:2,nonAsciiRx:/[^\x00-\x7f]/,domainControlRx:/[\x00-\x20@\:\/\\#!\$&\'\(\)\*\+,;=\?]/,tldSegmentRx:/^[a-zA-Z](?:[a-zA-Z0-9\-]*[a-zA-Z0-9])?$/,domainSegmentRx:/^[a-zA-Z0-9](?:[a-zA-Z0-9\-]*[a-zA-Z0-9])?$/,URL:Bp.URL||URL};Zr.analyze=function(e,t={}){if(!e)return Ie.code("DOMAIN_NON_EMPTY_STRING");if(typeof e!="string")throw new Error("Invalid input: domain must be a string");if(e.length>256)return Ie.code("DOMAIN_TOO_LONG");if(!!ht.nonAsciiRx.test(e)){if(t.allowUnicode===!1)return Ie.code("DOMAIN_INVALID_UNICODE_CHARS");e=e.normalize("NFC")}if(ht.domainControlRx.test(e))return Ie.code("DOMAIN_INVALID_CHARS");e=ht.punycode(e),t.allowFullyQualified&&e[e.length-1]==="."&&(e=e.slice(0,-1));let s=t.minDomainSegments||ht.minDomainSegments,n=e.split(".");if(n.length<s)return Ie.code("DOMAIN_SEGMENTS_COUNT");if(t.maxDomainSegments&&n.length>t.maxDomainSegments)return Ie.code("DOMAIN_SEGMENTS_COUNT_MAX");let i=t.tlds;if(i){let o=n[n.length-1].toLowerCase();if(i.deny&&i.deny.has(o)||i.allow&&!i.allow.has(o))return Ie.code("DOMAIN_FORBIDDEN_TLDS")}for(let o=0;o<n.length;++o){let a=n[o];if(!a.length)return Ie.code("DOMAIN_EMPTY_SEGMENT");if(a.length>63)return Ie.code("DOMAIN_LONG_SEGMENT");if(o<n.length-1){if(!ht.domainSegmentRx.test(a))return Ie.code("DOMAIN_INVALID_CHARS")}else if(!ht.tldSegmentRx.test(a))return Ie.code("DOMAIN_INVALID_TLDS_CHARS")}return null};Zr.isValid=function(e,t){return!Zr.analyze(e,t)};ht.punycode=function(e){e.includes("%")&&(e=e.replace(/%/g,"%25"));try{return new ht.URL(`http://${e}`).host}catch{return e}}});var Yl=y(ei=>{"use strict";var Lp=require("util"),Pp=Zn(),$e=Jn(),le={nonAsciiRx:/[^\x00-\x7f]/,encoder:new(Lp.TextEncoder||TextEncoder)};ei.analyze=function(e,t){return le.email(e,t)};ei.isValid=function(e,t){return!le.email(e,t)};le.email=function(e,t={}){if(typeof e!="string")throw new Error("Invalid input: email must be a string");if(!e)return $e.code("EMPTY_STRING");let r=!le.nonAsciiRx.test(e);if(!r){if(t.allowUnicode===!1)return $e.code("FORBIDDEN_UNICODE");e=e.normalize("NFC")}let s=e.split("@");if(s.length!==2)return s.length>2?$e.code("MULTIPLE_AT_CHAR"):$e.code("MISSING_AT_CHAR");let[n,i]=s;if(!n)return $e.code("EMPTY_LOCAL");if(!t.ignoreLength){if(e.length>254)return $e.code("ADDRESS_TOO_LONG");if(le.encoder.encode(n).length>64)return $e.code("LOCAL_TOO_LONG")}return le.local(n,r)||Pp.analyze(i,t)};le.local=function(e,t){let r=e.split(".");for(let s of r){if(!s.length)return $e.code("EMPTY_LOCAL_SEGMENT");if(t){if(!le.atextRx.test(s))return $e.code("INVALID_LOCAL_CHARS");continue}for(let n of s){if(le.atextRx.test(n))continue;let i=le.binary(n);if(!le.atomRx.test(i))return $e.code("INVALID_LOCAL_CHARS")}}};le.binary=function(e){return Array.from(le.encoder.encode(e)).map(t=>String.fromCharCode(t)).join("")};le.atextRx=/^[\w!#\$%&'\*\+\-/=\?\^`\{\|\}~]+$/;le.atomRx=new RegExp(["(?:[\\xc2-\\xdf][\\x80-\\xbf])","(?:\\xe0[\\xa0-\\xbf][\\x80-\\xbf])|(?:[\\xe1-\\xec][\\x80-\\xbf]{2})|(?:\\xed[\\x80-\\x9f][\\x80-\\xbf])|(?:[\\xee-\\xef][\\x80-\\xbf]{2})","(?:\\xf0[\\x90-\\xbf][\\x80-\\xbf]{2})|(?:[\\xf1-\\xf3][\\x80-\\xbf]{3})|(?:\\xf4[\\x80-\\x8f][\\x80-\\xbf]{2})"].join("|"))});var Jl=y((fg,Wl)=>{"use strict";Wl.exports=function(...e){try{return JSON.stringify(...e)}catch(t){return"[Cannot display object: "+t.message+"]"}}});var tc=y((Zl,ec)=>{"use strict";var $p=Jl();ec.exports=class extends Error{constructor(e){let t=e.filter(r=>r!=="").map(r=>typeof r=="string"?r:r instanceof Error?r.message:$p(r));super(t.join(" ")||"Unknown error"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Zl.assert)}}});var ti=y((hg,rc)=>{"use strict";var qp=tc();rc.exports=function(e,...t){if(!e)throw t.length===1&&t[0]instanceof Error?t[0]:new qp(t)}});var nc=y((pg,sc)=>{"use strict";sc.exports=function(e){return e.replace(/[\^\$\.\*\+\-\?\=\!\:\|\\\/\(\)\[\]\{\}\,]/g,"\\$&")}});var si=y(ri=>{"use strict";var es=ti(),jp=nc(),Y={};Y.generate=function(){let e={},t="\\dA-Fa-f",r="["+t+"]",s="\\w-\\.~",n="!\\$&'\\(\\)\\*\\+,;=",i="%"+t,o=s+i+n+":@",a="["+o+"]",l="(?:0{0,2}\\d|0?[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])";e.ipv4address="(?:"+l+"\\.){3}"+l;let c=r+"{1,4}",f="(?:"+c+":"+c+"|"+e.ipv4address+")",u="(?:"+c+":){6}"+f,d="::(?:"+c+":){5}"+f,p="(?:"+c+")?::(?:"+c+":){4}"+f,m="(?:(?:"+c+":){0,1}"+c+")?::(?:"+c+":){3}"+f,g="(?:(?:"+c+":){0,2}"+c+")?::(?:"+c+":){2}"+f,S="(?:(?:"+c+":){0,3}"+c+")?::"+c+":"+f,A="(?:(?:"+c+":){0,4}"+c+")?::"+f,v="(?:(?:"+c+":){0,5}"+c+")?::"+c,z="(?:(?:"+c+":){0,6}"+c+")?::";e.ipv4Cidr="(?:\\d|[1-2]\\d|3[0-2])",e.ipv6Cidr="(?:0{0,2}\\d|0?[1-9]\\d|1[01]\\d|12[0-8])",e.ipv6address="(?:"+u+"|"+d+"|"+p+"|"+m+"|"+g+"|"+S+"|"+A+"|"+v+"|"+z+")",e.ipvFuture="v"+r+"+\\.["+s+n+":]+",e.scheme="[a-zA-Z][a-zA-Z\\d+-\\.]*",e.schemeRegex=new RegExp(e.scheme);let X="["+s+i+n+":]*",Xt="\\[(?:"+e.ipv6address+"|"+e.ipvFuture+")\\]",N="["+s+i+n+"]{1,255}",j="(?:"+Xt+"|"+e.ipv4address+"|"+N+")",ue="\\d*",qe="(?:"+X+"@)?"+j+"(?::"+ue+")?",li="(?:"+X+"@)?("+j+")(?::"+ue+")?",ci=a+"*",ui=a+"+",Dc="["+s+i+n+"@]+",fi="",Je="(?:\\/"+ci+")*",dr="\\/(?:"+ui+Je+")?",di=ui+Je,hi=Dc+Je,Bc="(?:\\/\\/\\/"+ci+Je+")";return e.hierPart="(?:(?:\\/\\/"+qe+Je+")|"+dr+"|"+di+"|"+Bc+")",e.hierPartCapture="(?:(?:\\/\\/"+li+Je+")|"+dr+"|"+di+")",e.relativeRef="(?:(?:\\/\\/"+qe+Je+")|"+dr+"|"+hi+"|"+fi+")",e.relativeRefCapture="(?:(?:\\/\\/"+li+Je+")|"+dr+"|"+hi+"|"+fi+")",e.query="["+o+"\\/\\?]*(?=#|$)",e.queryWithSquareBrackets="["+o+"\\[\\]\\/\\?]*(?=#|$)",e.fragment="["+o+"\\/\\?]*",e};Y.rfc3986=Y.generate();ri.ip={v4Cidr:Y.rfc3986.ipv4Cidr,v6Cidr:Y.rfc3986.ipv6Cidr,ipv4:Y.rfc3986.ipv4address,ipv6:Y.rfc3986.ipv6address,ipvfuture:Y.rfc3986.ipvFuture};Y.createRegex=function(e){let t=Y.rfc3986,s="(?:\\?"+(e.allowQuerySquareBrackets?t.queryWithSquareBrackets:t.query)+")?(?:#"+t.fragment+")?",n=e.domain?t.relativeRefCapture:t.relativeRef;if(e.relativeOnly)return Y.wrap(n+s);let i="";if(e.scheme){es(e.scheme instanceof RegExp||typeof e.scheme=="string"||Array.isArray(e.scheme),"scheme must be a RegExp, String, or Array");let c=[].concat(e.scheme);es(c.length>=1,"scheme must have at least 1 scheme specified");let f=[];for(let u=0;u<c.length;++u){let d=c[u];es(d instanceof RegExp||typeof d=="string","scheme at position "+u+" must be a RegExp or String"),d instanceof RegExp?f.push(d.source.toString()):(es(t.schemeRegex.test(d),"scheme at position "+u+" must be a valid scheme"),f.push(jp(d)))}i=f.join("|")}let a="(?:"+(i?"(?:"+i+")":t.scheme)+":"+(e.domain?t.hierPartCapture:t.hierPart)+")",l=e.allowRelative?"(?:"+a+"|"+n+")":a;return Y.wrap(l+s,i)};Y.wrap=function(e,t){return e=`(?=.)(?!https?:/(?:$|[^/]))(?!https?:///)(?!https?:[^/])${e}`,{raw:e,regex:new RegExp(`^${e}$`),scheme:t}};Y.uriRegex=Y.createRegex({});ri.regex=function(e={}){return e.scheme||e.allowRelative||e.relativeOnly||e.allowQuerySquareBrackets||e.domain?Y.createRegex(e):Y.uriRegex}});var oc=y(ic=>{"use strict";var Ht=ti(),cr=si();ic.regex=function(e={}){Ht(e.cidr===void 0||typeof e.cidr=="string","options.cidr must be a string");let t=e.cidr?e.cidr.toLowerCase():"optional";Ht(["required","optional","forbidden"].includes(t),"options.cidr must be one of required, optional, forbidden"),Ht(e.version===void 0||typeof e.version=="string"||Array.isArray(e.version),"options.version must be a string or an array of string");let r=e.version||["ipv4","ipv6","ipvfuture"];Array.isArray(r)||(r=[r]),Ht(r.length>=1,"options.version must have at least 1 version specified");for(let o=0;o<r.length;++o)Ht(typeof r[o]=="string","options.version must only contain strings"),r[o]=r[o].toLowerCase(),Ht(["ipv4","ipv6","ipvfuture"].includes(r[o]),"options.version contains unknown version "+r[o]+" - must be one of ipv4, ipv6, ipvfuture");r=Array.from(new Set(r));let n=`(?:${r.map(o=>{if(t==="forbidden")return cr.ip[o];let a=`\\/${o==="ipv4"?cr.ip.v4Cidr:cr.ip.v6Cidr}`;return t==="required"?`${cr.ip[o]}${a}`:`${cr.ip[o]}(?:${a})?`}).join("|")})`,i=new RegExp(`^${n}$`);return{cidr:t,versions:r,regex:i,raw:n}}});var lc=y((gg,ac)=>{"use strict";ac.exports=function(e){return e.replace(/[\^\$\.\*\+\-\?\=\!\:\|\\\/\(\)\[\]\{\}\,]/g,"\\$&")}});var fc=y((bg,uc)=>{"use strict";var cc={};cc.tlds=["AAA","AARP","ABARTH","ABB","ABBOTT","ABBVIE","ABC","ABLE","ABOGADO","ABUDHABI","AC","ACADEMY","ACCENTURE","ACCOUNTANT","ACCOUNTANTS","ACO","ACTOR","AD","ADAC","ADS","ADULT","AE","AEG","AERO","AETNA","AF","AFL","AFRICA","AG","AGAKHAN","AGENCY","AI","AIG","AIRBUS","AIRFORCE","AIRTEL","AKDN","AL","ALFAROMEO","ALIBABA","ALIPAY","ALLFINANZ","ALLSTATE","ALLY","ALSACE","ALSTOM","AM","AMAZON","AMERICANEXPRESS","AMERICANFAMILY","AMEX","AMFAM","AMICA","AMSTERDAM","ANALYTICS","ANDROID","ANQUAN","ANZ","AO","AOL","APARTMENTS","APP","APPLE","AQ","AQUARELLE","AR","ARAB","ARAMCO","ARCHI","ARMY","ARPA","ART","ARTE","AS","ASDA","ASIA","ASSOCIATES","AT","ATHLETA","ATTORNEY","AU","AUCTION","AUDI","AUDIBLE","AUDIO","AUSPOST","AUTHOR","AUTO","AUTOS","AVIANCA","AW","AWS","AX","AXA","AZ","AZURE","BA","BABY","BAIDU","BANAMEX","BANANAREPUBLIC","BAND","BANK","BAR","BARCELONA","BARCLAYCARD","BARCLAYS","BAREFOOT","BARGAINS","BASEBALL","BASKETBALL","BAUHAUS","BAYERN","BB","BBC","BBT","BBVA","BCG","BCN","BD","BE","BEATS","BEAUTY","BEER","BENTLEY","BERLIN","BEST","BESTBUY","BET","BF","BG","BH","BHARTI","BI","BIBLE","BID","BIKE","BING","BINGO","BIO","BIZ","BJ","BLACK","BLACKFRIDAY","BLOCKBUSTER","BLOG","BLOOMBERG","BLUE","BM","BMS","BMW","BN","BNPPARIBAS","BO","BOATS","BOEHRINGER","BOFA","BOM","BOND","BOO","BOOK","BOOKING","BOSCH","BOSTIK","BOSTON","BOT","BOUTIQUE","BOX","BR","BRADESCO","BRIDGESTONE","BROADWAY","BROKER","BROTHER","BRUSSELS","BS","BT","BUGATTI","BUILD","BUILDERS","BUSINESS","BUY","BUZZ","BV","BW","BY","BZ","BZH","CA","CAB","CAFE","CAL","CALL","CALVINKLEIN","CAM","CAMERA","CAMP","CANCERRESEARCH","CANON","CAPETOWN","CAPITAL","CAPITALONE","CAR","CARAVAN","CARDS","CARE","CAREER","CAREERS","CARS","CASA","CASE","CASH","CASINO","CAT","CATERING","CATHOLIC","CBA","CBN","CBRE","CBS","CC","CD","CENTER","CEO","CERN","CF","CFA","CFD","CG","CH","CHANEL","CHANNEL","CHARITY","CHASE","CHAT","CHEAP","CHINTAI","CHRISTMAS","CHROME","CHURCH","CI","CIPRIANI","CIRCLE","CISCO","CITADEL","CITI","CITIC","CITY","CITYEATS","CK","CL","CLAIMS","CLEANING","CLICK","CLINIC","CLINIQUE","CLOTHING","CLOUD","CLUB","CLUBMED","CM","CN","CO","COACH","CODES","COFFEE","COLLEGE","COLOGNE","COM","COMCAST","COMMBANK","COMMUNITY","COMPANY","COMPARE","COMPUTER","COMSEC","CONDOS","CONSTRUCTION","CONSULTING","CONTACT","CONTRACTORS","COOKING","COOKINGCHANNEL","COOL","COOP","CORSICA","COUNTRY","COUPON","COUPONS","COURSES","CPA","CR","CREDIT","CREDITCARD","CREDITUNION","CRICKET","CROWN","CRS","CRUISE","CRUISES","CU","CUISINELLA","CV","CW","CX","CY","CYMRU","CYOU","CZ","DABUR","DAD","DANCE","DATA","DATE","DATING","DATSUN","DAY","DCLK","DDS","DE","DEAL","DEALER","DEALS","DEGREE","DELIVERY","DELL","DELOITTE","DELTA","DEMOCRAT","DENTAL","DENTIST","DESI","DESIGN","DEV","DHL","DIAMONDS","DIET","DIGITAL","DIRECT","DIRECTORY","DISCOUNT","DISCOVER","DISH","DIY","DJ","DK","DM","DNP","DO","DOCS","DOCTOR","DOG","DOMAINS","DOT","DOWNLOAD","DRIVE","DTV","DUBAI","DUNLOP","DUPONT","DURBAN","DVAG","DVR","DZ","EARTH","EAT","EC","ECO","EDEKA","EDU","EDUCATION","EE","EG","EMAIL","EMERCK","ENERGY","ENGINEER","ENGINEERING","ENTERPRISES","EPSON","EQUIPMENT","ER","ERICSSON","ERNI","ES","ESQ","ESTATE","ET","ETISALAT","EU","EUROVISION","EUS","EVENTS","EXCHANGE","EXPERT","EXPOSED","EXPRESS","EXTRASPACE","FAGE","FAIL","FAIRWINDS","FAITH","FAMILY","FAN","FANS","FARM","FARMERS","FASHION","FAST","FEDEX","FEEDBACK","FERRARI","FERRERO","FI","FIAT","FIDELITY","FIDO","FILM","FINAL","FINANCE","FINANCIAL","FIRE","FIRESTONE","FIRMDALE","FISH","FISHING","FIT","FITNESS","FJ","FK","FLICKR","FLIGHTS","FLIR","FLORIST","FLOWERS","FLY","FM","FO","FOO","FOOD","FOODNETWORK","FOOTBALL","FORD","FOREX","FORSALE","FORUM","FOUNDATION","FOX","FR","FREE","FRESENIUS","FRL","FROGANS","FRONTDOOR","FRONTIER","FTR","FUJITSU","FUN","FUND","FURNITURE","FUTBOL","FYI","GA","GAL","GALLERY","GALLO","GALLUP","GAME","GAMES","GAP","GARDEN","GAY","GB","GBIZ","GD","GDN","GE","GEA","GENT","GENTING","GEORGE","GF","GG","GGEE","GH","GI","GIFT","GIFTS","GIVES","GIVING","GL","GLASS","GLE","GLOBAL","GLOBO","GM","GMAIL","GMBH","GMO","GMX","GN","GODADDY","GOLD","GOLDPOINT","GOLF","GOO","GOODYEAR","GOOG","GOOGLE","GOP","GOT","GOV","GP","GQ","GR","GRAINGER","GRAPHICS","GRATIS","GREEN","GRIPE","GROCERY","GROUP","GS","GT","GU","GUARDIAN","GUCCI","GUGE","GUIDE","GUITARS","GURU","GW","GY","HAIR","HAMBURG","HANGOUT","HAUS","HBO","HDFC","HDFCBANK","HEALTH","HEALTHCARE","HELP","HELSINKI","HERE","HERMES","HGTV","HIPHOP","HISAMITSU","HITACHI","HIV","HK","HKT","HM","HN","HOCKEY","HOLDINGS","HOLIDAY","HOMEDEPOT","HOMEGOODS","HOMES","HOMESENSE","HONDA","HORSE","HOSPITAL","HOST","HOSTING","HOT","HOTELES","HOTELS","HOTMAIL","HOUSE","HOW","HR","HSBC","HT","HU","HUGHES","HYATT","HYUNDAI","IBM","ICBC","ICE","ICU","ID","IE","IEEE","IFM","IKANO","IL","IM","IMAMAT","IMDB","IMMO","IMMOBILIEN","IN","INC","INDUSTRIES","INFINITI","INFO","ING","INK","INSTITUTE","INSURANCE","INSURE","INT","INTERNATIONAL","INTUIT","INVESTMENTS","IO","IPIRANGA","IQ","IR","IRISH","IS","ISMAILI","IST","ISTANBUL","IT","ITAU","ITV","JAGUAR","JAVA","JCB","JE","JEEP","JETZT","JEWELRY","JIO","JLL","JM","JMP","JNJ","JO","JOBS","JOBURG","JOT","JOY","JP","JPMORGAN","JPRS","JUEGOS","JUNIPER","KAUFEN","KDDI","KE","KERRYHOTELS","KERRYLOGISTICS","KERRYPROPERTIES","KFH","KG","KH","KI","KIA","KIM","KINDER","KINDLE","KITCHEN","KIWI","KM","KN","KOELN","KOMATSU","KOSHER","KP","KPMG","KPN","KR","KRD","KRED","KUOKGROUP","KW","KY","KYOTO","KZ","LA","LACAIXA","LAMBORGHINI","LAMER","LANCASTER","LANCIA","LAND","LANDROVER","LANXESS","LASALLE","LAT","LATINO","LATROBE","LAW","LAWYER","LB","LC","LDS","LEASE","LECLERC","LEFRAK","LEGAL","LEGO","LEXUS","LGBT","LI","LIDL","LIFE","LIFEINSURANCE","LIFESTYLE","LIGHTING","LIKE","LILLY","LIMITED","LIMO","LINCOLN","LINDE","LINK","LIPSY","LIVE","LIVING","LK","LLC","LLP","LOAN","LOANS","LOCKER","LOCUS","LOFT","LOL","LONDON","LOTTE","LOTTO","LOVE","LPL","LPLFINANCIAL","LR","LS","LT","LTD","LTDA","LU","LUNDBECK","LUXE","LUXURY","LV","LY","MA","MACYS","MADRID","MAIF","MAISON","MAKEUP","MAN","MANAGEMENT","MANGO","MAP","MARKET","MARKETING","MARKETS","MARRIOTT","MARSHALLS","MASERATI","MATTEL","MBA","MC","MCKINSEY","MD","ME","MED","MEDIA","MEET","MELBOURNE","MEME","MEMORIAL","MEN","MENU","MERCKMSD","MG","MH","MIAMI","MICROSOFT","MIL","MINI","MINT","MIT","MITSUBISHI","MK","ML","MLB","MLS","MM","MMA","MN","MO","MOBI","MOBILE","MODA","MOE","MOI","MOM","MONASH","MONEY","MONSTER","MORMON","MORTGAGE","MOSCOW","MOTO","MOTORCYCLES","MOV","MOVIE","MP","MQ","MR","MS","MSD","MT","MTN","MTR","MU","MUSEUM","MUSIC","MUTUAL","MV","MW","MX","MY","MZ","NA","NAB","NAGOYA","NAME","NATURA","NAVY","NBA","NC","NE","NEC","NET","NETBANK","NETFLIX","NETWORK","NEUSTAR","NEW","NEWS","NEXT","NEXTDIRECT","NEXUS","NF","NFL","NG","NGO","NHK","NI","NICO","NIKE","NIKON","NINJA","NISSAN","NISSAY","NL","NO","NOKIA","NORTHWESTERNMUTUAL","NORTON","NOW","NOWRUZ","NOWTV","NP","NR","NRA","NRW","NTT","NU","NYC","NZ","OBI","OBSERVER","OFFICE","OKINAWA","OLAYAN","OLAYANGROUP","OLDNAVY","OLLO","OM","OMEGA","ONE","ONG","ONL","ONLINE","OOO","OPEN","ORACLE","ORANGE","ORG","ORGANIC","ORIGINS","OSAKA","OTSUKA","OTT","OVH","PA","PAGE","PANASONIC","PARIS","PARS","PARTNERS","PARTS","PARTY","PASSAGENS","PAY","PCCW","PE","PET","PF","PFIZER","PG","PH","PHARMACY","PHD","PHILIPS","PHONE","PHOTO","PHOTOGRAPHY","PHOTOS","PHYSIO","PICS","PICTET","PICTURES","PID","PIN","PING","PINK","PIONEER","PIZZA","PK","PL","PLACE","PLAY","PLAYSTATION","PLUMBING","PLUS","PM","PN","PNC","POHL","POKER","POLITIE","PORN","POST","PR","PRAMERICA","PRAXI","PRESS","PRIME","PRO","PROD","PRODUCTIONS","PROF","PROGRESSIVE","PROMO","PROPERTIES","PROPERTY","PROTECTION","PRU","PRUDENTIAL","PS","PT","PUB","PW","PWC","PY","QA","QPON","QUEBEC","QUEST","RACING","RADIO","RE","READ","REALESTATE","REALTOR","REALTY","RECIPES","RED","REDSTONE","REDUMBRELLA","REHAB","REISE","REISEN","REIT","RELIANCE","REN","RENT","RENTALS","REPAIR","REPORT","REPUBLICAN","REST","RESTAURANT","REVIEW","REVIEWS","REXROTH","RICH","RICHARDLI","RICOH","RIL","RIO","RIP","RO","ROCHER","ROCKS","RODEO","ROGERS","ROOM","RS","RSVP","RU","RUGBY","RUHR","RUN","RW","RWE","RYUKYU","SA","SAARLAND","SAFE","SAFETY","SAKURA","SALE","SALON","SAMSCLUB","SAMSUNG","SANDVIK","SANDVIKCOROMANT","SANOFI","SAP","SARL","SAS","SAVE","SAXO","SB","SBI","SBS","SC","SCA","SCB","SCHAEFFLER","SCHMIDT","SCHOLARSHIPS","SCHOOL","SCHULE","SCHWARZ","SCIENCE","SCOT","SD","SE","SEARCH","SEAT","SECURE","SECURITY","SEEK","SELECT","SENER","SERVICES","SES","SEVEN","SEW","SEX","SEXY","SFR","SG","SH","SHANGRILA","SHARP","SHAW","SHELL","SHIA","SHIKSHA","SHOES","SHOP","SHOPPING","SHOUJI","SHOW","SHOWTIME","SI","SILK","SINA","SINGLES","SITE","SJ","SK","SKI","SKIN","SKY","SKYPE","SL","SLING","SM","SMART","SMILE","SN","SNCF","SO","SOCCER","SOCIAL","SOFTBANK","SOFTWARE","SOHU","SOLAR","SOLUTIONS","SONG","SONY","SOY","SPA","SPACE","SPORT","SPOT","SR","SRL","SS","ST","STADA","STAPLES","STAR","STATEBANK","STATEFARM","STC","STCGROUP","STOCKHOLM","STORAGE","STORE","STREAM","STUDIO","STUDY","STYLE","SU","SUCKS","SUPPLIES","SUPPLY","SUPPORT","SURF","SURGERY","SUZUKI","SV","SWATCH","SWISS","SX","SY","SYDNEY","SYSTEMS","SZ","TAB","TAIPEI","TALK","TAOBAO","TARGET","TATAMOTORS","TATAR","TATTOO","TAX","TAXI","TC","TCI","TD","TDK","TEAM","TECH","TECHNOLOGY","TEL","TEMASEK","TENNIS","TEVA","TF","TG","TH","THD","THEATER","THEATRE","TIAA","TICKETS","TIENDA","TIFFANY","TIPS","TIRES","TIROL","TJ","TJMAXX","TJX","TK","TKMAXX","TL","TM","TMALL","TN","TO","TODAY","TOKYO","TOOLS","TOP","TORAY","TOSHIBA","TOTAL","TOURS","TOWN","TOYOTA","TOYS","TR","TRADE","TRADING","TRAINING","TRAVEL","TRAVELCHANNEL","TRAVELERS","TRAVELERSINSURANCE","TRUST","TRV","TT","TUBE","TUI","TUNES","TUSHU","TV","TVS","TW","TZ","UA","UBANK","UBS","UG","UK","UNICOM","UNIVERSITY","UNO","UOL","UPS","US","UY","UZ","VA","VACATIONS","VANA","VANGUARD","VC","VE","VEGAS","VENTURES","VERISIGN","VERSICHERUNG","VET","VG","VI","VIAJES","VIDEO","VIG","VIKING","VILLAS","VIN","VIP","VIRGIN","VISA","VISION","VIVA","VIVO","VLAANDEREN","VN","VODKA","VOLKSWAGEN","VOLVO","VOTE","VOTING","VOTO","VOYAGE","VU","VUELOS","WALES","WALMART","WALTER","WANG","WANGGOU","WATCH","WATCHES","WEATHER","WEATHERCHANNEL","WEBCAM","WEBER","WEBSITE","WED","WEDDING","WEIBO","WEIR","WF","WHOSWHO","WIEN","WIKI","WILLIAMHILL","WIN","WINDOWS","WINE","WINNERS","WME","WOLTERSKLUWER","WOODSIDE","WORK","WORKS","WORLD","WOW","WS","WTC","WTF","XBOX","XEROX","XFINITY","XIHUAN","XIN","XN--11B4C3D","XN--1CK2E1B","XN--1QQW23A","XN--2SCRJ9C","XN--30RR7Y","XN--3BST00M","XN--3DS443G","XN--3E0B707E","XN--3HCRJ9C","XN--3PXU8K","XN--42C2D9A","XN--45BR5CYL","XN--45BRJ9C","XN--45Q11C","XN--4DBRK0CE","XN--4GBRIM","XN--54B7FTA0CC","XN--55QW42G","XN--55QX5D","XN--5SU34J936BGSG","XN--5TZM5G","XN--6FRZ82G","XN--6QQ986B3XL","XN--80ADXHKS","XN--80AO21A","XN--80AQECDR1A","XN--80ASEHDB","XN--80ASWG","XN--8Y0A063A","XN--90A3AC","XN--90AE","XN--90AIS","XN--9DBQ2A","XN--9ET52U","XN--9KRT00A","XN--B4W605FERD","XN--BCK1B9A5DRE4C","XN--C1AVG","XN--C2BR7G","XN--CCK2B3B","XN--CCKWCXETD","XN--CG4BKI","XN--CLCHC0EA0B2G2A9GCD","XN--CZR694B","XN--CZRS0T","XN--CZRU2D","XN--D1ACJ3B","XN--D1ALF","XN--E1A4C","XN--ECKVDTC9D","XN--EFVY88H","XN--FCT429K","XN--FHBEI","XN--FIQ228C5HS","XN--FIQ64B","XN--FIQS8S","XN--FIQZ9S","XN--FJQ720A","XN--FLW351E","XN--FPCRJ9C3D","XN--FZC2C9E2C","XN--FZYS8D69UVGM","XN--G2XX48C","XN--GCKR3F0F","XN--GECRJ9C","XN--GK3AT1E","XN--H2BREG3EVE","XN--H2BRJ9C","XN--H2BRJ9C8C","XN--HXT814E","XN--I1B6B1A6A2E","XN--IMR513N","XN--IO0A7I","XN--J1AEF","XN--J1AMH","XN--J6W193G","XN--JLQ480N2RG","XN--JLQ61U9W7B","XN--JVR189M","XN--KCRX77D1X4A","XN--KPRW13D","XN--KPRY57D","XN--KPUT3I","XN--L1ACC","XN--LGBBAT1AD8J","XN--MGB9AWBF","XN--MGBA3A3EJT","XN--MGBA3A4F16A","XN--MGBA7C0BBN0A","XN--MGBAAKC7DVF","XN--MGBAAM7A8H","XN--MGBAB2BD","XN--MGBAH1A3HJKRD","XN--MGBAI9AZGQP6J","XN--MGBAYH7GPA","XN--MGBBH1A","XN--MGBBH1A71E","XN--MGBC0A9AZCG","XN--MGBCA7DZDO","XN--MGBCPQ6GPA1A","XN--MGBERP4A5D4AR","XN--MGBGU82A","XN--MGBI4ECEXP","XN--MGBPL2FH","XN--MGBT3DHD","XN--MGBTX2B","XN--MGBX4CD0AB","XN--MIX891F","XN--MK1BU44C","XN--MXTQ1M","XN--NGBC5AZD","XN--NGBE9E0A","XN--NGBRX","XN--NODE","XN--NQV7F","XN--NQV7FS00EMA","XN--NYQY26A","XN--O3CW4H","XN--OGBPF8FL","XN--OTU796D","XN--P1ACF","XN--P1AI","XN--PGBS0DH","XN--PSSY2U","XN--Q7CE6A","XN--Q9JYB4C","XN--QCKA1PMC","XN--QXA6A","XN--QXAM","XN--RHQV96G","XN--ROVU88B","XN--RVC1E0AM3E","XN--S9BRJ9C","XN--SES554G","XN--T60B56A","XN--TCKWE","XN--TIQ49XQYJ","XN--UNUP4Y","XN--VERMGENSBERATER-CTB","XN--VERMGENSBERATUNG-PWB","XN--VHQUV","XN--VUQ861B","XN--W4R85EL8FHU5DNRA","XN--W4RS40L","XN--WGBH1C","XN--WGBL6A","XN--XHQ521B","XN--XKC2AL3HYE2A","XN--XKC2DL3A5EE0H","XN--Y9A3AQ","XN--YFRO4I67O","XN--YGBI2AMMX","XN--ZFR164B","XXX","XYZ","YACHTS","YAHOO","YAMAXUN","YANDEX","YE","YODOBASHI","YOGA","YOKOHAMA","YOU","YOUTUBE","YT","YUN","ZA","ZAPPOS","ZARA","ZERO","ZIP","ZM","ZONE","ZUERICH","ZW"];uc.exports=new Set(cc.tlds.map(e=>e.toLowerCase()))});var yc=y((Sg,mc)=>{"use strict";var I=R(),ts=Zn(),Fp=Yl(),pc=oc(),dc=lc(),hc=fc(),Up=si(),Gp=Ce(),ce=M(),O={tlds:hc instanceof Set?{tlds:{allow:hc,deny:null}}:!1,base64Regex:{true:{true:/^(?:[\w\-]{2}[\w\-]{2})*(?:[\w\-]{2}==|[\w\-]{3}=)?$/,false:/^(?:[A-Za-z0-9+\/]{2}[A-Za-z0-9+\/]{2})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/},false:{true:/^(?:[\w\-]{2}[\w\-]{2})*(?:[\w\-]{2}(==)?|[\w\-]{3}=?)?$/,false:/^(?:[A-Za-z0-9+\/]{2}[A-Za-z0-9+\/]{2})*(?:[A-Za-z0-9+\/]{2}(==)?|[A-Za-z0-9+\/]{3}=?)?$/}},dataUriRegex:/^data:[\w+.-]+\/[\w+.-]+;((charset=[\w-]+|base64),)?(.*)$/,hexRegex:/^[a-f0-9]+$/i,ipRegex:pc.regex({cidr:"forbidden"}).regex,isoDurationRegex:/^P(?!$)(\d+Y)?(\d+M)?(\d+W)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?$/,guidBrackets:{"{":"}","[":"]","(":")","":""},guidVersions:{uuidv1:"1",uuidv2:"2",uuidv3:"3",uuidv4:"4",uuidv5:"5"},guidSeparators:new Set([void 0,!0,!1,"-",":"]),normalizationForms:["NFC","NFD","NFKC","NFKD"]};mc.exports=Gp.extend({type:"string",flags:{insensitive:{default:!1},truncate:{default:!1}},terms:{replacements:{init:null}},coerce:{from:"string",method(e,{schema:t,state:r,prefs:s}){let n=t.$_getRule("normalize");n&&(e=e.normalize(n.args.form));let i=t.$_getRule("case");i&&(e=i.args.direction==="upper"?e.toLocaleUpperCase():e.toLocaleLowerCase());let o=t.$_getRule("trim");if(o&&o.args.enabled&&(e=e.trim()),t.$_terms.replacements)for(let l of t.$_terms.replacements)e=e.replace(l.pattern,l.replacement);let a=t.$_getRule("hex");if(a&&a.args.options.byteAligned&&e.length%2!==0&&(e=`0${e}`),t.$_getRule("isoDate")){let l=O.isoDate(e);l&&(e=l)}if(t._flags.truncate){let l=t.$_getRule("max");if(l){let c=l.args.limit;if(ce.isResolvable(c)&&(c=c.resolve(e,r,s),!ce.limit(c)))return{value:e,errors:t.$_createError("any.ref",c,{ref:l.args.limit,arg:"limit",reason:"must be a positive integer"},r,s)};e=e.slice(0,c)}}return{value:e}}},validate(e,{schema:t,error:r}){if(typeof e!="string")return{value:e,errors:r("string.base")};if(e===""){let s=t.$_getRule("min");return s&&s.args.limit===0?void 0:{value:e,errors:r("string.empty")}}},rules:{alphanum:{method(){return this.$_addRule("alphanum")},validate(e,t){return/^[a-zA-Z0-9]+$/.test(e)?e:t.error("string.alphanum")}},base64:{method(e={}){return ce.assertOptions(e,["paddingRequired","urlSafe"]),e={urlSafe:!1,paddingRequired:!0,...e},I(typeof e.paddingRequired=="boolean","paddingRequired must be boolean"),I(typeof e.urlSafe=="boolean","urlSafe must be boolean"),this.$_addRule({name:"base64",args:{options:e}})},validate(e,t,{options:r}){return O.base64Regex[r.paddingRequired][r.urlSafe].test(e)?e:t.error("string.base64")}},case:{method(e){return I(["lower","upper"].includes(e),"Invalid case:",e),this.$_addRule({name:"case",args:{direction:e}})},validate(e,t,{direction:r}){return r==="lower"&&e===e.toLocaleLowerCase()||r==="upper"&&e===e.toLocaleUpperCase()?e:t.error(`string.${r}case`)},convert:!0},creditCard:{method(){return this.$_addRule("creditCard")},validate(e,t){let r=e.length,s=0,n=1;for(;r--;){let i=e.charAt(r)*n;s=s+(i-(i>9)*9),n=n^3}return s>0&&s%10===0?e:t.error("string.creditCard")}},dataUri:{method(e={}){return ce.assertOptions(e,["paddingRequired"]),e={paddingRequired:!0,...e},I(typeof e.paddingRequired=="boolean","paddingRequired must be boolean"),this.$_addRule({name:"dataUri",args:{options:e}})},validate(e,t,{options:r}){let s=e.match(O.dataUriRegex);return s&&(!s[2]||s[2]!=="base64"||O.base64Regex[r.paddingRequired].false.test(s[3]))?e:t.error("string.dataUri")}},domain:{method(e){e&&ce.assertOptions(e,["allowFullyQualified","allowUnicode","maxDomainSegments","minDomainSegments","tlds"]);let t=O.addressOptions(e);return this.$_addRule({name:"domain",args:{options:e},address:t})},validate(e,t,r,{address:s}){return ts.isValid(e,s)?e:t.error("string.domain")}},email:{method(e={}){ce.assertOptions(e,["allowFullyQualified","allowUnicode","ignoreLength","maxDomainSegments","minDomainSegments","multiple","separator","tlds"]),I(e.multiple===void 0||typeof e.multiple=="boolean","multiple option must be an boolean");let t=O.addressOptions(e),r=new RegExp(`\\s*[${e.separator?dc(e.separator):","}]\\s*`);return this.$_addRule({name:"email",args:{options:e},regex:r,address:t})},validate(e,t,{options:r},{regex:s,address:n}){let i=r.multiple?e.split(s):[e],o=[];for(let a of i)Fp.isValid(a,n)||o.push(a);return o.length?t.error("string.email",{value:e,invalids:o}):e}},guid:{alias:"uuid",method(e={}){ce.assertOptions(e,["version","separator"]);let t="";if(e.version){let n=[].concat(e.version);I(n.length>=1,"version must have at least 1 valid version specified");let i=new Set;for(let o=0;o<n.length;++o){let a=n[o];I(typeof a=="string","version at position "+o+" must be a string");let l=O.guidVersions[a.toLowerCase()];I(l,"version at position "+o+" must be one of "+Object.keys(O.guidVersions).join(", ")),I(!i.has(l),"version at position "+o+" must not be a duplicate"),t+=l,i.add(l)}}I(O.guidSeparators.has(e.separator),'separator must be one of true, false, "-", or ":"');let r=e.separator===void 0?"[:-]?":e.separator===!0?"[:-]":e.separator===!1?"[]?":`\\${e.separator}`,s=new RegExp(`^([\\[{\\(]?)[0-9A-F]{8}(${r})[0-9A-F]{4}\\2?[${t||"0-9A-F"}][0-9A-F]{3}\\2?[${t?"89AB":"0-9A-F"}][0-9A-F]{3}\\2?[0-9A-F]{12}([\\]}\\)]?)$`,"i");return this.$_addRule({name:"guid",args:{options:e},regex:s})},validate(e,t,r,{regex:s}){let n=s.exec(e);return!n||O.guidBrackets[n[1]]!==n[n.length-1]?t.error("string.guid"):e}},hex:{method(e={}){return ce.assertOptions(e,["byteAligned"]),e={byteAligned:!1,...e},I(typeof e.byteAligned=="boolean","byteAligned must be boolean"),this.$_addRule({name:"hex",args:{options:e}})},validate(e,t,{options:r}){return O.hexRegex.test(e)?r.byteAligned&&e.length%2!==0?t.error("string.hexAlign"):e:t.error("string.hex")}},hostname:{method(){return this.$_addRule("hostname")},validate(e,t){return ts.isValid(e,{minDomainSegments:1})||O.ipRegex.test(e)?e:t.error("string.hostname")}},insensitive:{method(){return this.$_setFlag("insensitive",!0)}},ip:{method(e={}){ce.assertOptions(e,["cidr","version"]);let{cidr:t,versions:r,regex:s}=pc.regex(e),n=e.version?r:void 0;return this.$_addRule({name:"ip",args:{options:{cidr:t,version:n}},regex:s})},validate(e,t,{options:r},{regex:s}){return s.test(e)?e:r.version?t.error("string.ipVersion",{value:e,cidr:r.cidr,version:r.version}):t.error("string.ip",{value:e,cidr:r.cidr})}},isoDate:{method(){return this.$_addRule("isoDate")},validate(e,{error:t}){return O.isoDate(e)?e:t("string.isoDate")}},isoDuration:{method(){return this.$_addRule("isoDuration")},validate(e,t){return O.isoDurationRegex.test(e)?e:t.error("string.isoDuration")}},length:{method(e,t){return O.length(this,"length",e,"=",t)},validate(e,t,{limit:r,encoding:s},{name:n,operator:i,args:o}){let a=s?Buffer&&Buffer.byteLength(e,s):e.length;return ce.compare(a,r,i)?e:t.error("string."+n,{limit:o.limit,value:e,encoding:s})},args:[{name:"limit",ref:!0,assert:ce.limit,message:"must be a positive integer"},"encoding"]},lowercase:{method(){return this.case("lower")}},max:{method(e,t){return O.length(this,"max",e,"<=",t)},args:["limit","encoding"]},min:{method(e,t){return O.length(this,"min",e,">=",t)},args:["limit","encoding"]},normalize:{method(e="NFC"){return I(O.normalizationForms.includes(e),"normalization form must be one of "+O.normalizationForms.join(", ")),this.$_addRule({name:"normalize",args:{form:e}})},validate(e,{error:t},{form:r}){return e===e.normalize(r)?e:t("string.normalize",{value:e,form:r})},convert:!0},pattern:{alias:"regex",method(e,t={}){I(e instanceof RegExp,"regex must be a RegExp"),I(!e.flags.includes("g")&&!e.flags.includes("y"),"regex should not use global or sticky mode"),typeof t=="string"&&(t={name:t}),ce.assertOptions(t,["invert","name"]);let r=["string.pattern",t.invert?".invert":"",t.name?".name":".base"].join("");return this.$_addRule({name:"pattern",args:{regex:e,options:t},errorCode:r})},validate(e,t,{regex:r,options:s},{errorCode:n}){return r.test(e)^s.invert?e:t.error(n,{name:s.name,regex:r,value:e})},args:["regex","options"],multi:!0},replace:{method(e,t){typeof e=="string"&&(e=new RegExp(dc(e),"g")),I(e instanceof RegExp,"pattern must be a RegExp"),I(typeof t=="string","replacement must be a String");let r=this.clone();return r.$_terms.replacements||(r.$_terms.replacements=[]),r.$_terms.replacements.push({pattern:e,replacement:t}),r}},token:{method(){return this.$_addRule("token")},validate(e,t){return/^\w+$/.test(e)?e:t.error("string.token")}},trim:{method(e=!0){return I(typeof e=="boolean","enabled must be a boolean"),this.$_addRule({name:"trim",args:{enabled:e}})},validate(e,t,{enabled:r}){return!r||e===e.trim()?e:t.error("string.trim")},convert:!0},truncate:{method(e=!0){return I(typeof e=="boolean","enabled must be a boolean"),this.$_setFlag("truncate",e)}},uppercase:{method(){return this.case("upper")}},uri:{method(e={}){ce.assertOptions(e,["allowRelative","allowQuerySquareBrackets","domain","relativeOnly","scheme"]),e.domain&&ce.assertOptions(e.domain,["allowFullyQualified","allowUnicode","maxDomainSegments","minDomainSegments","tlds"]);let{regex:t,scheme:r}=Up.regex(e),s=e.domain?O.addressOptions(e.domain):null;return this.$_addRule({name:"uri",args:{options:e},regex:t,domain:s,scheme:r})},validate(e,t,{options:r},{regex:s,domain:n,scheme:i}){if(["http:/","https:/"].includes(e))return t.error("string.uri");let o=s.exec(e);if(o){let a=o[1]||o[2];return n&&(!r.allowRelative||a)&&!ts.isValid(a,n)?t.error("string.domain",{value:a}):e}return r.relativeOnly?t.error("string.uriRelativeOnly"):r.scheme?t.error("string.uriCustomScheme",{scheme:i,value:e}):t.error("string.uri")}}},manifest:{build(e,t){if(t.replacements)for(let{pattern:r,replacement:s}of t.replacements)e=e.replace(r,s);return e}},messages:{"string.alphanum":"{{#label}} must only contain alpha-numeric characters","string.base":"{{#label}} must be a string","string.base64":"{{#label}} must be a valid base64 string","string.creditCard":"{{#label}} must be a credit card","string.dataUri":"{{#label}} must be a valid dataUri string","string.domain":"{{#label}} must contain a valid domain name","string.email":"{{#label}} must be a valid email","string.empty":"{{#label}} is not allowed to be empty","string.guid":"{{#label}} must be a valid GUID","string.hex":"{{#label}} must only contain hexadecimal characters","string.hexAlign":"{{#label}} hex decoded representation must be byte aligned","string.hostname":"{{#label}} must be a valid hostname","string.ip":"{{#label}} must be a valid ip address with a {{#cidr}} CIDR","string.ipVersion":"{{#label}} must be a valid ip address of one of the following versions {{#version}} with a {{#cidr}} CIDR","string.isoDate":"{{#label}} must be in iso format","string.isoDuration":"{{#label}} must be a valid ISO 8601 duration","string.length":"{{#label}} length must be {{#limit}} characters long","string.lowercase":"{{#label}} must only contain lowercase characters","string.max":"{{#label}} length must be less than or equal to {{#limit}} characters long","string.min":"{{#label}} length must be at least {{#limit}} characters long","string.normalize":"{{#label}} must be unicode normalized in the {{#form}} form","string.token":"{{#label}} must only contain alpha-numeric and underscore characters","string.pattern.base":"{{#label}} with value {:[.]} fails to match the required pattern: {{#regex}}","string.pattern.name":"{{#label}} with value {:[.]} fails to match the {{#name}} pattern","string.pattern.invert.base":"{{#label}} with value {:[.]} matches the inverted pattern: {{#regex}}","string.pattern.invert.name":"{{#label}} with value {:[.]} matches the inverted {{#name}} pattern","string.trim":"{{#label}} must not have leading or trailing whitespace","string.uri":"{{#label}} must be a valid uri","string.uriCustomScheme":"{{#label}} must be a valid uri with a scheme matching the {{#scheme}} pattern","string.uriRelativeOnly":"{{#label}} must be a valid relative uri","string.uppercase":"{{#label}} must only contain uppercase characters"}});O.addressOptions=function(e){if(!e||(I(e.minDomainSegments===void 0||Number.isSafeInteger(e.minDomainSegments)&&e.minDomainSegments>0,"minDomainSegments must be a positive integer"),I(e.maxDomainSegments===void 0||Number.isSafeInteger(e.maxDomainSegments)&&e.maxDomainSegments>0,"maxDomainSegments must be a positive integer"),e.tlds===!1))return e;if(e.tlds===!0||e.tlds===void 0)return I(O.tlds,"Built-in TLD list disabled"),Object.assign({},e,O.tlds);I(typeof e.tlds=="object","tlds must be true, false, or an object");let t=e.tlds.deny;if(t)return Array.isArray(t)&&(e=Object.assign({},e,{tlds:{deny:new Set(t)}})),I(e.tlds.deny instanceof Set,"tlds.deny must be an array, Set, or boolean"),I(!e.tlds.allow,"Cannot specify both tlds.allow and tlds.deny lists"),O.validateTlds(e.tlds.deny,"tlds.deny"),e;let r=e.tlds.allow;return r?r===!0?(I(O.tlds,"Built-in TLD list disabled"),Object.assign({},e,O.tlds)):(Array.isArray(r)&&(e=Object.assign({},e,{tlds:{allow:new Set(r)}})),I(e.tlds.allow instanceof Set,"tlds.allow must be an array, Set, or boolean"),O.validateTlds(e.tlds.allow,"tlds.allow"),e):e};O.validateTlds=function(e,t){for(let r of e)I(ts.isValid(r,{minDomainSegments:1,maxDomainSegments:1}),`${t} must contain valid top level domain names`)};O.isoDate=function(e){if(!ce.isIsoDate(e))return null;/.*T.*[+-]\d\d$/.test(e)&&(e+="00");let t=new Date(e);return isNaN(t.getTime())?null:t.toISOString()};O.length=function(e,t,r,s,n){return I(!n||Buffer&&Buffer.isEncoding(n),"Invalid encoding:",n),e.$_addRule({name:t,method:"length",args:{limit:r,encoding:n},operator:s})}});var bc=y((_g,gc)=>{"use strict";var rs=R(),Hp=Ce(),ni={};ni.Map=class extends Map{slice(){return new ni.Map(this)}};gc.exports=Hp.extend({type:"symbol",terms:{map:{init:new ni.Map}},coerce:{method(e,{schema:t,error:r}){let s=t.$_terms.map.get(e);return s&&(e=s),!t._flags.only||typeof e=="symbol"?{value:e}:{value:e,errors:r("symbol.map",{map:t.$_terms.map})}}},validate(e,{error:t}){if(typeof e!="symbol")return{value:e,errors:t("symbol.base")}},rules:{map:{method(e){e&&!e[Symbol.iterator]&&typeof e=="object"&&(e=Object.entries(e)),rs(e&&e[Symbol.iterator],"Iterable must be an iterable or object");let t=this.clone(),r=[];for(let s of e){rs(s&&s[Symbol.iterator],"Entry must be an iterable");let[n,i]=s;rs(typeof n!="object"&&typeof n!="function"&&typeof n!="symbol","Key must not be of type object, function, or Symbol"),rs(typeof i=="symbol","Value must be a Symbol"),t.$_terms.map.set(n,i),r.push(i)}return t.valid(...r)}}},manifest:{build(e,t){return t.map&&(e=e.map(t.map)),e}},messages:{"symbol.base":"{{#label}} must be a symbol","symbol.map":"{{#label}} must be one of {{#map}}"}})});var Ac=y((Eg,_c)=>{"use strict";var zp=R(),Xp=Ce(),Sc=M();_c.exports=Xp.extend({type:"binary",coerce:{from:"string",method(e,{schema:t}){try{return{value:Buffer.from(e,t._flags.encoding)}}catch{}}},validate(e,{error:t}){if(!Buffer.isBuffer(e))return{value:e,errors:t("binary.base")}},rules:{encoding:{method(e){return zp(Buffer.isEncoding(e),"Invalid encoding:",e),this.$_setFlag("encoding",e)}},length:{method(e){return this.$_addRule({name:"length",method:"length",args:{limit:e},operator:"="})},validate(e,t,{limit:r},{name:s,operator:n,args:i}){return Sc.compare(e.length,r,n)?e:t.error("binary."+s,{limit:i.limit,value:e})},args:[{name:"limit",ref:!0,assert:Sc.limit,message:"must be a positive integer"}]},max:{method(e){return this.$_addRule({name:"max",method:"length",args:{limit:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"length",args:{limit:e},operator:">="})}}},cast:{string:{from:e=>Buffer.isBuffer(e),to(e,t){return e.toString()}}},messages:{"binary.base":"{{#label}} must be a buffer or a string","binary.length":"{{#label}} must be {{#limit}} bytes","binary.max":"{{#label}} must be less than or equal to {{#limit}} bytes","binary.min":"{{#label}} must be at least {{#limit}} bytes"}})});var xn=y((wg,kc)=>{"use strict";var Ot=R(),Kp=oe(),Vp=Mn(),Rt=M(),Qp=Et(),oi=ze(),Yp=Dn(),Ec=Pn(),ii=Xe(),wc=ut(),Cc=qn(),ss,H={types:{alternatives:Sl(),any:Ce(),array:Al(),boolean:Rl(),date:Il(),function:Gl(),link:zl(),number:Kl(),object:Ql(),string:yc(),symbol:bc()},aliases:{alt:"alternatives",bool:"boolean",func:"function"}};Buffer&&(H.types.binary=Ac());H.root=function(){let e={_types:new Set(Object.keys(H.types))};for(let t of e._types)e[t]=function(...r){return Ot(!r.length||["alternatives","link","object"].includes(t),"The",t,"type does not allow arguments"),H.generate(this,H.types[t],r)};for(let t of["allow","custom","disallow","equal","exist","forbidden","invalid","not","only","optional","options","prefs","preferences","required","strip","valid","when"])e[t]=function(...r){return this.any()[t](...r)};Object.assign(e,H.methods);for(let t in H.aliases){let r=H.aliases[t];e[t]=e[r]}return e.x=e.expression,Cc.setup&&Cc.setup(e),e};H.methods={ValidationError:oi.ValidationError,version:Rt.version,cache:Vp.provider,assert(e,t,...r){H.assert(e,t,!0,r)},attempt(e,t,...r){return H.assert(e,t,!1,r)},build(e){return Ot(typeof Ec.build=="function","Manifest functionality disabled"),Ec.build(this,e)},checkPreferences(e){Rt.checkPreferences(e)},compile(e,t){return Qp.compile(this,e,t)},defaults(e){Ot(typeof e=="function","modifier must be a function");let t=Object.assign({},this);for(let r of t._types){let s=e(t[r]());Ot(Rt.isSchema(s),"modifier must return a valid schema object"),t[r]=function(...n){return H.generate(this,s,n)}}return t},expression(...e){return new wc(...e)},extend(...e){Rt.verifyFlat(e,"extend"),ss=ss||jr(),Ot(e.length,"You need to provide at least one extension"),this.assert(e,ss.extensions);let t=Object.assign({},this);t._types=new Set(t._types);for(let r of e){typeof r=="function"&&(r=r(t)),this.assert(r,ss.extension);let s=H.expandExtension(r,t);for(let n of s){Ot(t[n.type]===void 0||t._types.has(n.type),"Cannot override name",n.type);let i=n.base||this.any(),o=Yp.type(i,n);t._types.add(n.type),t[n.type]=function(...a){return H.generate(this,o,a)}}}return t},isError:oi.ValidationError.isError,isExpression:wc.isTemplate,isRef:ii.isRef,isSchema:Rt.isSchema,in(...e){return ii.in(...e)},override:Rt.symbols.override,ref(...e){return ii.create(...e)},types(){let e={};for(let t of this._types)e[t]=this[t]();for(let t in H.aliases)e[t]=this[t]();return e}};H.assert=function(e,t,r,s){let n=s[0]instanceof Error||typeof s[0]=="string"?s[0]:null,i=n!==null?s[1]:s[0],o=t.validate(e,Rt.preferences({errors:{stack:!0}},i||{})),a=o.error;if(!a)return o.value;if(n instanceof Error)throw n;let l=r&&typeof a.annotate=="function"?a.annotate():a.message;throw a instanceof oi.ValidationError||(a=Kp(a)),a.message=n?`${n} ${l}`:l,a};H.generate=function(e,t,r){return Ot(e,"Must be invoked on a Joi instance."),t.$_root=e,!t._definition.args||!r.length?t:t._definition.args(t,...r)};H.expandExtension=function(e,t){if(typeof e.type=="string")return[e];let r=[];for(let s of t._types)if(e.type.test(s)){let n=Object.assign({},e);n.type=s,n.base=t[s](),r.push(n)}return r};kc.exports=H.root()});var em={};Fc(em,{handler:()=>Zp});module.exports=Uc(em);var ma=mi(pa()),Rh=new ma.default,Ge=Rh;var Te=mi(xn()),Rc=new Date().getFullYear(),Wp=["gmail.com","hotmail.com","yahoo.es"],Jp=(e,t)=>{let r=e.split("@")[1];return Wp.includes(r)?e:t.error("any.invalid")},Oc=Te.object({email:Te.string().email({minDomainSegments:2,tlds:{allow:["com","es"]}}).custom(Jp).required(),card_number:Te.string().creditCard().required(),cvv:Te.string().when("card_number",{is:/^4[0-9]{12}(\d{3})?$/,then:Te.string().length(3).valid("123"),otherwise:Te.string().length(4).valid("4532")}).required(),expiration_year:Te.number().integer().min(Rc).max(Rc+5).required(),expiration_month:Te.number().integer().min(1).max(12).required()});var ur=class{constructor(t,r,s,n,i){this.email=t;this.card_number=r;this.expiration_year=s;this.expiration_month=n;this.cvv=i;let{error:o}=Oc.validate({email:this.email,card_number:this.card_number,cvv:this.cvv,expiration_year:this.expiration_year,expiration_month:this.expiration_month});if(o)throw new Error("Validation failed: "+o.details.map(a=>a.message).join(", "))}return(){return new ur(this.email,this.card_number,this.expiration_year,this.expiration_month,this.cvv)}},vc=ur;function xc(e){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r="";for(let s=0;s<e;s++){let n=Math.floor(Math.random()*t.length);r+=t.charAt(n)}return r}async function Ic(e){let t=JSON.parse(e);return delete t.cvv,t}var vt=class extends Error{constructor(r,s){super(s);this.status=r;this.name=this.constructor.name,Error.captureStackTrace(this,this.constructor)}};var ns=class extends vt{constructor(t){super(401,t)}},fr=class extends vt{constructor(t){super(404,t)}};async function Tc(e){try{Ge.status==="end"&&await Ge.connect();let t=JSON.parse(e.body||"{}"),r=new vc(t.email,t.card_number,t.expiration_year,t.expiration_month,t.cvv).return(),s=xc(16);return await Ge.setex(s,900,JSON.stringify(r)),s}catch(t){throw new fr(t)}finally{await Ge.quit()}}async function Nc(e){try{Ge.status==="end"&&await Ge.connect();let t=JSON.parse(e.body||"{}"),r=await Ge.get(t.token);return r?await Ic(r):""}catch(t){throw new fr(t)}finally{await Ge.quit()}}var ai=class{constructor(t,r,s){this.status=t;this.message=r;this.data=s;this.status=t,this.message=r,this.data=s}async response(){return{statusCode:this.status,headers:{"Content-Type":"application/json"},body:JSON.stringify(this)}}},zt=ai;function Mc(e){let t="Bearer pk_test_LsRb12fdsvdew21";return e.headers.Authorization===t}var Zp=async e=>{try{if(!Mc(e))throw new ns("Token de encabezado inv\xE1lido o faltante");let r,s;if(e.path==="/tokens"&&e.httpMethod==="POST")s=await Tc(e),r=new zt(200,"Tarjeta registrada",s);else if(e.path==="/gettokens"&&e.httpMethod==="POST")s=await Nc(e),s===""?r=new zt(404,"Token no encontrado o expirado",""):r=new zt(200,"Token encontrado",s);else throw new vt(400,"Ruta de API no v\xE1lida");return r.response()}catch(t){return t instanceof vt?new zt(t.status,t.message,"").response():new zt(500,"Ha ocurrido un error interno.","").response()}};0&&(module.exports={handler});
//# sourceMappingURL=card-handler.js.map
